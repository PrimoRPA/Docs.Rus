# Решить ReCapcha v3

![](<../../../.gitbook/assets/image (745).png>)

Элемент, решающий капчу формата ReCapcha v3

| Свойство   | Тип    | Описание                |
| ---------- | ------ | ----------------------- |
| Ключ API   | String | Ключ API                |
| URL API    | String | URL API                 |
| URL        | String | URL сайта капчи         |
| Ключ сайта | String | Ключ капчи reCapcha     |
| Точность   | [Double](https://learn.microsoft.com/ru-ru/dotnet/api/system.double?view=net-5.0&viewFallbackFrom=windowsdesktop-3.0) | Необходимая точность    |
| Тайм-аут   | Int32  | Тайм-аут                |
| Результат  | String | Результат разбора капчи |



**reCaptcha v3**

reCAPTCHA V3 - это новейший вид капчи от Google, который основан на рейтинге "человечности" пользователя и не требует от пользователя выполнения каких-либо заданий.

Во многом новый вид капчи похож на reCAPTCHA V2, т.е. основной принцип остался тем же - пользователь получает от API reCAPTCHA токен, который отправляется в POST-запросе к сайту, а сайт верифицирует токен через API reCAPTCHA.

НО при верификации токена API reCAPTCHA теперь возвращает рейтинг "человечности" пользователя - _score_ - число от 0.1 до 0.9. Получив это значение, сайт решает, как обрабатывать запрос.

Кроме того, появился новый параметр _action_, который позволяет по разному обрабатывать различные действия пользователя на сайте. При верификации токена API reCAPTCHA вернет имя действия, которое выполнил пользователь.

Как решать reCAPTCHA V3:

1.  В первую очередь нужно убедиться, что на сайте действительно используется reCAPTCHA V3.

    Основные признаки V3:\


    * не видна пользователю, не требует кликать по картинкам;
    * скрипт api.js загружается с параметром _render=sitekey_, например:\
      _https://www.google.com/recaptcha/api.js?render=6LfZil0UAAAAAAdm1Dpzsw9q0F11-bmervx9g5fE_
    * в массиве clients конфигурационного объекта \_\_\_grecaptcha\_cfg используется индекс 100000: _\_\_\_grecaptcha\_cfg.clients\[100000]_
2.  Для решения V3 необходимо найти значения трех параметров:\


    **sitekey** - его можно найти в html в значении параметра _render_ при загрузке api.js, в параметре _k_ в URI iframe, в который подгружается reCAPTCHA, либо в javscript, в вызове функции grecaptcha.execute или в конфигурационном объекте \_\_\_grecaptcha\_cfg.

    **action** - это значение нужно искать в javascript коде сайта в вызове функции grecaptcha.execute. Пример: _grecaptcha.execute('6LfZil0UAAAAAAdm1Dpzsw9q0F11-bmervx9g5fE', {action: do\_something})_.\
    Иногда найти его достаточно сложно и требуется перевернуть вверх дном все js-файлы, подгружаемые сайтом. Кроме того, можно попробовать найти значение action в конфигурационном объекте \_\_\_grecaptcha\_cfg, но очень часто оно может быть не задано там, а передаваться только при вызове grecaptcha.execute - поэтому наиболее эффективный метод - просмотр javascript кода.\


    **pageurl** - полный URL страницы, где вы хотите решить reCAPTCHA V3.

    Кроме того, нужно понять, какое значение score вам требуется. Определить извне, при каком score сайт решит, что вы человек и пропустит ваш запрос, можно только экспериментально. Самый низкий рейгинг 0.1 - робот, а самый высокий 0.9 - человек. Но, многие сайты ставят пороговые значения от 0.2 до 0.5, т.к. обычный человек зачастую получает довольно низкий рейтинг.&#x20;
3.  После получения токена, нужно корректно использовать его на сайте. Лучший метод понять, как это сделать - посмотреть на то, какие запросы отправляются на сайт, когда вы работаете с ним как обычный посетитель. Большинство браузеров позволяют легко это сделать в консоли разработчика, нужная вкладка обычно называется "Network".

    Токен обычно отправляется в параметрах POST-запроса, это может быть _g-recaptcha-response_ как у reCAPTCHA V2, _g-recaptcha-response-100000_ или какой-либо другой параметр. Поэтому нужно внимательно просмотреть параметры запроса и найти, как именно передается токен, а затем сформировать аналогичный запрос.
