# Приложение Excel

![](<../../../.gitbook/assets/image (100) (1) (1) (1) (1) (1) (1) (1) (1) (30).png>)

![](<../../../.gitbook/assets/image (412).png>)

Производит подключение к приложению Excel. Компонент служит контейнером для других элементов, работающих с Excel. **Важно:** при необходимости сохранять изменения в файле используйте в конце элемент [Сохранить документ](https://docs.primo-rpa.ru/primo-rpa/g\_elements/osnovnye-elementy/prilozhenie-excel/el\_excel\_save).

Особенности работы с файлами определяются выбранным драйвером:

1. DX - работает с файлом без Microsoft Office, вследствие чего имеет более высокую производительность. Хорошо подходит для небольших файлов, поддерживается на всех указанных ОС. Недостатки: не работает с макросами и, если файл большой, может занимать много памяти.
2. Interop - работает с файлом через запуск приложения. Поддерживает макросы, не занимает много оперативной памяти. Недостатки: работает медленнее, чем DX, не поддерживается на Linux.

## Свойства

Описание общих свойств элемента см. в разделе [Свойства элемента](https://docs.primo-rpa.ru/primo-rpa/primo-studio/process/elements#svoistva-elementa).\
Символ `*` в названии свойства указывает на обязательность заполнения.

| Свойство          | Тип                              | Описание                                                                                                                                                                                                                                                                               |
| ----------------- | -------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| _**Excel**_       |                                  |                                                                                                                                                                                                                                                                                        |
| Драйвер           | LTools.Office.Model.InteropTypes | Тип драйвера подключения: DX или Interop                                                                                                                                                                                                                                               |
| R1C1              | Boolean                          | Только для DX. Установка флага позволяет задавать диапазон, используя стиль ссылок [R1C1](https://learn.microsoft.com/ru-ru/office/troubleshoot/excel/numeric-columns-and-rows#a1-reference-style-vs-r1c1-reference-style). По умолчанию флаг снят, диапазоны указываются в формате A1 |
| Путь к файлу      | String                           | Путь к файлу документа Excel. Пример: `@"C:\folder\file.xlsx"`                                                                                                                                                                                                                         |
| Присоединяться    | Boolean                          | Только для Interop. При установке флага возможно присоединиться к открытому вручную файлу. **Важно!** Если вы присоединились к такому файлу, закрывать его тоже потребуется вручную                                                                                                    |
| Загружать AddIn-ы | Boolean                          | Только для Interop. Определяет, нужно ли переподключать установленные дополнения. Общие сведения о надстройках Excel приведены [здесь](https://learn.microsoft.com/ru-ru/office/dev/add-ins/excel/excel-add-ins-overview)                                                              |
| Отображать Excel  | Boolean                          | Только для Interop. Если параметр включен, на экране будет отображаться приложение Excel                                                                                                                                                                                               |
| Проверять файл    | Boolean                          | При установке флага будет выполняться проверка на наличие файла. Если проверка выявит, что файл Excel отсутствует, то: 1) При записи новой информации робот создаст файл Excel и добавит в него данные. 2) При попытке чтения несуществующего файла вернется ошибка                    |
| Массив байтов     | byte\[]                          | Массив байтов документа                                                                                                                                                                                                                                                                |
| _**Csv**_         |                                  |                                                                                                                                                                                                                                                                                        |
| Разделитель       | String                           | Разделитель колонок. Для режима Interop необходима кодировка UTF-8 BOM или UTF-16 LE                                                                                                                                                                                                   |

## Надстройки Excel

Чтобы воспользоваться установленными надстройками в Excel, их требуется перезагрузить. Для этого существует свойство **Загружать AddIn-ы** (Interop): с его помощью будет совершена попытка переподключить все активные надстройки. Список активных надстроек можно просмотреть в Excel в меню **Файл > Параметры > Надстройки**.

Однако бывают случаи, когда использование свойства не помогает загрузить какую-то надстройку. Например, если для нее нужны права администратора\*, или если есть конфликт с центром безопасности MS Office.

\*_Например, для установки/удаления надстроек COM нужны права администратора. Свойство **Загружать AddIn-ы** не сможет их установить._

### Запуск через Приложение Excel

Если запуск Робота не приводит к перезагрузке надстроек, то, вероятно, происходит вмешательство центра безопасности MS Office. Например, источник файла расценивается как неблагоприятный. В этом случае следует [правильным образом сконфигурировать MS Office](https://support.microsoft.com/ru-ru/office/%D0%B2%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B8-%D0%BE%D1%82%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D0%BE%D0%B2-%D1%8D%D0%BB%D0%B5%D0%BC%D0%B5%D0%BD%D1%82%D0%BE%D0%B2-activex-%D0%B2-%D1%84%D0%B0%D0%B9%D0%BB%D0%B0%D1%85-office-f1303e08-a3f8-41c5-a17e-b0b8898743ed): необходимо, чтобы при вызове приложения по ярлыку (Пуск > Программы > Excel) оно загружало требуемые надстройки без ограничений от центра безопасности. Тогда Еxcel, запущенный через контейнер **Приложение Excel**, тоже загрузит нужные надстройки.

### Запуск из командной строки

Запуск Excel из [командной строки](https://docs.primo-rpa.ru/primo-rpa/g\_elements/el\_basic/els\_prog/el\_prog\_cmd) обычным образом не загружает все надстройки, поэтому меню и функциональность приложения могут отличаться. Чтобы этого не происходило, команда запуска должна содержать дополнительный ключ `/x`:

> _"/x Starts a new instance (a separate process) of Excel."_

Пример\*\*:

```
"excel.exe /x "c:\My Folder\book1.xlsx""
```

Если к командной строке добавить этот переключатель, то вид Еxcel, запущенный из командной строки, будет соответствовать внешнему виду приложения, запущенному через контейнер **Приложение Excel** (Interop). Подробнее про особенности командной строки можно прочитать [здесь](https://support.microsoft.com/en-us/office/command-line-switches-for-microsoft-office-products-079164cd-4ef5-4178-b235-441737deb3a6).

\*\*_Вся команда в элементе **Командная строка** должна быть в кавычках._

## Только код

Пример использования элемента в процессе с типом **Только код (Pure code)**:

{% tabs %}
{% tab title="C#" %}
```csharp
LTools.Office.ExcelApp app = LTools.Office.ExcelApp.Init(wf, "file", ";", LTools.Office.Model.InteropTypes.DX);
LTools.Office.ExcelApp app = LTools.Office.ExcelApp.Init(wf, System.IO.File.ReadAllBytes("file"), ";", LTools.Office.Model.InteropTypes.DX);
```
{% endtab %}

{% tab title="Python" %}
```python
app = LTools.Office.ExcelApp.Init(wf, "file", ";", LTools.Office.Model.InteropTypes.DX)
app = LTools.Office.ExcelApp.Init(wf, System.IO.File.ReadAllBytes("file"), ";", LTools.Office.Model.InteropTypes.DX)
```
{% endtab %}

{% tab title="JavaScript" %}
```javascript
var app = _lib.LTools.Office.ExcelApp.Init(wf, "file", ";", _lib.LTools.Office.Model.InteropTypes.DX);
var app = _lib.LTools.Office.ExcelApp.Init(wf, _lib.System.IO.File.ReadAllBytes("file"), ";", _lib.LTools.Office.Model.InteropTypes.DX);
```
{% endtab %}
{% endtabs %}
