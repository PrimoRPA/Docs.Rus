# Добавить в очередь

![](<../../../../.gitbook/assets/image (100) (1) (1) (1) (1) (1) (1) (1) (2) (213).png>)

![](<../../../../.gitbook/assets/image (375).png>)

**«Добавить в очередь» (Add to queue)** - добавляет новый элемент [в очередь Оркестратора](https://docs.primo-rpa.ru/primo-rpa/orchestrator/basics/data-queues). Добавленный элемент будет иметь статус New и ожидать обработки Роботом.

Пример отображения добавленного элемента в UI Оркестратора:

![](<../../../../.gitbook/assets/оркестратор. элементы очереди.png>)

## Свойства

Описание общих свойств элемента см. в разделе [Свойства элемента](https://docs.primo-rpa.ru/primo-rpa/primo-studio/process/elements#svoistva-elementa).\
Символ `*` в названии свойства указывает на обязательность заполнения.

:bangbang: ***Для корректной работы обязательно нужно заполнить свойства:***
1. **«Очередь»**.
2. **«Значение»** либо **«Таблица»**. В случае, если заполнены оба свойства - «Значение» и «Таблица» - в элемент запишутся данные только из таблицы.

| Свойство        |                                                                    Тип                                                                   | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| --------------- | :--------------------------------------------------------------------------------------------------------------------------------------: | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| _**Процесс:**_   |                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Очередь\*       |                                                                  String                                                                  | Название очереди, в которую нужно добавить _элемент очереди_ (транзакцию). Название должно совпадать с именем очереди в Оркестраторе. Чувствительно к регистру!                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Значение        |                                                                  String                                                                  | Присвойте значение элементу очереди. Может быть в виде JSON либо переменной, в которой он сохранен. Обратите внимание, что в JSON потребуется заэкранировать все кавычки, поставив перед ними косую черту: `\"`                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Таблица         |                       [DataTable](https://learn.microsoft.com/ru-ru/dotnet/api/system.data.datatable?view=net-5.0)                       | Если значение имеет вид таблицы, заполните это поле, указав табличную переменную                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Идентификатор   |                                                                  String                                                                  | Натуральный ключ элемента очереди (это не ID!). Ключ выполняет схожую функцию с ID, но ID присваивается автоматически при добавлении элемента в очередь, имеет формат Guid, и его нельзя изменить. Ключ же можно задать вручную как дополнительный идентификатор. Как правило, он используется для упрощенного распознавания элемента                                                                                                                                                                                                                                                                                                    |
| Метаданные      |                                                        Dictionary\<string, string>                                                       | Метаданные элемента очереди. В дальнейшем могут помочь при фильтрации. Зачастую это динамические данные                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Тэги            |                                                               List\<string>                                                              | Теги для элемента очереди. В дальнейшем могут помочь при фильтрации элементов                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Приоритет       |                                                                   Int32                                                                  | <p>Приоритет добавляемого элемента очереди. Согласно приоритету производится сортировка элементов для извлечения из очереди. Если указан приоритет, используется сначала он, потом дата добавления. Если приоритета нет (или он одинаковый), то элементы сортируются по дате добавления. Также на извлечение из очереди влияет дата, указанная в свойстве <strong>Недоступен до</strong> (если заполнено).</p><p>По умолчанию задан приоритет <code>0</code> - это высший приоритет. Значение не может быть отрицательным. Чем выше значение, тем ниже приоритет элемента. Положительные числа ограничены лишь типом данных свойства</p> |
| Недоступен до   |                           [DateTime](https://learn.microsoft.com/ru-ru/dotnet/api/system.datetime?view=net-7.0)                          | Укажите дату, до наступления которой Робот не сможет обрабатывать элемент очереди. Ниже, в примечаниях, указан пример заполнения                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Устранить после |                                                                 DateTime                                                                 | Укажите дату, после которой элемент нужно удалить из очереди                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Забирать        |                                                                  Boolean                                                                 | Включите этот параметр, если после добавления элемента в очередь его нужно немедленно взять в работу. В результате другие роботы Оркестратора не успеют взять ваше значение в обработку                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Таймаут         |                                                                   Int32                                                                  | Лимит времени операции (мс). Если по истечении лимита операция не выполнена, робот закончит работу с ошибкой                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| _**Вывод:**_     |                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Элемент         | [LTools.Enterprise.Model.QueueItem](https://docs.primo-rpa.ru/primo-rpa/g\_elements/osnovnye-elementy/orkestrator/els\_queues/datatypes) | Укажите переменную, в которую нужно сохранить добавленный элемент очереди                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

### Пример заполнения свойств:

1\. Указание свойства **Значение** в формате JSON (кавычки нужно заэкранировать: **\\"**):

```
{"collection":{"row":{"field":\[{"name":"FIO","type":"text","value":"Иванов Иван Иванович"},{"name":"from","type":"text","value":"Москва, Улица, Номер дома"},{"name":"to","type":"text","value":"Санкт-Петербург,Улица, Номер дома"},{"name":"dateAndTime","type":"text","value":"23.08.2022 19:04"},{"name":"reestrFullPath","type":"text","value":"\\\of-FS-01\Common\Works\Название отдела\Такси реестр\реестры в оплату\такси\_август.xlsx"},{"name":"row","type":"text","value":"70"}]\}}}
```

2\. **Идентификатор** (натуральный ключ). Пример: `"mykey1"`.

3\. **Метаданные**. Пример:

```
{"Tags":"123","KeyField":"FIO","KeyValue":"Иван Иванович Иванов","Attempt":"1","Loaded":"9/20/2022 4:31:12 PM","Completed":"9/20/2022 11:38:06 AM","Worktime":"1","Priority":"0","Prevworktime":"0","Attemptworktime":"1","Finished":"9/20/2022 11:38:06 AM","LastUpdated":"9/20/2022 11:38:06 AM"}
```

Если метаданные неизвестны на момент создания элемента, но их нужно добавить позднее, действуйте по алгоритму:

* добавьте элемент очереди с пустыми метаданными;
* прочитайте элемент с помощью активности [**Получить из очереди**](https://docs.primo-rpa.ru/primo-rpa/g\_elements/osnovnye-elementy/orkestrator/els\_queues/readfromqueue) или **Получить по ID/фильтру**;
* удалите старый элемент либо измените его статус на Success с помощью компонента [**Изменить статус в очереди**](https://docs.primo-rpa.ru/primo-rpa/g\_elements/osnovnye-elementy/orkestrator/els\_queues/changestatequeue);
* добавьте новый элемент с помощью активности **Добавить в очередь** и запишите в него нужные метаданные.

4\. **Тэги**. Пример: `List{"tag"}`.

5\. **Недоступен до**. Пример: `new DateTime(2022, 9, 19)`.

## Только код

Пример использования элемента в процессе с типом **Только код** (Pure code):

***

{% tabs %}
{% tab title="C#" %}
```csharp
LTools.Enterprise.OrchestratorApp.WriteQueue(wf, "queue", "data");
```
{% endtab %}

{% tab title="Python" %}
```python
LTools.Enterprise.OrchestratorApp.WriteQueue(wf, "queue", "data")
```
{% endtab %}

{% tab title="JavaScript" %}
```javascript
_lib.LTools.Enterprise.OrchestratorApp.WriteQueue(wf, "queue", "data");
```
{% endtab %}
{% endtabs %}
