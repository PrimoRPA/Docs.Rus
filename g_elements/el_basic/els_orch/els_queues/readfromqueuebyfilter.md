---
description: Peek queue by filter
---

# Получить из очереди по фильтру

![](<../../../../.gitbook/assets/получить из очереди по фильтру.png>)

Компонент получает элементы из [очереди](https://docs.primo-rpa.ru/primo-rpa/orchestrator/basics/data-queues) Оркестратора в соответствии с настроенным фильтром. Результат сохраняется в переменную. Для успешного запуска/отладки проекта должно быть установлено подключение к Оркестратору.

Этапы фильтрации: 
1. Первичная фильтрация – осуществляется на стороне Оркестратора. Элементы очереди фильтруются по всем указанным свойствам, кроме «Фильтра по значению».
2. Вторичная фильтрация – осуществляется на стороне робота. На этом этапе робот получает от Оркестратора элементы после первичной фильтрации и фильтрует их по свойству «Фильтр по значению».
3. Результат сохраняется в переменную вывода – в свойство «Элемент».

### Получить и сразу занять элементы

Обратите внимание, что в свойствах компонента есть чекбокс **Занимать**. Установка чекбокса позволяет при получении элементов сразу же извлекать их из очереди. Излекать из очереди возможно только новые элементы (статус New) – то есть те, которые еще не занял ни один робот. 

Если элемент извлечен, то другие роботы не смогут взять его в работу. Данный элемент перейдет из статуса New в статус InProgress. В дальнейшем только ваш робот сможет [изменить](https://docs.primo-rpa.ru/primo-rpa/orchestrator/basics/data-queues/items#statusy-elementa) состояние извлеченного элемента или [удалить](https://docs.primo-rpa.ru/primo-rpa/g_elements/el_basic/els_orch/els_queues/deletefromqueue) его из очереди. 

Использование компонента без чекбокса **Занимать** не изменяет статус элемента в очереди.


## Свойства
Описание общих свойств см. в разделе [Свойства элемента](https://docs.primo-rpa.ru/primo-rpa/primo-studio/process/elements#svoistva-elementa).

{% hint style="info" %}
Обязательным для заполнения является только свойство **Очередь**, остальные фильтры настраиваются выборочно.
{% endhint %}


**Процесс:** 

1. **Очередь\***  *[String]* – название очереди в Оркестраторе. Пример: `"Queque1"`.
1. **Ключ** *[String]* – натуральный ключ элемента очереди, который пользователь указывал при создании элемента. То же самое, что поле Key в модели [QueueItem](https://docs.primo-rpa.ru/primo-rpa/g_elements/el_basic/els_orch/els_queues/datatypes). Пример: `"MyKey"`.

    {% hint style="info" %}
    До версии 1.24.10 свойство **Ключ** называлось **ID**.
    {% endhint %}

1. **Фильтр** *[String]* – фильтр по метаданным элемента, указывается в виде регулярного выражения для SQL:
   * *если Оркестратор установлен с MS SQL SERVER* – следует использовать шаблоны с оператором LIKE (но без указания оператора, только шаблон).
   * *если Оркестратор установлен с PostgreSQL* – доступны функции Regexp. Пример: `"%1330\|15.07.2022%"`.
1. **Фильтр по значению** *[String]* – фильтр по значению элемента, указывается в виде регулярного выражения. Пример: `"\w+"`.
1. **Тэги** [List\<string\>] – фильтр по тегам элемента очереди. Пример: `new List\<string>( ) { "tag1", "tag2", "tag3"` }`.
1. **Логика** – настраивает логику поиска элемента по тегам. Доступные значения:
   * `Or` – будет учитываться один и более тегов. Значение по умолчанию.
   * `And` – у элемента должны быть все перечисленные теги.
1. **Получать метаданные** *[Boolean]* — получать метаданные элемента. Если параметр включен, метаданные элемента будут извлечены из Оркестратора. **Функция доступна с версии 1.24.10.**
1. **Получать тэги** *[Boolean]* — получать тэги элемента. Если параметр включен, теги элемента будут извлечены из данных очереди Оркестратора. **Функция доступна с версии 1.24.10.**
1. **Статус** – фильтр по статусу элемента очереди. Возможные значения:
   * `Any` – статус элемента не важен. Значение по умолчанию.
   * `New` – новый элемент. 
   * `In progress` – элемент извлечен из очереди определенным роботом, но еще не обработан.
   * `Success` – элемент извлечен из очереди и успешно обработан.
   * `Error` – элемент извлечен из очереди, но его обработка завершилась с ошибкой общего вида.
   * `Business Error` – элемент извлечен из очереди, но его обработка завершилась с бизнес-ошибкой.
1. **Занимать** *[Boolean]* – определяет, требуется ли извлекать из очереди полученные элементы. Возможные значения:
   * `галочка отсутствует` – элементы не нужно извлекать из очереди. Статус элементов, полученных по фильтру, не изменится. Значение по умолчанию. 
   * `галочка установлена` – будет получен только список тех элементов, которые возможно сразу извлечь из очереди для обработки вашим роботом. Такие элементы перейдут из статуса New в InProgress и станут недоступны для обработки другими роботами.
1. **Игнорировать спецполя** *[Boolean]* – определяет, следует ли включать в выборку отсроченные, просроченные и логически удаленные элементы (которые не удаляли из БД). Возможные значения:
   * `галочка отсутствует` – перечисленные элементы не войдут в выборку. Значение по умолчанию.
   * `галочка установлена` – перечисленные элементы войдут в выборку. В этом случае следует снять галочку в свойстве **Занимать**.
1. **Страница** *[Int32]* – номер страницы очереди Оркестратора, на которой находится искомый элемент. Пример: `1`.
1. **Кол-во** *[Int32]* – определяет, какое количество элементов очереди вы хотите получить. Если не заполнено, вернется 1 элемент. Пример: `10`.
1. **Только свои** *[Boolean]*  – при установке галочки будут получены только те элементы, которые были добавлены в очередь с идентичной учетной записи, то есть тем же роботом.
1. **Таймаут** *[Int32]* – лимит времени операции (мс). Если по истечении лимита операция не выполнена, робот закончит работу с ошибкой. Пример: `5000`.

**Вывод:**

1. **Элемент** *[List\<[LTools.Enterprise.Model.QueueItem](https://docs.primo-rpa.ru/primo-rpa/g_elements/osnovnye-elementy/orkestrator/els_queues/datatypes)\>]* – название переменной, в которую запишется список элементов очереди, полученных по фильтру.


## Только код
Ниже приведен пример использования элемента в процессе с типом **Только код** (Pure code):
  
{% tabs %}
{% tab title="C#" %}
```csharp
object ret = LTools.Enterprise.OrchestratorApp.PeekQueueByFilter(wf, "queue", id, ".name", LTools.Enterprise.Model.QueueItemStates2.Any, false, 10);
```
{% endtab %}

{% tab title="Python" %}
```python
ret = LTools.Enterprise.OrchestratorApp.PeekQueueByFilter(wf, "queue", id, ".name", LTools.Enterprise.Model.QueueItemStates2.Any, false, 10)
```
{% endtab %}

{% tab title="JavaScript" %}
```javascript
var ret = _lib.LTools.Enterprise.OrchestratorApp.PeekQueueByFilter(wf, "queue", id, ".name", _lib.LTools.Enterprise.Model.QueueItemStates2.Any, false, 10);
```
{% endtab %}
{% endtabs %}

## Дополнительно
* [Изменить статус в очереди](https://docs.primo-rpa.ru/primo-rpa/g_elements/el_basic/els_orch/els_queues/changequeueitemstate) — присваивает элементу финальный статус обработки. 
* [Удалить из очереди](https://docs.primo-rpa.ru/primo-rpa/g_elements/el_basic/els_orch/els_queues/deletefromqueue) — удаляет элемент из очереди.

