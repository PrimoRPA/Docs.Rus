# Idea Hub 25.4

Список изменений для версии 25.4, выпущенной в апреле 2025-го года.

### Импорт данных из Оркестратора без скрипта get_data

Для импорта данных из Оркестратора добавлен новый источник: SQL.

Выбрать новый источник возможно на странице [настройки контура](https://docs.primo-rpa.ru/primo-rpa/primo-rpa-idea-hub/installation/initial-setup/environments). При выборе источника `SQL` отпадает необходимость в скрипте get_data. Idea Hub по времени, настроенному в cron, будет обращаться в БД Оркестратора и забирать актуальные данные.

Настройки аналогичны другим способам получения данных: настроить время, добавить в settings.local.php креды доступа к БД оркестратора.


### Сопоставление полей Идей с созданным процессом

Добавлена возможность сопоставлять поля идей с созданным процессом.


### Права доступа к сущностям

Переработали права доступа к сущностям. Управление стало значительно более гибким. Теперь можно настроить доступы по совпадению значений в полях пользователя и целевой сущности. Можно настроить доступы к отдельным полям сущности. В т.ч. разделить кто может создавать, кто редактировать, кто только читать. 

Теперь права настраиваются для нод (типы материалов, например: /admin/structure/types/manage/process)->"Контроль доступа"->"Редактировать правила", словарей таксономии (например: /admin/structure/taxonomy/manage/areas) или полей (например: /admin/structure/types/manage/process/fields/node.process.field_ba). Форма редактирования прав везде одинаковая, может отличаться только в частных нюансах, например для полей нет возможности настраивать доступы на удаление значений, потому что сама по себе такая операция для полей не имеет смысла. 

Для того, что бы выбрать кто может настраивать, и кто видеть настройки прав доступа, необходимо выбранным ролям  (/admin/people/permissions) пользователя добавить правила: "View Primo Access Rules form" и "Edit Primo Access Rules form" соответственно. По умолчанию форму настройку правил будет видеть только суперадмин.

Изначально блок редактирования прав доступа показывает превью уже сделанных настроек. При нажатии на кнопку "Редактировать правила" раскрывается форма изменения правил. Для каждой операции правила настраиваются отдельно. При выборе "Типа правила" открываются специфические поля для такого правила. Количество типов правил планируется увеличивать по мере необходимости. Сохранять обновленные правила обязательно нажатием на кнопку "Сохранить правила" в этом блоке. Не на общую кнопку сохранить на странице. Поскольку перестроение правил доступа занимает значительное время, то после сохранения появится кнопка "Перестроить права доступа". При нажатии запустится процедура, которая обновит все доступы согласно изменениям в правилах. При этом кнопку можно не нажимать, тогда обновление правил доступа произойдёт при следующем запуске крона, а кнопка после этого исчезнет. Для каждой операции можно настроить несколько правил доступа - в таком случае доступ будет предоставляться тем пользователям, кто соответствует, хотя бы одному правилу.


**Типы правил:**
* User (Пользователь) - доступ предоставляется конкретному выбранному пользователю.
* Role (Роль пользователя) - доступ предоставляется пользователю обладающему какой-либо ролью пользователя. При в списке есть общие роли, например "Авторизованный пользователь" - такой ролью обладают по умолчанию все пользователи, авторизованные в системе, нет необходимости отдельно назначать такую роль пользователю.
* Taxonomy term by user reference (Термин таксономии выбранный для пользователя) - правило только для доступа к терминам таксономии. Доступ предоставляется пользователям у которых в выбранном поле указан данный термин, опционально можно учитывать все дочерние термины, или всё дерево терминов в котором состоит данный термин.
* SameValue (То же значение) - доступ предоставляется пользователям у которых значение выбранного поля сходится со значением выбранного поля у сущности. Опционально можно выбрать, должны ли совпасть все выбранные значения в этом поле, либо хотя бы одно значение. 

Например мы хотим, что бы к процессу был доступ у всех бизнес-аналитиков связанных с данным процессом, тогда  выбираем тип правила "SameValue" выбираем у пользователя поле "User Id", у сущности процесса Analyst (field_ba) и ставим вариант, совпадение хотя бы одного значения + добавляем что это правило действует для всех Авторизованных пользователей. 

## Исправленные ошибки

1. Добавлена возможность импортировать русские или английские панели в зависимости от текущего языка по умолчанию.
1. Исправлена ошибка с импортом поля **human_duration** для файла `process.xlsx`. Из файла удалено поле **field_duration**.
1. Исправлена ошибка, из-за которой открытие главной страницы могло завершаться ошибкой. 


### Обновления в документации

1. Обновлен раздел документации по установке Idea Hub. В статью [Настройка базы и доступов к файлам](https://docs.primo-rpa.ru/primo-rpa/primo-rpa-idea-hub/installation/linux/setting-up-access) добавлен подраздел [Обновление базы данных](https://docs.primo-rpa.ru/primo-rpa/primo-rpa-idea-hub/installation/linux/setting-up-access#obnovlenie-bazy-dannykh). Инструкция поможет установить библиотеку панелей, необходимую для корректной работы дашбордов.
1. Добавлен раздел [Дата и время](https://docs.primo-rpa.ru/primo-rpa/primo-rpa-idea-hub/about/date-format), в котором описывается использование функции `date_format()` для работы с датами и временем в формулах.





## Где найти

Primo RPA Idea Hub 25.4 доступен по [ссылке](https://disk.primo-rpa.ru/index.php/s/t9BHBjR6PP06Yax?path=%2FRelease%2FIdeaHub):
* архив `idea-hub.install.25.4.0.linux.tar` предназначен для установки с Idea Hub нуля;
* архив `idea-hub.update.25.4.0.linux.tar` предназначен для установки обновления.
