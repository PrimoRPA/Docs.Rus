# Primo Studio 1.24.1

История изменений в Primo Studio для Windows за январь 2024-го года.

## Режим Pro 

### Обновления и улучшения

#### Работа с AI

1. Появился плагин `Primo.AI.Plugin.dll` для интеграции с языковыми моделями AI (LLM GPT). На данный момент добавлена поддержка Sber GigaChat и Yandex YandexGPT. Плагин позволяет активировать поддержку чата AI в разделе настроек **[Интеграция > AI](https://docs.primo-rpa.ru/primo-rpa/primo-studio/settings#integraciya)**. Если соответствующие настройки указаны, в меню отобразится кнопка **AI запрос** для общения с выбранной языковой моделью. Кнопка появится также в меню редактора кода. 

   ![](<../../.gitbook/assets1/buttonAIchat (1).png>)

1. Опубликована библиотека **Primo.AI**, позволяющая автоматизировать работу с языковыми моделями. Первый релиз поддерживает работу с Sber GigaChat и Yandex YandexGPT. По запросу могут быть добавлены дополнительные модели. Библиотека содержит элементы:
   * GigaChat
     * [**Получить токен**](https://docs.primo-rpa.ru/g_elements/el_extra/ai/els_gigachat/el_gettoken) - получает токен GigaChat.
     * [**Вопрос в чат**](https://docs.primo-rpa.ru/g_elements/el_extra/ai/els_gigachat/el_chatmessage) - отправляет указанный вопрос в GigaChat. 
   * YandexGPT
     * [**Создать чат**](https://docs.primo-rpa.ru/g_elements/el_extra/ai/els_yandexgpt/el_chat) - создает чат с YandexGPT.
     * [**Вопрос в чат**](https://docs.primo-rpa.ru/g_elements/el_extra/ai/els_yandexgpt/el_chatmessage) - отправляет вопрос в чат с YandexGPT. Используйте этот элемент, если вам необходимо поддерживать диалог чат-бота и отправлять запросы в синхронном режиме.
     * [**Задать вопрос**](https://docs.primo-rpa.ru/g_elements/el_extra/ai/els_yandexgpt/el_instruct) - задает вопрос YandexGPT. Используйте этот элемент, если ваш вопрос не требует срочного ответа и, следовательно, можно отправить запрос в асинхронном режиме. В асинхронном режиме генерация текста займет больше времени, но ответ будет качественнее и дешевле.

#### Библиотека Primo.Collections

1. Опубликована библиотека **Primo.Collections** для автоматизации действий с таблицами. Библиотека добавляет набор элементов в группу **Данные > Таблицы**, а именно:
   * [**Построить таблицу**](https://docs.primo-rpa.ru/g_elements/el_extra/els_collections/els_data_tables/build) - создает таблицу на основе данных, указанных в Мастере. Результат сохраняется в переменную типа DataTable.
   * [**Соединить таблицы**](https://docs.primo-rpa.ru/g_elements/el_extra/els_collections/els_data_tables/join) - производит объединение двух таблиц по указанным столбцам.
   * [**Изменить значение**](https://docs.primo-rpa.ru/g_elements/el_extra/els_collections/els_data_tables/updaterowitem) - обновляет значение строки в таблице DataTable в соответствии с указанным столбцом. 
   * [**Получить значение**](https://docs.primo-rpa.ru/g_elements/el_extra/els_collections/els_data_tables/getrowitem) - извлекает значение строки из таблицы DataTable в соответствии с указанным столбцом.
   

#### Элементы

1. В группу элементов **Приложение Word** добавлен компонент **Получение фигур**. С его помощью можно узнать название, расположение и цвет заливки фигур в документе. Данные могут пригодиться для автоматизации обработки пользовательских форм.

   ![](<../../.gitbook/assets1/word-get-shapes.png>)

1. У элемента [**Открыть браузер**](https://docs.primo-rpa.ru/primo-rpa/g_elements/el_basic/els_browser/el_browser_open) появилось свойство **Состояние загрузки**. Теперь возможно определить ожидаемый статус загрузки веб-страницы - переход к первому элементу в контейнере будет осуществлен только при указанном статусе. Если страница не загрузится в установленный таймаут, возникнет ошибка. Доступные значения:
   * *None* - не ждать загрузки страницы. Используется для обратной совместимости, установлено по умолчанию. 
   * *Interactive* - система будет ждать загрузки страницы и построения DOM-дерева, но дополнительные ресурсы могут продолжать загружаться. Например, изображения, `<iframe>`.
   * *Complete* - ждать полной загрузки веб-страницы, указанной в контейнере.
1. Улучшена производительность элемента **Прочитать таблицу** (Браузер) при работе с таблицами в несколько тысяч строк. Изменение не затрагивает работу одноименного браузерного элемента из Поколения 1.
1. Для элементов SAP [**Эмуляция спецкнопки**](https://docs.primo-rpa.ru/primo-rpa/g_elements/el_basic/els_sap/el_sap_hotkey) и [**Ввод текста**](https://docs.primo-rpa.ru/primo-rpa/g_elements/el_basic/els_sap/el_sap_input) добавлено свойство **Строгий тайм-аут**. Настройка позволяет незамедлительно прерывать выполнение элемента по истечении таймаута.

#### Импорт RPA-проектов

1. Для элементов MS Excel при миграции стал добавляться контейнер **Приложение Excel**. В контейнере заполнены необходимые свойства, такие как путь к файлу, пароль, если имеется. 
1. В элементах MS Excel **Чтение диапазона** и **Запись диапазона** переменная типа DataTable стала переноситься в свойство **Переменная (таблица)**. Ранее она мигрировала в текстовую переменную. 
1. Улучшен импорт элемента **[Try-Catch](https://docs.primo-rpa.ru/primo-rpa/g_elements/el_basic/els_logic/el_logic_trycatch)**. Если в импортируемом **Try-Catch** присутствует разделение на типы исключений в блоке **Cath**, то при миграции элемента, в блоке **Cath**, появится компонент **[Switch](https://docs.primo-rpa.ru/primo-rpa/g_elements/el_basic/els_logic/el_logic_switch)** с разделением на типы исключений. Это позволит обрабатывать каждое исключение отдельно.
1. Для элемента **Исключение** стал определяться тип ошибок в соответствии с типизацией в Primo RPA Studio. А именно:
   * SystemException (UiPath) > General (Primo);
   * BusinessRuleException (UiPath) > Business (Primo);
   * ApplicationException (UiPath) > Application (Primo).
1. У активности **Try-Catch** стала переноситься переменная исключения, если в блоке **Catch** присутствует ее обработка.
1. При импорте элемента **Присвоение** значения всех строковых переменных теперь берется в двойные кавычки.
1. При переносе диаграммы, в элементе **Принятие решения** (Flow Decision), теперь не пропадает условие, а в результирующих ветвях значение берется в кавычки, если это `String`.
1. Переменные стали импортироваться без группировки. 

#### Прочее

1. Браузерное расширение `Primo RPA extension` обновлено до версии 1.61. Обновление содержит улучшения для работы с браузерными событиями и компонентом **Присутствие элемента**.
1. Улучшен выбор тестовых данных для RPA-проектов. [При создании процесса](https://docs.primo-rpa.ru/primo-rpa/primo-studio/process#kak-sozdat-process) появилась возможность указать рабочий лист файла Excel, а также конкрентные строки и столбцы. Если не указывать значение, то по умолчанию будет выбран первый лист и все его данные.

   ![](<../../.gitbook/assets1/test-case-in-process.png>)

1. Улучшена работа отладчика чистого кода `v2`:
   * Добавлена поддержка статических членов класса.
   * Добавлена поддержка абстрактных членов класса.
   * Добавлена поддержка однострочных операторов.
1. Появилась возможность закомментировать **Последовательность** при помощи пункта контекстного меню. Изменение не предназначено для последовательности верхнего уровня.


### Исправленные ошибки 

#### Новый редактор шаблона поиска

1. Исправлена работа функции **Путь до элемента** в редакторе шаблона поиска. Теперь, если пользователь вносит корректировки в параметры шаблона, то путь до элемента в дереве шаблона изменяется динамически. 
1. Исправлены ошибки в работе нового шаблона с Java-приложениями и плагином **Java**. Ранее заголовок окна приложения и тип рабочего стола определялись некорректно.
1. Исправлена ошибка, когда при смене текущего селектора удалялись родительские либо дочерние селекторы.
1. Исправлена ошибка, когда на попытку удалить дочерний или родительский селектор Студия показывала ошибку и зависала. Проблема возникала при работе с веб-браузером. 
1. Исправлена ошибка в шаблоне дочернего элемента, связанная с некорректным значением свойства ContainerID. Ошибка могла возникать при переносе элемента с шаблоном из одного контейнера в другой. 
1. Устранен сброс параметров в шаблоне поиска, если элемент с шаблоном был перемещен или скопирован в контейнер.
1. Решена проблема с обновлением селектора при попытке перевыбрать элемент управления в выпадающем списке.



#### Элементы
1. Исправлены ошибки в работе элементов из группы **Браузер > События**. Чтобы изменения применились, обязательно обновите расширение браузера до версии 1.61. Список исправленных элементов:
   * **Клик элемента**;
   * **Событие изменения аттрибута**;
   * **Событие кнопки браузера**.
1. Исправлена работа событий в параллельном режиме. Ранее возникала ошибка при попытке присвоить переменные в параллельных потоках. 
1. Исправлена работа элементов **Удаление колонок** (Excel) и **Удаление строк** (Excel) в чистом коде.
1. Исправлена ошибка в **Чтении диапазона** (Excel) с чекбоксом **Учитывать типы полей ячеек Excel** и драйвером Interop. Диапазон не считывался, если первая его ячейка была пустой.
1. Решена проблема, возникавшая при обработке аргументов SQL-запроса в цикле.  
1. Исправлена работа контейнера **Документ Word** с макросами и драйвером interop. 
1. Исправлена ошибка в работе элемента **Повтор исключения**, связанная с обновлением метки времени.



#### Зависимости
1. Устранена утечка памяти при работе с зависимостями. Теперь при запуске проекта, в папке `AppData/Local/Temp` пользователя, будет создаваться папка типа GUID с зависимостью. Она будет автоматически удаляться в одном из случаев:
   * после начала выполнения проекта;
   * после выполнения проекта;
   * при следующем запуске проекта.
1. Исправлено некорректное поведение элементов в пакете [Primo.Office.MyOffice](https://www.nuget.org/packages?q=Primo.Office.MyOffice). Версия пакета обновлена до 1.0.2. 


#### Отладка
1. Исправлена ошибка, из-за которой робот-отладчик не мог выйти из подпроцесса, если в элементе **Ссылка на процесс** не было включено кеширование. Ошибка воспроизводилась при наличии в подпроцессе элемента **Try-Catch**, в котором возникало исключение. С этой версии состояние кеширования подпроцесса не влияет на его работу.
1. Исправлена ошибка, из-за которой отображался пустой экран Excel после успешного завершения отладки. 
1. Исправлена ошибка, из-за которой отладка не продолжалась при возникновении исключения в элементе **Параллельные потоки**.
1. Решена проблема с сохранением точек останова в разных типах процессов.


#### Работа с Оркестратором
Исправлена ошибка в методах обращения к Оркестратору, которые робот использует при работе с ресурсами (assets). 

#### Робот
1. Решена проблема с запуском Primo Robot Runner из папки Студии.
2. Исправлено отображение версии Primo Robot Runner в меню **Файл > О программе**. Теперь версия утилиты совпадает с версией установленной Студии.


#### Прочее
1. Исправлено некорректное отображение элементов зависимости на панели:
   * после обновления версии зависимости элементы могли дублироваться;
   * после удаления зависимости из проекта на панели продолжали отображаться ее элементы.
1. Исправлена ошибка, возникавшая при совпадении имен переменной и аргумента в процессе и подпроцессе. 
1. Решена проблема, из-за которой элемент **Ссылка на процесс** некорректно работал при добавлении в файл `*.ltw`, открытый через поиск (CTRL+F). 
1. Исправлена некорректная передача строки специальной конфигурации (RunConfigCustom) при запуске процесса из Студии.


## Режим Citizen

1. Стало удобнее работать с элементом **Запустить приложение**:
   * Ранее исполняемый файл приходилось указывать текстом, теперь появилась возможность выбирать его в Проводнике Windows.
   * Поле **Аргументы** перенесено в свойства элемента.

   ![](<../../.gitbook/assets1/run-app-citizen.png>)

1. Исправлен перебор строк в Excel. Теперь элемент **Перебрать строки диапазона Excel** с включенным параметром **Имеет заголовки** работает корректно.
1. Исправлена ошибка в элементе **Прочитать таблицу**.
1. Исправлена работа элементов **Ответить на сообщение / Переслать сообщение**. Ошибка возникала при использовании свойств **Новая тема** и **Текст**.
1. Исправлена ошибка, из-за которой нажатие на значок выбора значений в поле элемента было безрезультативным.  
1. Исправлена некорректная работа команды контекстного меню **Закомментировать элементы**.


## Где найти
[Скачать дистрибутив Primo RPA Studio Enterprise](https://disk.primo-rpa.ru/index.php/s/primo?path=%2FRelease%2FStudio).

[Скачать дистрибутив Primo RPA Robot](https://disk.primo-rpa.ru/index.php/s/primo?path=%2FRelease%2FRobot):
* **Primo RPA Robot 1.24.1** - предназначен для установки на локальной рабочей станции. Выступает в роли цифрового ассистента пользователя. Дистрибутив поставляется в разрядности x64 и x86.
* **Primo RPA Robot Orchestrator 1.24.1** - предназначен для автоматической установки Оркестратором. Дистрибутив поставляется в разрядности x64 и x86.
