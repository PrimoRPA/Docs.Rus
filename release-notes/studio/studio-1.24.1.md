 # Primo Studio 1.24.1

Раздел содержит описание изменений для версии приложения Primo Studio 1.24.1, выпущенной в январе 2024-го года. Изменения касаются приложения, работающего на операционной системе Windows.

## Изменения и улучшения

Ниже описаны изменения для издания Primo RPA Studio Enterprise 1.24.1.

### Библиотеки и плагины
1. Реализована библиотека **Primo.AI** для интеграции с GigaChat и YandexGPT. Она добавляет группы элементов:

   ![](<../../.gitbook/assets1/>)

   * GigaChat с элементами:
     * **Получить токен** - .
     * **Вопрос в чат** - . 
   * YandexGPT с элементами:
     * **Создать чат** - .
     * **Вопрос в чат** - .
     * **Задать вопрос** - .

при публикации проекта в орке токен можно из ассета, например, брать. где хошь. схема похожая с яндексвижн. 

1. Реализован плагин `Primo.AI.Plugin.dll`. Если его скопировать в папку Студии, то в настройках появится раздел интеграций с AI. Если там проставить все настройки, то в меню появится кнопка AI запрос. По нажатию откроется чат с выбранной в настройках AI. В редакторе кода тоже появится кнопочка для чата, где можно попросить пример какого-то кода на указанном языке.
Открываем Файл > Настройки > Интеграция > AI. Активируем чек-бокс **Использовать AI**. После установки пакета на панели элементов станут доступны группы GigaChat и YandexGPT.

В этом разделе чек-бокс, включающий поддержку чатов и переключатель движков GPT
Выбирая движок в переключателе отображаются настройки выбранного движка
Если включить чек-бокс, в риббоне Студии в закладке Общие появится кнопка "AI запрос"
При нажатии на кнопку появится окно чата, где можно задавать вопросы и получать ответы/

Для проверки работы чата необходимо создать аккаунты согласно вложенной инструкции (аккаунт - это твой токен. У яндекса токен больше суток живет, у сбера только час. именно поэтому для сбера запилили отдельный элемент "Получить токен"). После указания необходимых значений в настройках, в чате будут приходить ответы на вопросы. Если данные не указаны/данные неверны - будет отображаться ошибка "Response status code does not indicate success: 401 (Unauthorized)."

ОР : Активировать поддержку чатов AI можно посредством чек-бокса "Использовать AI" в настройках - Интеграция. При включенном чек-боксе отображается кнопка "AI запрос" (закладка "Общие" на панели меню Студии), а также отображается кнопка AI chat Изображение в формах редактирования текста для быстрого доступа.


   ![](<../../.gitbook/assets1/>)

1. Реализована библиотека **Primo.Collections**. Она добавляет 4 новых элемента в группу Данные > Таблицы:
   * **Построить таблицу** - .
   * **Соединить таблицы** - .
   * **Получить значение** - .
   * **Изменить значение** - .


### Элементы

1. У элементов [**Отправить сообщение**](https://docs.primo-rpa.ru/primo-rpa/g_elements/el_basic/els_outlook/el_outlook_sendmail) (Outlook) и [**Отправить сообщение**](https://docs.primo-rpa.ru/primo-rpa/g_elements/el_basic/els_mail/els_exchange/el_send) (Exchange) появилось опциональное свойство **От имени (отображаемое имя)**. Теперь пользователь может указать имя отправителя письма для ящика из свойства **От имени (адрес)**. Функциональность призвана улучшить отправку писем с общих почтовых ящиков.

   ![](<../../.gitbook/assets1/outlook-new-parameter.png>)
 
1. В группу элементов *Приложение Word* добавлен компонент **Получение фигур**. С его помощью можно узнать название, расположение и цвет заливки фигур в документе. Данные могут пригодиться при автоматизации обработки пользовательских форм.

   ![](<../../.gitbook/assets1/word-get-shapes.png>)

1. У элемента [**Открыть браузер**](https://docs.primo-rpa.ru/primo-rpa/g_elements/el_basic/els_browser/el_browser_open) появилось свойство **Состояние загрузки**, определяющее ожидаемый статус загрузки веб-страницы. Теперь переход к *первому элементу* в контейнере будет осуществляться только при указанном состоянии загрузки. Если страница не успеет загрузиться в установленный таймаут, робот завершит работу с ошибкой. Возможные значения:
   * *None* - не ждать загрузки страницы. Значение используется для обратной совместимости и установлено по умолчанию. 
   * *Interactive* - система будет ждать загрузки страницы и построения DOM-дерева, но дополнительные ресурсы могут продолжать загружаться. Например: изображения, `<iframe>`.
   * *Complete* - ждать полной загрузки веб-страницы, указанной в контейнере.
1. Улучшена производительность элемента **Прочитать таблицу** (Браузер) при работе с таблицами в несколько тысяч строк. Изменение не затрагивает работу одноименного браузерного элемента из Поколения 1.
1. Для элементов SAP [**Эмуляция спецкнопки**](https://docs.primo-rpa.ru/primo-rpa/g_elements/el_basic/els_sap/el_sap_hotkey) и [**Ввод текста**](https://docs.primo-rpa.ru/primo-rpa/g_elements/el_basic/els_sap/el_sap_input) добавлено свойство **Строгий тайм-аут**. Настройка позволяет незамедлительно прерывать выполнение элемента по истечении таймаута.


### Импорт RPA-проектов
1. Для элементов MS Excel при миграции стал добавляться контейнер **Приложение Excel**. В контейнере заполнены необходимые свойства, такие как путь к файлу, пароль, если имеется. 
1. В элементах MS Excel **Чтение диапазона** и **Запись диапазона** переменная типа DataTable стала переноситься в свойство **Переменная (таблица)**. Ранее она мигрировала в текстовую переменную. 
1. Улучшен импорт элемента [Try-Catch](https://docs.primo-rpa.ru/primo-rpa/g_elements/el_basic/els_logic/el_logic_trycatch). Если в импортируемом **Try-Catch** присутствует разделение на типы исключений в блоке **Cath**, то при миграции элемента, в блоке **Cath**, появится компонент [Switch](https://docs.primo-rpa.ru/primo-rpa/g_elements/el_basic/els_logic/el_logic_switch) с разделением на типы исключений. Это позволит обрабатывать каждое исключение отдельно.
1. Для элемента **Исключение** стал определяться тип ошибок в соответствии с типизацией в Primo RPA Studio. А именно:
   * SystemException (UiPath) > General (Primo);
   * BusinessRuleException (UiPath) > Business (Primo);
   * ApplicationException (UiPath) > Application (Primo).
1. У активности **Try-Catch** стала переноситься переменная исключения, если в блоке **Catch** присутствует ее обработка.
1. При импорте элемента **Присвоение** значения всех строковых переменных теперь берется в двойные кавычки.
1. При переносе диаграммы, в элементе **Принятие решения** (Flow Decision), теперь не пропадает условие, а в результирующих ветвях значение берется в кавычки, если это `String`.
1. Переменные стали импортироваться без группировки. 



### Другое
1. Улучшен выбор тестовых данных для RPA-проектов. Теперь [при создании процесса](https://docs.primo-rpa.ru/primo-rpa/primo-studio/process#kak-sozdat-process) возможно указать рабочий лист файла Excel, а также конкрентные строки и столбцы. Если не указывать значение, то по умолчанию будет выбран первый лист и все его данные.

   ![](<../../.gitbook/assets1/test-case-in-process.png>)

1. Улучшена работа отладчика чистого кода `v2`:
   * Добавлена поддержка статических членов класса.
   * Добавлена поддержку абстрактных членов класса.
   * Добавлена поддержка однострочных операторов.
1. Появилась возможность закомментировать **Последовательность** не верхнего уровня при помощи пункта контекстного меню. 



///Оптимизирована ...устранена утечка памяти...в папке `AppData/Local/Temp` пользователя.Забивается место в папке `AppData/Local/Temp` пользователя. Выяснилось, что в AppData/Local/Temp робот копирует каждый раз библиотеки, и не удаляет их затем. В итоге, за 3 дня роботы съедают таким образом 500Гб. Папка Primo.Studio в temp не очищается для проектов с зависимостями, что приводит к заполнению свободного места диска.

ОР: Ожидается, что робот не будет копировать библиотеки в папку AppData/Local/Temp каждый раз при выполнении задачи. Предполагается, что робот будет использовать уже скопированные библиотеки, если они доступны, чтобы избежать повторного копирования и сохранить дисковое пространство.






## Исправленные ошибки 

### Новый редактор шаблона поиска

1. Исправлена работа функции **Путь до элемента** в редакторе шаблона поиска. Теперь, если пользователь вносит корректировки в параметры шаблона, то путь до элемента в дереве шаблона изменяется динамически. 
1. Исправлены ошибки в работе нового шаблона с Java-приложениями и плагином **Java**. Ранее заголовок окна приложения и тип рабочего стола определялись некорректно.
1. Исправлена ошибка, когда при смене текущего селектора удалялись родительские либо дочерние селекторы.
1. Исправлена ошибка, когда в ответ на попытку удалить дочерний или родительский селектор Студия показывала ошибку и зависала. Проблема возникала при работе с веб-браузером. 

### Элементы
1. Исправлены ошибки в работе элементов из группы **Браузер > События**, а именно:
   * **Клик элемента**;
   * **Событие изменения аттрибута**;
   * **Событие кнопки браузера**.

   Чтобы изменения применились, обновите расширение браузера до версии 1.61.
1. Устранена ошибка в работе событий в параллельном режиме. Ошибка возникала при попытке присвоить переменные в параллельных потоках. 
1. Исправлена некорректная работа элементов **Удаление колонок** (Excel) и **Удаление строк** (Excel) в чистом коде.
1. Исправлена ошибка в **Чтении диапазона** (Excel) с чекбоксом **Учитывать типы полей ячеек Excel** и драйвером Interop. Диапазон не считывался, если первая его ячейка была пустой.
  
### Зависимости
1. Устранена утечка памяти при работе с зависимостями. Теперь при запуске проекта, в папке `AppData/Local/Temp` пользователя, будет создаваться папка типа GUID с зависимостью. Она будет автоматически удаляться в одном из следующих случаев:
   * после начала выполнения проекта;
   * после выполнения проекта;
   * при следующем запуске проекта.
1. Исправлено некорректное поведение элементов в пакете [Primo.Office.MyOffice](https://www.nuget.org/packages?q=Primo.Office.MyOffice). Версия пакета обновлена до 1.0.2. 


### Отладка
1. Исправлена ошибка, из-за которой робот-отладчик не мог выйти из подпроцесса, если в элементе **Ссылка на процесс** не было включено кеширование. Ошибка воспроизводилась при наличии в подпроцессе элемента **Try-Catch**, в котором возникало исключение. С этой версии состояние кеширования подпроцесса не влияет на его работу.
1. Исправлена ошибка, из-за которой после успешного завершения отладки мог отображаться пустой экран Excel. 
1. Исправлена ошибка, из-за которой отладка не продолжалась после возникновения исключения в элементе **Параллельные потоки**.

### Работа с Оркестратором
Исправлена ошибка в методах обращения к Оркестратору, которые робот использует при работе с ресурсами (assets). 

### Робот
1. Исправлена ошибка, из-за которой Primo Robot Runner не запускался из папки Студии.
2. Исправлено отображение версии Primo Robot Runner в меню **Файл > О программе**. Теперь отображаемая версия совпадает с версией установленной Студии.


### UI
Исправлено некорректное отображение элементов зависимости на панели элементов:
* после обновления версии зависимости элементы могли дублироваться;
* после удаления зависимости из проекта на панели продолжали отображаться ее элементы.


