# Primo RPA Orchestrator 1.25.1

Данный документ описывает изменения, улучшения и исправления ошибок, внесенные в релиз **Primo RPA Orchestrator 1.25.1** за январь 2025 года.


## Обновления и улучшения 


1. Добавлена функция **управления RDP-сессиями через трансляцию**.  
   - Ранее доступна была только трансляция, теперь добавлено полноценное управление, что расширяет возможности работы с удалёнными сессиями.  
   - **Функции управления:** ввод текста на латинице, кириллице, числовых значений и символов, а также выполнение операций, таких как создание файлов, поиск в браузере и другие действия.  
   - **Включение стрима по запросу:**  
     - При запуске RDP2 стрим отключён для всех сессий.  
     - При запросе просмотра экрана клиент RDP автоматически перезапускается с включённым стримом, передавая изображение рабочего стола в браузер.  
     - После закрытия браузерной вкладки или нажатия кнопки "Стоп" клиент RDP автоматически перезапускается с отключённым стримом.  
   - Управление и трансляция доступны через службу **RDP2** (Windows, Linux, Linux с внешним клиентом) и **NGINX**.
  
1. Обновленный инсталлятор теперь выполняет полный процесс установки Оркестратора, включая настройку PowerShell, PostgreSQL и RabbitMQ, всего **за 3 минуты**.

1. Добавлена автоматическая генерация токенов, что исключает необходимость указания учетных данных в конфигурациях служб (WebApi, RobotLogs, RDP2, Analytic, Agent)

1. Обновлена логика отображения кнопок **"Остановить все"** и **"Запустить все остановленные"** в Оркестраторе:
   - Теперь видимость кнопок определяется только у пользователей, которым администратор назначил соответствующие права.
   - Для встроенных ролей **Администратор** и **Администратор тенанта** права на эти операции предоставлены по умолчанию.
   - Добавлены события в журнал Оркестратора для логирования массовых операций: 
      - **"Старт остановки всех запущенных заданий"**.
      - **"Старт возобновления всех ранее остановленных заданий".**
   - Логируются также события о конкретных заданиях, остановленных или возобновленных в результате массовых операций.
   - Для защиты от случайного нажатия на кнопки добавлены модальные окна с подтверждением операции.

1. Добавлена поддержка авторизации через KeyCloak. KeyCloak — это инструмент для управления аутентификацией и авторизацией, обеспечивающий централизованное управление доступом к приложениям и сервисам. Он поддерживает современные протоколы безопасности, такие как OpenID Connect и OAuth 2.0.
   Реализованы два режима авторизации:  
      - **Упрощенный поток**  
      - **Поток с PKCE (Proof Key for Code Exchange)**  

   Для пользователей с интеграцией KeyCloak в форме авторизации отображаются кнопки с соответствующими подсказками. Авторизация выполняется корректно, включая назначение и управление ролями в зависимости от выбранного режима. Подробнее о настройке и использовании авторизации через KeyCloak см. в [официальной документации KeyCloak](https://www.keycloak.org/documentation).

1. В записи журнала Оркестратора добавлен параметр `CorrectSignature`, указывающий на корректность сигнатуры события и  проверку целостности данных. Значение `true` подтверждает, что данные события не изменены, а `false` сигнализирует о возможном нарушении их целостности.

1. Добавлено ограничение количества писем в email-триггере **(IMAP)**. Ранее такая функциональность была доступна только для POP3 и Exchange. Теперь в UI можно задать лимит писем, обрабатываемых за одно срабатывание триггера.
1. Из конфигурации WebApi удалены строки подключения к *ltoolslogs*. Запросы к логам робота и Оркестратора теперь перенаправляются через службу RobotLogs для корректного отображения архивных и новых записей.

1. Обновлены методы `v2/GetByName2` и `v2/SetByName2` для корректной проверки и обработки состояния блокировки ресурсов.

1. Добавлена информация о принудительных **(Hard Kill)** и мягких **(Soft Kill)** остановках робота в журнале операций. Теперь для таких остановок отображаются дата окончания операции и результат завершения.



### Обновления и улучшения (Agent, Notifications и RobotLogs)


1. Исправлено отображение данных производительности (загрузка процессора, диска и памяти) для **Linux**-агентов. Теперь метрики производительности обновляются корректно и соответствуют фактической нагрузке.
1. Улучшена работа службы Notifications: добавлены параметры `RetryCount` и `RetryTimeOutInSeconds`, которые позволяют службе дождаться запуска RabbitMQ, предотвращая её падение при задержке запуска очередей.
1. Реализована буферизация событий в RobotLogs. Добавлена массовая вставка событий в таблицу OrchEvents, что снизило количество обращений к базе данных.
1. Для очередей службы LogEventsWebhook добавлен обменник типа `fanout`. Теперь имеется возможность запустить несколько экземпляров службы **LogEventsWebhook** каждый со своей очередью.


 
## Исправленные ошибки

1. Удалена избыточная трансляция удаленных сессий в RDP2, что уменьшает нагрузку на системные ресурсы.
1. Обновлены службы обработки состояний роботов для корректной работы в сценариях, когда робот находится в состоянии таймаута на момент запуска Оркестратора. Это исключает блокировку роботов, если отключение Оркестратора превышало заданный таймаут в конфигурации.
1. Исправлена проблема зависания роботов в Оркестраторе при "жёсткой" остановке, повторном автостарте из очереди и снятии проекта. Добавлена очистка трекинга робота при релизе лицензии по таймауту для предотвращения некорректных статусов.
1. Исправлена ошибка удаления элементов из очереди с флагом **Физическое удаление (Physical Removal)**:
   Элементы со статусами *New*, *Success*, *Error* и *BusinessError* теперь корректно удаляются после прочтения и извлечения через активность *"Удалить из очереди"* в Primo RPA Studio, а также через UI Оркестратора и API.       Удаляются все связанные артефакты элемента, включая события, теги и метаданные из таблиц *ExchangeQueueValueEvents*, *ExchangeQueueValueTags* и *ExchangeQueueValueMeta*.

1. Исправлена ошибка обработки повторного добавления RPA-проекта в очередь при активированной настройке **«Не повторять в очереди проектов»** — теперь вместо **500 Internal Server Error** сервер возвращает корректный код **403 Forbidden**, указывающий на запрет повторного добавления.
1. Исправлена ошибка, появляющаяся в Оркестраторе при публикации проектов из Студии. Ранее проект публиковался и отображался в списке всех проектов, но сопровождался ошибкой. Теперь публикация выполняется корректно, без отображения ошибок.
1. Устранена ошибка, из-за которой сбрасывалась привязка роботов к проекту при добавлении новой версии. Теперь при добавлении новой версии проекта автоматически сохраняются привязанные роботы активной версии, а не версии v0, как это происходило ранее.
1. Исправлена ошибка в работе триггера "Запуск при изменении папки" на машинах роботов. Триггер не срабатывал при добавлении файла в указанную папку из-за отсутствия значений по умолчанию в конфигурации агента. Теперь значения по умолчанию для секции Triggers автоматически применяются, если секция отсутствует в конфигурации.
1. Исправлены ошибки, связанные с доменными учётными записями: 
   - Устранена ошибка с уникальным индексом `IX_AdUserCredentials_UserName`, возникавшая при повторном добавлении удалённого пользователя. 
   - Обеспечено корректное использование актуальных данных логина и пароля для запуска RDP-сессий.

1. Из компонентов Оркестратора ( WebApi, Agent, MachineInfo) удалена библиотека **CliWrap** для оптимизации дистрибутива и устранения лишних зависимостей. Файл `CliWrap.dll` больше не включён в сборки для Windows и Linux.

1. Доработана автономизация сервиса RobotLogs. Удалены параметры настройки тенантов из конфигурации RobotLogs для упрощения настройки и поддержки.
1. Исправлена некорректная установка времени следующего запуска для заданий, согласованных с производственным календарем. Теперь расписания автоматически обновляются при изменении производственного календаря.
1. Исправлена ошибка с фильтрацией по признаку "Ошибка" на вкладке Запуски.

1. Исправлена некорректная работа команды "Перезагрузка машины" робота в Оркестраторе.

1. Исправлена ошибка, из-за которой NuGet-сервер не записывал логи. В проект добавлена поддержка асинхронного логирования с использованием пакета Serilog.Sinks.Async. Теперь при запуске службы логи корректно записываются.
1.Исправлена ошибка, из-за которой при обновлении службы NuGet  возникали проблемы с миграцией данных при использовании схемы, отличной от public. Теперь миграция данных выполняется корректно.

1. Исправлена работа кнопки "Скопировать подключение к теневой" для доменных пользователей (AD). Теперь строка подключения корректно копируется в буфер обмена для всех типов пользователей, включая локальных и доменных.




## Обновления и улучшения веб-интерфейса 2.23.0
 
 1. Навигация в главном меню изменена: 
   -Добавлен раздел **Аналитика**  в главное меню, в него перенесены отчеты, ранее находившиеся во вкладке "Отчеты" (бывшая часть раздела "Журнал").  
   -В разделе **"Журнал"** теперь отображаются вкладки:  
      - "События оркестратора"  
      - "Оркестраторные роботы" (ранее раздел "Мониторинг")  
      - "Клиентские роботы" (перенесено из главного меню, наименование сохранено)  
   -Предыдущие вкладки раздела "Журнал" изменены на фильтры:  
      - "Все события оркестратора" переименован в "Все события".    
      - "Ошибки" переименованы в "Ошибка".  
   -Фильтры "Информационное," "Ошибка," "Инцидент безопасности," "Корректировка" перенесены в панель фильтрации под полями "Дата события," "Тип события," "Код операции," "Пользователь".  

1. На странице «Аналитика» добавлена панель «Отчёты в Grafana».
1. В настройках триггера «Запуск при получении Email» добавлен чекбокс «Оповестить автора(ов) письма». При активации этого чекбокса включается проверка наличия значения в поле «От».
1. Добавлена возможность автоматического применения настройки "Не повторять в очереди проектов" для всех новых проектов. Теперь настройка по умолчанию активирована на форме добавления RPA-проекта, исключая необходимость её ручного включения для каждого проекта.
1. В разделе "Роботы" на вкладке "Ресурсы" (Assets) добавлены столбцы "Дата создания," "Дата обновления," и "Дата прочтения" для отображения активности ресурсов. Данные автоматически синхронизируются с базой `ltools` (таблица `Assets`) и обновляются при создании, изменении или использовании ресурса роботом.
 
1. Добавлена возможность добавлять в метаданные в поле "Ключ" пустое значение.
Теперь такие ключи сохраняются в базе данных, отображаются в UI с пометкой "Пустое значение", а при просмотре значение ключа корректно отображается как "" без задвоений. 

1. В разделе RPA-проекты добавлено отображение учетной записи, от имени которой опубликован или загружен проект.
Учетная запись отображается под датой в столбце "Дата создания"
 
1. На странице Роботы добавлена кнопка "Теги робота": при активации чек-бокса нужного робота в панели меню появляется возможность добавлять и удалять теги. В таблице роботов теперь отображаются все присвоенные теги, также добавлен фильтр для отбора роботов по одному или нескольким тегам.

1. На вкладке "Машины роботов" добавлена возможность назначения тегов с отображением имени и даты создания тега, а также фильтрация по тегам с режимом одновременной фильтрации по нескольким тегам.

1. Добавлена возможность удалять приоритет в формах создания и редактирования проекта. Новый проект по умолчанию создаётся со средним приоритетом.

1. На странице "RPA-проекты" добавлена кнопка "Скачать в CSV" для экспорта данных.
1. Улучшена фильтрация данных:
    - На вкладке **«Все роботы»** добавлена фильтрация по разрядности (**X86**, **X64**).  
    - На странице **«Оркестраторные роботы»** добавлена фильтрация по диапазону дат.
    - На странице **«Запуски»** при активации фильтра **«Архив»** отображается общий счетчик элементов, при выборе дополнительных фильтров — количество отфильтрованных записей.  
    - В столбец **«Результат»** добавлены статус и дата события для принудительно остановленных запусков.  

1. Добавлена возможность управления столбцами таблицы в разделе "События" UI Оркестратора.
Теперь пользователи могут настраивать отображение столбцов, скрывать ненужные и регулировать их ширину. Настройки сохраняются в local storage и базе данных (при активной настройке "KeepLocal": false в конфиге WebApi) и остаются неизменными после обновления страницы, перехода между вкладками или перезапуска браузера. Данные о пользовательских настройках записываются в таблицу UserUISettings базы данных ltools.

1. Добавлено уведомление при загрузке страницы NuGet в Оркестраторе. Теперь при переходе во вкладку NuGet через 2–3 секунды появляется уведомление с предупреждением, , если NuGet сервис не настроен. При корректной настройке сервиса уведомление не отображается, и загружается список пакетов. Инструкции по настройке сервиса описаны в [документации](https://docs.primo-rpa.ru/primo-rpa/orchestrator/settings/nuget#upravlenie-paketami).

 
1. Добавлен параметр `tenantId` к URL на страницах "Все роботы", "Завершенные роботы", "RPA-проекты" и "Логи".

1. Добавлены фильтры для раздела "Ресурсы" в Оркестраторе. Пользователи теперь могут фильтровать ресурсы по описанию, типу данных, параметру "Только для чтения", роботу и блокировке, а также видеть количество отфильтрованных элементов в верхней части таблицы.

1. Добавлены подсказки и обновлены значения для поля "Тип блокировки" в формах добавления/редактирования ресурсов.
1. Во вкладках "Ресурсы" и "Все RPA-проекты" уменьшена ширина полей. Поля адаптируются к изменению масштаба в браузерах Google Chrome, Mozilla Firefox и Microsoft Edge.

1. В форму создания/редактирования задания с триггером по Email добавлено поле «Ресурс» с выпадающим списком доступных ресурсов типа jObject. Исправлена фильтрация списка, теперь отображаются только ресурсы соответствующего типа.
1. Чекбокс "Одновременно" теперь блокируется и автоматически сбрасывается (снимается галочка), если в списке "Тег" выбрано менее двух тегов. При выборе двух или более тегов чекбокс становится доступным.

1. 
1. В таблице с календарями изменена цветовая индикация:  
   - При выключенном флажке "Суббота и воскресенье – рабочие дни (24 x 7)" текст отображается черным цветом.  
   - При включенном флажке текст отображается красным цветом.  
   
1. Исправлена ошибка в активности **"Удалить из очереди"**, которая появлялась при удалении элементов со статусом **"success"** из очереди с включённым свойством **"Физическое удаление"**. Теперь удаление таких элементов выполняется корректно.

1. Исправлена ошибка, из-за которой было невозможно установить время запуска в повторных расписаниях.
 
1. Исправлена ошибка поиска на странице "Все роботы → Группы → Добавить робота".
Поиск в выпадающем списке теперь работает корректно, позволяя выбрать и добавить робота в группу. 

1. Исправлена проблема некорректной блокировки элементов очереди Оркестратора при множественных обращениях.

1. Исправлено некорректное отображение длинных строк в значениях формы метаданных. Теперь строки автоматически переносятся в формах создания, редактирования и просмотра элементов.

1. Исправлена проблема с некорректным отображением полного списка пользователей на вкладке "Пользователи". Теперь скролл выводится в неактивном состоянии, если список не требует перелистывания.

1. Исправлена проблема с отображением подсказки описания RPA-проекта. Теперь всплывающее описание корректно отображается под значением в ячейке столбца "Описание" независимо от длины текста.

1. Исправлена логика отображения кнопки "Аргументы" в разделе RPA-проекты:

     -Кнопка активна, если у проекта есть аргументы (`hasOutputVariable = true`), и в названии указываются направления аргументов (In, Out, InOut).
     -При наличии нескольких версий проекта отображаются аргументы, соответствующие выбранной версии.
     -Если у проекта нет аргументов, кнопка остаётся неактивной.

1. Поле "Порт" удалено из формы добавления робота. Значение *"Port"* теперь заполняется автоматически после разворачивания робота.
1. На странице "Ресурсы (ассеты)" теги перенесены в колонку "Имя" под названием ресурса, столбец "Теги" удален. При добавлении большого количества или длинных тегов высота строки автоматически увеличивается для их полного отображения.


## Где найти

Ниже приведены ссылки для загрузки дистрибутивов и получения помощи по установке.

[**Скачать Primo RPA Orchestrator**](https://disk.primo-rpa.ru/index.php/s/t9BHBjR6PP06Yax?path=%2FRelease%2FOrchestrator)
Полный архив с необходимыми файлами для установки и настройки Оркестратора

[**Скачать дистрибутив Primo RPA Robot Enterprise**](https://disk.primo-rpa.ru/index.php/s/t9BHBjR6PP06Yax?path=%2FRelease%2FRobot). 
Архивы дистрибутивов доступны в нескольких версиях, в зависимости от архитектуры вашего оборудования и операционной системы. Эти дистрибутивы предназначены для загрузки и использования непосредственно в Оркестраторе.

Если у вас возникнут сложности с установкой или использованием данной версии, пожалуйста, обращайтесь к вашему менеджеру или в [наш чат поддержки в Telegram](https://t.me/primo_RPA_chat).











