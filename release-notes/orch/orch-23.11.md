# Оркестратор 23.11

Примечания к выпуску Оркестратора 23.11 описывают изменения для версии приложения, выпущенной в ноябре 2023 года.

### Новые функции и улучшения

1. Улучшено управление RPA-проектами. Теперь для ручной постановки проекта в очередь не требуется создавать задание с ручным запуском - достаточно нажать кнопку **Поместить в очередь проектов** в разделе **RPA-проекты**. Кнопка становится активной после выбора проекта. 

   ![](<../../.gitbook/assets1/add-to-project-queue-button.png>)
 
1. Добавлена категория прав доступа, определяющая набор разрешенных операций в разделе **Настройки > Ч-Б список Студий**. Для встроенных ролей Administrator и TenantAdministrator по умолчанию разрешены все операции с Ч-Б списком, а именно: 
   * Administrator - может просматривать/редактировать/создавать/удалять сущности во всех тенантах.
   * TenantAdministrator - может просматривать/редактировать/создавать/удалять сущности только в рамках своего тенанта.

   ![](<../../.gitbook/assets1/black-white-permissions-2.png>)

1. Внесены улучшения в структуру хранения данных в базе данных. Таблица **RpaProjectLaunches**, в которой хранятся данные о запусках RPA-проектов, разделена на 2 части:
   * таблица с записями о недавних запусках - находится в основной БД (ltools);
   * таблица с записями о старых запусках - находится в БД с логами (ltoolslogs).
1. В разделе **Настройки > Email входящей почты** добавлена возможность выбрать протокол [**MS Exchange**](https://docs.primo-rpa.ru/primo-rpa/orchestrator/settings/email#ms-exchange) при создании почтового ящика. Кроме того, оптимизирована таблица почтовых адресов: вся информация по выбранным протоколам теперь содержится в едином столбце **Протокол**. 

     ![](<../../.gitbook/assets1/orch-settings-email-exchange.png>)

1. В таблице машин роботов стало легче определять доступность машины. Для этого в колонке **Доступна** были добавлены:
   * Подсветка значений. Если машина доступна, то значение подсветится зеленым. Если недоступна - красным.
   * Вывод даты тестирования доступности машины робота. В случае, если машина недоступна, отобразится дата начала недоступности.

   ![](<../../.gitbook/assets1/robot-machine-test-succeeded.png>)

1. Улучшен UI/UX страницы **Все RPA-проекты**. Если проект имеет несколько версий, и в качестве активной установлена не последняя версия, то это будет подсвечено в таблице. 

   ![](<../../.gitbook/assets1/not-last-version-project.png>)

1. В окно просмотра RDP-сессии робота добавлена функция **Скопировать подключение к теневой**. С ее помощью можно скопировать строку теневого подключения к RDP-сессии, чтобы использовать в командной строке. Функция призвана облегчить настройку теневого подключения. 

   ![](<../../.gitbook/assets1/viewing-rpd-session-copy.png>)

1. Улучшена работа с таблицей раздела **Мониторинг**. В случае, когда выбран интервал **За 30 дней** и не задан фильтр по состоянию выполнения проекта, система автоматически ограничит период выборки данных до 15-ти дней. Об этом пользователей будет информировать соответствующая подсказка, добавленная в блок фильтров. 
1. В разделе **Журнал** улучшена фильтрация событий Оркестратора по полю **Пользователь**. Добавлена возможность заполнять значение этого поля при помощи клика по логину пользователя в таблице.
1. Улучшен UX/UI раздела **Роботы > Все роботы**. При невозможности разблокировать робота система отобразит сообщение о причинах этого поведения. Например, если потеряна связь с машиной робота. 
1. Улучшено изменение приоритетов для роботов, добавленных к RPA-проекту. Реализован способ drag-and-drop - теперь изменить приоритет робота можно путем перетаскивания соответствующей строки в таблице.

1. В конфигурационном файле WebApi, в секции **ProjectQueue**, появился параметр **CleaningDepth**. Он позволяет настроить периодичность удаления данных из очереди проектов. По умолчанию установлен период 1 день. В предыдущих версиях период очистки не подлежал изменению.
   ```
   "ProjectQueue": {
    /* Удаление из таблицы RpaProjectQueue записей, старше (дней), чем текущее время */
    "CleaningDepth": 1
   }
   ```
1. На странице **Очереди обмена данными** добавлен вывод количества выделенных элементов очереди.
1. Стал проверяться формат файла в форме добавления RPA-проекта. При попытке добавить любой файл, кроме \*.zip, система выдаст ошибку. 

_______________________________________

1. (важно) UI - Новое отображение RDP-сессии.
Открытие RDP-сессии теперь может сопровождаться проверкой загрузки профиля пользователя. В таблице роботов при открытии RDP-сессии/загрузке профиля пользователя или ошибке открытия RDP-сессии/загрузки профиля пользователя отображать двойной кружек (таблица 1) в зависимости от значений полей RDPConnected, RDPUserProfileLoaded и StartError:
https://azure-dos.s1.primo1.orch/PrimoCollection/Orchestrator/_boards/board/t/Orchestrator%20Team/Stories/?workitem=4077


1. Добавлены RDP-пользователи для Linux-роботов. (послушать демо, если не понятно - к Максу)
Для UI:
Флаг Linux для пользователя RDP. В форме добавления/редактирования робота разблокировать поле RDP user для Linux-роботов.
RDP пропускает учетки для линукс-роботов (в каком контексте здесь использовано слово "пропускает"? это к Люльке).

https://azure-dos.s1.primo1.orch/PrimoCollection/Orchestrator/_boards/board/t/Orchestrator%20Team/Stories/?workitem=4052

из демо: привели и робота, и оркестратор в состояние, где они полностью рабочие. орк теперь умеет запускать линуксовых роботов.


1. Добавлены функции:
   * отключить/скрыть дефолтный тенант; В конфигурационный файл WebApi добавляется параметр Tenants. DisabledDefaultTenant, который включает/выключает дефолтный тенант.
     При выключении дефолтного тенанта: Авторизация в нем будет невозможна. В выпадающих списках выбора тенантов в Оркестраторе и Студии/Раннере дефолтный тенант будет отсутствовать.
   * отключить встроенные не технические учетные записи: admin, superadmin, studio
https://azure-dos.s1.primo1.orch/PrimoCollection/Orchestrator/_boards/board/t/Orchestrator%20Team/Stories/?workitem=9181

1. (7570) Для постгреса возможность задать схему, отличную от public (дефолтной), чтобы не создавать вручную в ней таблицу миграций. это была одна из ошибок, которая связана с миграцией на .Net7. У некоторых заказчиков эта схема отличалась от дефолтной (видимо из-за ИБ), теперь это можно настраивать в конфиге (каком?). В параметре ConnectionStrings можем прописать целевую схему, в атрибуте SearchPath (скрин приложить). Если не прописывать, то по умолчанию будет использована схема public.  


1. (7974) Использовать ограничение для потока событий триггеров + Мониторинг очереди потока событий триггеров.
    Сначала это были триггеры, которые из роботов. это было в прошлом релизе, задача 3372. Видимо, это: "Исправлена ошибка, из-за которой не получалось запустить сразу несколько роботов по триггеру «Запуск из другого робота»."
    Потом добавили и для других триггеров. В конечном итоге было много вопросов по тому, что же это такое и как настраивается. Добавлен большой раздел в рук-во админа (раздел 12.14) - ограничения версии студии? уточнить у Макса.
    чтобы самоубийство системы не происходило, был добавлен ограничитель потока. И к этому ограничению сейчас добавлен мониторинг очереди потока событий триггеров (в БД, судя по всему). Мы в базе можем смотреть, как эта очередь себя ведет - только в базе или добавлены новые события Орка, которые в UI можно глянуть?
    UI пока нет для мониторинга.Планируется в будущих релизах (упомянуть об этом). дальше смотреть в 10:39 1ч. видео (название таблицы..)
    Это очень важная метрика. Может сигнализировать об очень большой задержке обработки элементов, которые в нее попали. Всякие странные баги могут быть таки локализованы.

1. (8560) Автоматическое временное замедление очереди проектов при пиках нагрузки на машинах роботов.



### Исправленные ошибки

1. Исправлена ошибка в работе заданий с cron-строкой. Ранее, если пользователь менял cron-строку триггера, то обновленное расписание не применялось. 
1. Исправлена ошибка с повторным запуском заданий по расписанию. Ранее повторный запуск производился мгновенно, без учета времени в расписании. 
1. Исправлена ошибка запуска проекта, если в названиях его процессов содержалась кириллица.
1. Исправлена ошибка неуникальности триггера при редактировании задания. 
1. Исправлено некорректное поведение роботов при нехватке лицензий. Робот, который не успевал занять лицензию, завершал работу с ошибкой, а проект не попадал в очередь ожидания. 
1. Устранена ошибка отображения версий роботов. Для робота с ядром v1 стала отображаться версия (ранее отсутствовала), для робота с ядром v2 исправлено отображение версии в форме добавления к проекту.
1. На странице **Настройки > Машины роботов** отсутствовала возможность изменить IP-адрес в профиле машины робота. Ошибка исправлена.
1. Исправлена ошибка в форме редактирования пользователя. Ранее для поля Email отсутствовала красная звездочка, хотя это поле всегда должно оставаться заполненным.
1. Исправлено UX/UI замечание, касающееся отображения списка процессов в форме добавления проекта. Список менял свое положение при прокрутке страницы. 
1. Устранена потеря тегов при повторении элемента в очереди обмена данных.
1. Исправлена проблема с записью многочисленных ошибок в журнал Оркестратора. Проблема воспроизводилась для Оркестратора с конфигурацией Windows Server + IIS + MSSQL. 
1. Исправлена логика очистки ссылок на триггеры в таблице запусков RPA-проекта (RpaProjectLaunches) в БД.
1. Исправлена ошибка «Изменение статуса возможно только у прочитанного элемента», которая приводила к преждевременному завершению проекта. Ошибка воспроизводилась при использовании базы данных MS SQL.
1. Исправлена ошибка в постраничной навигации в журнале робота и в мониторинге. Теперь переход по страницам осуществляется корректно. 
1. Исправлено ошибочное выделение элемента очереди при клике на его значение или метаданные в таблице. 


### Где найти
1. [Скачать комплект поставки Оркестратора:](https://disk.primo-rpa.ru/index.php/s/primo?path=%2FRelease%2FOrchestrator)
    * **Primo RPA Orchestrator 1.23.11 FULL.zip** - полный комплект поставки, в который входят дистрибутивы Оркестратора и внешних компонентов: например, базы данных PostgreSQL Server, брокера сообщений RabbitMQ и др. Вес дистрибутива ~ 3,5 Гб.
    * **Primo RPA Orchestrator 1.23.11.zip** - облегченный вариант поставки, весит ~ 1,1 Гб.

2. [Скачать дистрибутив Robot Enterprise](https://disk.primo-rpa.ru/index.php/s/primo?path=%2FRelease%2FRobot). Архив должен иметь название **Primo RPA Robot Orchestrator <архитектура> 1.23.11.zip**. Дистрибутив этого робота загружается непосредственно в Оркестратор.
