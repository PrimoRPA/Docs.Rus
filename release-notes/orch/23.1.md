# Обновления в версии Оркестратора 23.1

### Новые функции

1. Добавлена системная учетная запись **superadmin**, которая имеет такие же права, как и **admin**, но в дополнение к этому может авторизовываться в любом тенанте.
1. В журнале роботов добавлен фильтр по RDP-пользователю.
1. Стал доступен асинхронный запуск команды разлогинивания. Используется опционально. 
1. Добавлено разлогинивание всех RDP-пользователей на машине робота по соответствующей кнопке в UI Оркестратора.
1. Произведена оптимизация обращения к Агенту за счет более надежного хэширования токена.
1. **Улучшения в работе с RPA-проектами**:
   * Добавлены теги для проектов.
   * Теги стали выводиться в таблице с проектами. 
   * Если у проекта есть привязка к роботам, она будет добавляться и для версии.
   * Добавлен запрос запусков для выбранного проекта. Запрос доступен по кнопке **История запусков**.
1. **Улучшения в очереди обмена данными**:
   * На странице очереди перестали учитываться удаленные элементы при подсчете общего количества записей. 
   * При постановке элемента в очередь стало возможным опционально не проверять валидность дат в свойствах `PostponeAt` и `DeadlineAt`.
   * `ReadedRobotAt` элемента очереди отдается роботу.
   * Добавлен запрос цепочки повторов по `RootId` элемента очереди, изменение запроса из UI на предмет "только корневые элементы".
   * TTL и `DeadlineAt` учитываются в запросе роботом элементов по фильтру.
1. **Улучшения в работе заданий и триггеров**:
   * Для триггера, срабатывающего при добавлении новых элементов очереди, добавлена возможность задавать период опроса очереди в минутах.
   * В триггере на добавление новых элементов очереди стали учитываться свойства элемента `PostponeAt` и `DeadlineAt`.
   * Добавлен запрос запусков для выбранного задания. Запрос доступен по кнопке **История запусков**.
   * `FiredAtNewItems` для заданий и триггеров.
1. **Улучшения при указании наименований**:
   * В именах ресурса (assets) разрешено использование кириллицы, точки и дефиса.
   * Стала разрешена точка в имени пользователя.

# 26

1. При разблокировке робота по таймауту стала учитываться дата блокировки Агентом.
1. Добавлена возможность подключения PostgreSQL по SSL-сертификату. 
1. В разделе **Все роботы** добавлена опция **Стереть робота** на недоступной машине. В результате применения команды очистятся все поля робота.
1. Добавлено отображение версии проекта в журнале операций робота. 
1. Появилась возможность опционально отключать RDP-сессию у робота при освобождении лицензии по таймауту.
1. Добавлено адресное (по UserName) разлогирование отключенных RDP-пользователей. При разлогине снимается блокировка (подстраховка на случай падения робота).
1. В Оркестратор стали передаваться сведения о состоянии робота (через KeepAliveRobot), благодаря которым можно узнать, что робот в настоящий момент запущен и работает. 
1. При принудительном завершении робота отключена проверка его состояния: выполняет ли робот проект/находится в режиме ожидания.
1. Сборка System.Text.Encodings.Web обновлена до версии 5.0.1.
1. Оптимизирована очередь проектов с соблюдением порядка, исправлена сортировка с учетом приоритета проектов.
1. Произведена оптимизация соединений с RabbitMQ, расширено логирование соединений.
1. В конфигурационном файле значение параметра `HardKillStartedTimeout` исправлено на секунды.
1. Выполнена оптимизация журнала робота: добавлен `IX_RobotId_OperationKey_TimestampUtc` для запроса операций робота.


# 25
1. У робота добавлен параметр командной строки `EngineVersion`.
1. Появилась настройка, позволяющая установить максимальное количество одновременно работающих роботов.
1. Изменена обработка очереди команд у Агента. Оптимизировано для большого количества одновременных развертываний.
1. Очередь проектов с соблюдением порядка - сначала обрабатываются все без исключения проекты, которые уже находятся в очереди, и только потом в обработку поступают новые.
1. В разделе **Роли пользователей** добавлена сортировка по алфавиту.

# 24

1. В конфигурационный файл тенанта перемещена настройка таймаута проверки доступности машины робота (ping Агента).
1. В разделах проектов и роботов улучшен поиск по наименованию: теперь он производится по оператору LIKE без учета регистра.
1. При завершении старта робота с ошибкой будет освобождаться RDP. 

# 22-23

2. Добавлен вывод информации о расписании, созданном в конструкторе, в таблицу **Все расписания**.
4. Робот с лицензией Desktop больше не может быть развернут из Оркестратора.
5. Стало возможным использовать одну машину робота для нескольких тенантов одновременно.
6. Стала доступной разблокировка робота Агентом из Оркестратора по таймауту.
8. Добавлено отображение в UI ошибок старта робота (RobotStartError).
9. Добавлена запись событий Оркестратора в БД через очередь - для последующей интеграции с Primo.Orchestrator.RobotLogs.
11. Добавлена очистка БД логов через очередь - для последующей интеграции с Primo.Orchestrator.RobotLogs.
10. Произведено изменение запросов для журнала робота на основе совместного хранения логов робота, логов Оркестратора и логов проекта.
12. Добавлена передача в робота внешнего URL сервиса приема логов робота.
14. Асинхронное выполнение команды завершения робота.
1. Для клиентских роботов добавлена возможность работать не только с Desktop-лицензиями.
2. Появилась возможность настраивать время с последней даты обновления состояния RDP-соединения, после которого соединение считается потерянным.
3. Добавлен новый запрос Роботов на странице **Все роботы** с пейджингом и фильтрами. Запрос по состоянию выполнения роботов для вкладки **РОБОТЫ - ВЫПОЛНЕНИЕ**. Для мониторинга роботов.
10. Множественные производственные календари - два календаря одновременно, для перехода через новый год.

### Исправленные ошибки

1. Исправлена ошибка подсчета одновременно работающих роботов на машине робота.
1. Исправлена ошибка в проверке **Проект запущен по заданию и еще не завершен**.
1. Исправлена ошибка в запуске заданий по триггеру **Запуск при получении Email**.
1. Исключен лишний запрос имени пользователя при открытии журнала Оркестратора.
1. Исправлена ошибка в проверке **Если запрещено наложение задания/проекта, то не только пропускается запуск робота (если в очередь проект добавлен вручную через админку Rabbit), но и проект не ставится в очередь проектов**.
1. Исправлена ошибка, возникавшая при назначении роли пользователю из того же тенанта. 

26
1. Устранена ошибка загрузки RPA-проекта в Оркестратор. 
1. Исправлены ошибки конкурентного доступа в `RDPSessionsReleaseService`.
1. Исправлена опечатка в параметре конфигурационного файла `IntevalForReleaseInSeconds`.

25
1. Исправлена ошибка в `GetRobotEventTypesQueryHandler2`.

24-23-22

1. Исправлена ошибка чтения из очереди по фильтру с чекаутом.
1. Исправлена ошибка добавления версии проекта из Студии.
1. Исправлена ошибка с авторизацией прав пользователя на операции.
1. Исправлено отображение события ExchangeQueueReEnqueue в журнале Оркестратора.
1. Исправлена фильтрация по статусам элементов очереди для отображения в UI.
1. У триггера на добавление новых элементов очереди исправлен баг для пустого количества новых элементов.
1. Исправлена ошибка блокировки робота Агентом при ручном запуске робота с проектом - в БД не ставился флаг блокировки.
1. Исправлена ошибка приема логов со скринами рабочего стола.
1. Исправлена ошибка в KeepAliveRobotService.
1. Исправлена ошибка в ResendTriggerOrchCommands.
1. Исправлена ошибка с ошибочным сообщением о блокировке робота при ручном запуске робота.
1. Исправлена ошибка пропуска проекта в очереди ожидания.
