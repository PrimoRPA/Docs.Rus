# Оркестратор 1.24.1

История изменений в Primo RPA Orchestrator за январь 2024-го года. 

## Обновления и улучшения

1. Робот Оркестратора ([unattended-робот](https://docs.primo-rpa.ru/primo-rpa/orchestrator/settings/licensing#tipy-licenzii-v-orkestratore)) теперь может использовать учетную запись, созданную администратором. Такой записи обязательно должна быть назначена [встроенная роль Robot](https://docs.primo-rpa.ru/primo-rpa/orchestrator/settings/users/common-scenarios), и при желании - роль с гибкими правами. Ранее робот мог использовать для работы только встроенную учетную запись. 
1. В форме [развертывания](https://docs.primo-rpa.ru/primo-rpa/orchestrator/basics/deploy-robot) робота добавлены опциональные параметры:
   * **Пользователь Оркестратора** - учетная запись с ролью Robot, созданная администратором для робота Оркестратора. Если оставить поле пустым, то по умолчанию будет использоваться встроенная учетная запись **robot**. 
   * **Пароль пользователя Оркестратора**.

   ![](<../../.gitbook/assets1/add-robot-orchuser.png>)

   Дополнительно, в разделе **Роботы > Все роботы**, стало возможным фильтровать данные по полю **Пользователь оркестратора**.
1. Добавлена возможность скрывать из интерфейса функцию **Консоль** с трансляцией RDP-сессии робота. Скрыть функцию можно в настройках конфигурационного файла WebApi. Для этого в секции **Worker** установите параметру **ShowRdpConsoleBtn** значение `false`:
   ```
   "Worker": {
   /* Показывать кнопку "Консоль" для просмотра сеанса робота */
   ShowRdpConsoleBtn": false
   ```    

   ![](<../../.gitbook/assets1/hide-console-button.png>) 

1. В разделе **Настройки > Машины роботов** были добавлены:
   * кнопка **Включить/Выключить** - отображается в меню таблицы при выделении нужной машины. Выключенная машина не опрашивается Оркестратором до момента включения, а ее логи не записываются в журнал.
   * столбец **Выключена** - содержит признак выключенной машины. 
   
   Кроме этого, на главной странице, в виджете **Машины роботов**, добавлен специальный признак выключенной машины, чтобы отличать ее от недоступной.

   ![](<../../.gitbook/assets1/turn-off-button-machine.png>)

1. В журнале Оркестратора вновь стала доступной вкладка **Корректировка**. В ней выводятся события о корректировке оперативного взаимодействия узлов в кластере Оркестратора. События в таблице можно отфильтровать по следующим типам:
   * **Добавился узел** - в кластер Оркестратора добавлен новый узел (нода).
   * **Потерян узел** - один из узлов в кластере перестал быть доступным. В таких случаях требуется оперативное восстановление работы узла или переназначение задач другим узлам в кластере. 


1. В заданиях с триггером [**Запуск при наличии новых элементов в очереди обмена данными**](https://docs.primo-rpa.ru/primo-rpa/orchestrator/basics/tasks#id-3.-zapusk-pri-nalichii-novykh-elementov-v-ocheredi-obmena-dannymi) теперь можно указывать теги элементов. В результате триггер сработает только в том случае, если в очереди появятся элементы с указанными тегами.

   ![](<../../.gitbook/assets1/orch-task-item-tag.png>)


1. Для элементов очереди стало возможным указывать тайм-аут - максимальное время нахождения элемента в статусе InProgress. По истечении указанного времени система автоматически удалит элемент. По умолчанию параметр с тайм-аутом скрыт, настроить его отображение можно в конфигурационном файле WebAPi в параметре **EnabledInProgressTimeout**. 
   
   В конфиге новый bool параметр EnabledInProgressTimeout. Когда он отключен, InProgressTimeout не учитывается и, как мы договорились, должен скрываться в UI.
   https://azure-dos.s1.primo1.orch/PrimoCollection/Orchestrator/_boards/board/t/Orchestrator/Stories/?workitem=10294
   https://azure-dos.s1.primo1.orch/PrimoCollection/Orchestrator/_boards/board/t/Orchestrator/Stories/?workitem=355
 
1. Улучшено отображение значений и метаданных элементов в очереди обмена данными. Теперь, если кликнуть в столбце **Значения и Метаданные**, то данные со сложной структурой будут представлены в виде дерева. Ранее они выводились в виде строки.
1. Для RPA-проектов добавилось визуальное обозначение источника публикации, которые отправляет GitLab при наличии интеграции. Источник отображается на странице **Все RPA-проекты** в столбце **Версия**. По умолчанию скрыто\нет? За отображение источника публикации в интерфейсе отвечает параметр **какой?** в конфигурационном файле WebApi. 
   Возможные источники:
   * Оркестратор - проект опубликован через Оркестратор?;
   * Студия - проект опубликован из Студии?;
   * Git - проект опубликован каким именно образом?

   УТОЧНИТЬ, ГДЕ ОТОБРАЖАЮТСЯ - в столбце "версия", как на стенде, или в столбце "Наименование", как в задаче.

   https://azure-dos.s1.primo1.orch/PrimoCollection/Orchestrator/_workitems/edit/10333

   следующие необходимые изменения/работы (ЧТО ИЗ ЭТОГО СДЕЛАНО?):
   * Добавить интеграцию со стороны GitLab (скрипт/плагин) - при изменении в репо проекта - в Оркестратор должна заливаться новая версия из GitLab и она назначается Активной.
   * Добавить новый параметр/флаг к Проекту - источник: Студия, Git, UI Оркестратора. Добавить фильтр по этому флагу. 
   * Просят выгрузку Проектов с учетом фильтра по источнику публикации.


1. В [форме добавления проекта](https://docs.primo-rpa.ru/primo-rpa/orchestrator/basics/add-project#parametry-proekta) появились параметры **Версия** и **Предрелиз (RC)**. Функциональность предназначена для тех случаев, когда пользователь хочет протестировать последнюю версию RPA-проекта перед ее основным релизом. 

   ![](<../../.gitbook/assets1/orch-project-rc-parametr.png>)

   В таблице проектов данные о предрелизе будут отображаться в столбце **Версия**. Теперь верхняя часть (v0, …, vN) версии – это технические версии проектов, которые назначаются Оркестратором автоматически. Нижняя часть версии – строка формата, принятого разработчиками проектов. Значение может быть взято из метаданных, полученных при чтении архива проекта.

   ![](<../../.gitbook/assets1/версии проектов.png>)

1. В разделе настроек прав роли, в группу **RPA-проекты**, добавлена функция **Предрелизная версия**. С ее помощью можно настроить следующие права доступа к функции:
   * Просмотр - ?
   * Создание - ?
   * Редактирование - ?
   * Удаление - ?
   * Управление - не применимо для данного пункта.

   ![](<../../.gitbook/assets1/orch-rc-project.png>)

1. Добавлена возможность остановить сразу все запущенные [задания](https://docs.primo-rpa.ru/primo-rpa/orchestrator/basics/tasks), а также массово запустить их впоследствии. Для этого на странице **Все задания** появились кнопки **Остановить все** и **Запустить все остановленные**. Для массовой остановки/запуска заданий не требуется предварительно выбирать задания в таблице.

   ![](<../../.gitbook/assets1/orch-taska-stop-all-button.png>)

### UX/UI

1. На странице **Настройки > Стратегия очереди проектов** график привязки роботов к проекту стал изменяться в зависимости от выбранных настроек. 
1. На странице **Настройки > Диструбив робота** добавлены индикаторы состояния дистрибутивов. В случае проблем с дистрибутивом, в столбце **Физически присутствует в хранилище** отобразится цветовой индикатор ошибки. При наведении курсора на индикатор появится текстовая подсказка.
1. В таблицу роботов добавлены текстовые подсказки для статусов открытия RDP-сессии. Подсказка отобразится, если в колонке **Расположение** навести курсор на цветовой индикатор.
1. На странице **Роботы > Все роботы** добавлена подсветка недоступной машины робота. Так, если в столбце **Машина доступна** отображается статус `Нет`, то это значение подсветится красным. 
1. Улучшено отображение данных в разделе **Роботы > Группы**.
1. Размер поля с версией дистрибутива робота увеличен до 100.


### ФИЧИ - НЕ ОПИСАНЫ

1. Функционал должен позволять работать с проектом в IdeaHub - Студия - Оркестратор. Те проект для всех систем должен быть некой идентичной сущностью. Доступность свойств проекта в IdeaHub-Студии-Оркестраторе (Orchestrator фронт-бэк)



1. В форму создания ресурса (asset) добавлены опциональные параметры **Тип блокировки** и **Таймаут** блокировки. Возможные типы блокировки:
   * *Разрешено чтение* - 
   * *Запрещено чтение* -
   ПЕРЕСЛУШАТЬ ДЕМО, ТОЛЬКО ТАК

1. Добавить сортировку по датам/приоритету для элементов очереди обмена данными - Добавлена множественная сортировка для элементов очереди обмена данными. Это серверная сортировка, их можно испольовать одновременно. Сортировка осуществляется посредством нажатия на заголовок столбца.  Если снять сортировку со всех столбцов, то порядок будет определен исходя из приоритета (по восходящей, строки без приоритета в конце), потом по полю "Дата создания" по возрастающей. Сортировка добавлена в столбцы:
   * Дата создания
   * Дата, до которой элемент считается недоступным
   * Дата, после которой элемент считается недоступным
   * Дата прочтения элементов очереди роботом

     бэк - (980) Добавлена сортировка по датам/приоритету для элементов очереди обмена данными


## ОПТИМИЗАЦИИ

1. При согласовании дистрибутива нодами фиксация событий "Долгое время от какой-либо ноды нет подтверждения" и "В серии последовательных согласований подтверждение постоянно меняется"
1. (9355) Возможность поиска элемента очереди по натуральному ключа без учета регистра
1. 10088 - Большая нагрузка на процессор при работе RDP2. ??? сделали что-то? или просто рекомендация в стиле "отключите сессию"?
1. Отключение виджета с интенсивностью событий триггеров на главной

## Исправленные ошибки

1. Исправлена ошибка `Email должен быть уникальным`, которая возникала при создании и редактировании пользователя.
1. Исправлена ошибка валидации при сохранении задания с триггером **Запуск при получении Email**.
1. Исправлено дублирование запросов в таблице элементов очереди обмена данными.
1. Исправлена ошибка, из-за которой свободный робот не брал в работу проект из очереди.
1. Исправлена ошибка, из-за которой в форме расписания невозможно было указать календарь.
1. Исправлена ошибка, из-за которой не удалялись ресурсы (assets) из Оркестратора.
1. Исправлена ошибка, из-за которой невозможно было прочитать ресурс Оркестратора из Студии.
1. Понижен уровень лога `Робот не в состоянии мягкого останова` - теперь запись носит информационный характер. 
1. Исправлена ошибка в авторизации attended-робота.
1. Исправлена ошибка передачи логов attended-робота в Оркестратор, возникавшая при (массовом?) разлогине робота после выполнения проекта. 
1. Исправлена ошибка с удалением привязки роботов при удалении версии проекта.
1. Исправлена работа функции **Повторить** для элементов очереди обмена данными. Теперь использовании функции всегда будет переводить элемент в статус New, независимо от текущего статуса.
1. Исправлена ошибка, из-за которой машины роботов переносились между папками без RDP-пользователей.
1. Исправлена ошибка, когда для непоследних версий проектов в некоторых случаях не отображалась соответствующая надпись в таблице проектов. 
1. Исправлено некорректное отображение времени при получении уведомлений на почту при запуске робота с проектом.
1. Исправлены проблемы со сбором счетчиков производительности у Агента.
1. Исправлена ошибка, когда при переносе RPA-проектов из одной папки в другую, промежуточные версии проектов терялись.
1. Исправлена ошибка, возникавшая при создании папки. Добавлена проверка уникальности имени папки для пользователя.
1. Исправлена сортировка (FIFO) при чтении из очереди в скоростном режиме.
1. Устранены повторные извлечения при чтении элементов очереди по FIFO, чтобы минимизировать возврат NULL.
1. Исправлена ошибка с расщеплением элемента очереди при чтении в скоростном режиме, приводящий к задваиванию чтения.
1. Исправлена ошибка с кешированием робота в методах работы с ресурсами.
1. Исправлена ошибка в разделе **Все RPA-проекты > Аргументы > История запусков**.  - неинформативно. если в демо инфы не будет, удалить.
1. (11813) Исправлена ошибка, позволявшая передавать значения параметров не входящих в Enum, которым задан тип параметра.


## Hope-UI
1. Добавить информация о версиях агентов в HopeUI. 
1. Доступность машины робота - Hope-UI.
1. https://azure-dos.s1.primo1.orch/PrimoCollection/Orchestrator/_workitems/edit/9124 Перенести подраздел раздел Роботы в Проектах.

## Где найти
1. [Скачать комплект поставки Оркестратора:](https://disk.primo-rpa.ru/index.php/s/primo?path=%2FRelease%2FOrchestrator)
    * **Primo RPA Orchestrator 1.24.1 FULL.zip** - полный комплект поставки, в который входят дистрибутивы Оркестратора и внешних компонентов: например, базы данных PostgreSQL Server, брокера сообщений RabbitMQ и др. 
    * **Primo RPA Orchestrator 1.24.1.zip** - облегченный вариант поставки.
2. [Скачать дистрибутив Robot Enterprise](https://disk.primo-rpa.ru/index.php/s/primo?path=%2FRelease%2FRobot). Архив должен иметь название **Primo RPA Robot Orchestrator <архитектура> 1.24.1.zip**. Дистрибутив этого робота загружается непосредственно в Оркестратор.
