# Оркестратор 1.24.1

История изменений в Primo RPA Orchestrator за январь 2024-го года. 

## Обновления и улучшения

### ФИЧИ - НЕ ОПИСАНЫ
1. Добавлена возможность использовать общие папки. Функциональность позволяет разграничить доступ пользователей к объектам Оркестратора. Использование функции включается администратором в конфигурационном файле Оркестратора в секции `Folders`.
   Среди всех папок отдельно выделяется корневая папка - одна на тенант. Никакой объект не может находиться одновременно в корневой папке и в какой-либо не корневой папке. Все пользователи системы имеют неограниченные права на корневую папку, если ограничения прав не заданы явно. У корневой папки нет владельца.
   Не корневые папки можно визуально структурировать в виде дерева. Никакого наследования прав при этом не предполагается. Пользователь, создавший не корневую папку, считается владельцем папки и имеет неограниченные права. При удалении папки все её объекты перемещаются в корневую папку. Владелец папки может делегировать права на папку другим пользователям. Существуют следующие типы прав, с которыми общая папка делегируется другому пользователю

   Ограничения:
   * не работают с ресурсами;
   * не работают с очередями обмена данными.

1. О - При согласовании дистрибутива нодами фиксация событий "Долгое время от какой-либо ноды нет подтверждения" и "В серии последовательных согласований подтверждение постоянно меняется"
1. Добавлено отключение виджета с интенсивностью событий триггеров на главной странице. (как отключается - в конфиге где именно)
1. Для элементов очереди стало возможным указывать тайм-аут - максимальное время нахождения элемента в статусе InProgress. По истечении указанного времени система автоматически удалит элемент. По умолчанию параметр с тайм-аутом скрыт, настроить его отображение можно в конфигурационном файле WebAPi в параметре **EnabledInProgressTimeout**. 
   
   В конфиге новый bool параметр EnabledInProgressTimeout. Когда он отключен, InProgressTimeout не учитывается и, как мы договорились, должен скрываться в UI.
   https://azure-dos.s1.primo1.orch/PrimoCollection/Orchestrator/_boards/board/t/Orchestrator/Stories/?workitem=10294
   https://azure-dos.s1.primo1.orch/PrimoCollection/Orchestrator/_boards/board/t/Orchestrator/Stories/?workitem=355

1. Для RPA-проектов добавилось визуальное обозначение источника публикации, которые отправляет GitLab при наличии интеграции. Источник отображается на странице **Все RPA-проекты** в столбце **Версия**. По умолчанию скрыто\нет? За отображение источника публикации в интерфейсе отвечает параметр **какой?** в конфигурационном файле WebApi. 
   Возможные источники:
   * Оркестратор - проект опубликован через Оркестратор?;
   * Студия - проект опубликован из Студии?;
   * Git - проект опубликован каким именно образом?

   УТОЧНИТЬ, ГДЕ ОТОБРАЖАЮТСЯ - в столбце "версия", как на стенде, или в столбце "Наименование", как в задаче.

   https://azure-dos.s1.primo1.orch/PrimoCollection/Orchestrator/_workitems/edit/10333

   следующие необходимые изменения/работы (ЧТО ИЗ ЭТОГО СДЕЛАНО?):
   * Добавить интеграцию со стороны GitLab (скрипт/плагин) - при изменении в репо проекта - в Оркестратор должна заливаться новая версия из GitLab и она назначается Активной.
   * Добавить новый параметр/флаг к Проекту - источник: Студия, Git, UI Оркестратора. Добавить фильтр по этому флагу. 
   * Просят выгрузку Проектов с учетом фильтра по источнику публикации.

## Изменения в Hope-UI - НЕ ОПИСАНЫ
1. Добавить информация о версиях агентов в HopeUI. 
1. Доступность машины робота - Hope-UI.
1. https://azure-dos.s1.primo1.orch/PrimoCollection/Orchestrator/_workitems/edit/9124 Перенести подраздел раздел Роботы в Проектах.
1. Исправлена ошибка с отображением данных в разделе **Аргументы проекта > История запусков**.


## ФИЧИ - ОПИСАНЫ

1. Робот Оркестратора ([unattended-робот](https://docs.primo-rpa.ru/primo-rpa/orchestrator/settings/licensing#tipy-licenzii-v-orkestratore)) теперь может использовать учетную запись, созданную администратором. Такой записи обязательно должна быть назначена встроенная роль Robot, и при желании - роль с гибкими правами. Ранее робот мог использовать для работы только встроенную учетную запись. 
1. В форме [развертывания](https://docs.primo-rpa.ru/primo-rpa/orchestrator/basics/deploy-robot) робота добавлены опциональные параметры:
   * **Пользователь Оркестратора** - учетная запись с ролью Robot, созданная администратором для робота Оркестратора. Если оставить поле пустым, то по умолчанию будет использоваться встроенная учетная запись **robot**. 
   * **Пароль пользователя Оркестратора**.

   ![](<../../.gitbook/assets1/add-robot-orchuser-2.png>)

   Дополнительно, в разделе **Роботы > Все роботы**, стало возможным фильтровать данные по полю **Пользователь оркестратора**.
1. Добавлена возможность скрывать из интерфейса функцию **Консоль** с трансляцией RDP-сессии робота. Скрыть функцию можно в настройках конфигурационного файла WebApi. Для этого в секции **Worker** установите параметру **ShowRdpConsoleBtn** значение `false`:
   ```
   "Worker": {
   /* Показывать кнопку "Консоль" для просмотра сеанса робота */
   ShowRdpConsoleBtn": false
   ```    
   ![](<../../.gitbook/assets1/hide-console-button.png>) 

1. В разделе **Настройки > Машины роботов** были добавлены:
   * кнопка **Включить/Выключить** - отображается в меню таблицы при выделении нужной машины. Выключенная машина не опрашивается Оркестратором до момента включения, а ее логи не записываются в журнал.
   * столбец **Выключена** - содержит признак выключенной машины. 
   
   Кроме этого, на главной странице, в виджете **Машины роботов**, добавлен специальный признак выключенной машины, чтобы отличать ее от недоступной.

   ![](<../../.gitbook/assets1/turn-off-button-machine.png>)

1. В журнале Оркестратора вновь стала доступной вкладка **Корректировка**. В ней выводятся события о корректировке оперативного взаимодействия узлов в кластере Оркестратора. События в таблице можно отфильтровать по следующим типам:
   * **Добавился узел** - в кластер Оркестратора добавлен новый узел.
   * **Потерян узел** - один из узлов в кластере перестал быть доступным. В таких случаях требуется оперативное восстановление работы узла или переназначение задач другим узлам в кластере. 
1. В заданиях с триггером [**Запуск при наличии новых элементов в очереди обмена данными**](https://docs.primo-rpa.ru/primo-rpa/orchestrator/basics/tasks#id-3.-zapusk-pri-nalichii-novykh-elementov-v-ocheredi-obmena-dannymi) теперь можно указывать теги элементов. В результате триггер сработает только в том случае, если в очереди появятся элементы с указанными тегами.

   ![](<../../.gitbook/assets1/orch-task-item-tag.png>)

1. В [форме добавления проекта](https://docs.primo-rpa.ru/primo-rpa/orchestrator/basics/add-project#parametry-proekta) появились параметры **Версия** и **Предрелиз (RC)**. Функциональность предназначена для тех случаев, когда пользователь хочет протестировать последнюю версию RPA-проекта перед ее основным релизом. 

   ![](<../../.gitbook/assets1/orch-project-rc-parametr-2.png>)

   В таблице проектов данные о предрелизе будут отображаться в столбце **Версия**. Теперь верхняя часть (v0, …, vN) версии – это технические версии проектов, которые назначаются Оркестратором автоматически. Нижняя часть версии – строка формата, принятого разработчиками проектов. Значение может быть взято из метаданных, полученных при чтении архива проекта.

   ![](<../../.gitbook/assets1/версии проектов.png>)

1. В разделе настроек прав роли, в группу **RPA-проекты**, добавлена функция **Предрелизная версия**. С ее помощью можно настроить такие права доступа к функции, как:
   * Просмотр - пользователь с данной ролью сможет только просматривать предрелизные проекты. (сможет ли он их запускать?)
   * Создание - пользователь имеет право создавать предрелизные проекты. (если права нет, то флаг RC будет заблокирован в форме проекта?)
   * Редактирование - пользователь имеет право изменять предрелизные проекты.
   * Удаление - пользователь имеет право удалять предрелизные проекты.
   * Управление - не применимо для данного пункта.

   ![](<../../.gitbook/assets1/orch-rc-project.png>)

1. Добавлена возможность останавливать сразу все запущенные [задания](https://docs.primo-rpa.ru/primo-rpa/orchestrator/basics/tasks), а также заново их запускать. Для этого на странице **Все задания** появились кнопки **Остановить все** и **Запустить все остановленные**. Для их использования не требуется вручную выбирать задания в таблице. Функциональность может быть полезной при обновлении Оркестратора, чтобы предотвратить потенциальные нарушения в работе заданий.

   ![](<../../.gitbook/assets1/orch-taska-stop-all-button.png>)

1. В форму создания ресурса добавлены опциональные параметры **Тип блокировки** и **Таймаут**. Установка блокировки гарантирует, что другие роботы не смогут обратиться к данному ресурсу. Таким образом, обрабатывать ресурс может только робот-владелец. Возможные типы блокировки:
   * *Разрешено чтение* - другие роботы смогут только читать этот ресурс.
   * *Запрещено чтение* - другим роботам полностью запрещено использовать этот ресурс.
1. Улучшена производительность при работе с ресурсами Оркестратора. 
1. Добавлена возможность поиска элемента очереди по натуральному ключу без учета регистра.

### Улучшение UX/UI

1. Для элементов очереди обмена данными добавлена множественная сортировка по следующим столбцам: 
   * Дата создания;
   * Дата, до которой элемент считается недоступным;
   * Дата, после которой элемент считается недоступным;
   * Дата прочтения элементов очереди роботом.

   Перечисленную сортировку можно использовать одновременно, для этого необходимо нажать на заголовки нужных столбцов. 
1. Улучшено отображение значений и метаданных элементов в очереди обмена данными. Теперь, если кликнуть в столбце **Значения и Метаданные**, то данные со сложной структурой будут представлены в виде дерева. Ранее они выводились в виде строки.
1. На странице **Настройки > Стратегия очереди проектов** график привязки роботов к проекту стал динамически изменяться в зависимости от выбранных настроек. 
1. На странице **Настройки > Диструбив робота** добавлены индикаторы состояния дистрибутивов. В случае проблем с дистрибутивом, в столбце **Физически присутствует в хранилище** отобразится цветовой индикатор ошибки. При наведении курсора на индикатор появится текстовая подсказка.
1. В таблицу роботов добавлены текстовые подсказки для статусов открытия RDP-сессии. Подсказка отобразится, если в колонке **Расположение** навести курсор на цветовой индикатор.
1. На странице **Роботы > Все роботы** добавлена подсветка недоступной машины робота. Так, если в столбце **Машина доступна** отображается статус `Нет`, то это значение подсветится красным. 
1. Улучшено отображение данных в разделе **Роботы > Группы**.
1. До 100 символов увеличена максимальная длина значения в поле с версией дистрибутива робота.


## Исправленные ошибки
1. Исправлена ошибка, когда при запросе элемента очереди по FIFO возвращался `Null`, хотя очередь не была пустой. Ошибка возникала при большой нагрузке и требовала от пользователя лишних действий в виде повторного обращения к очереди. Теперь необходимость повторных запросов устранена. 
1. Исправлены ошибки в сортировке элементов очереди, возникавшие при большом количестве обращений роботов. 
1. Исправлена работа функции **Повторить** для элементов очереди. Теперь использование функции всегда переводит элемент в статус New, независимо от текущего статуса.
1. Исправлена ошибка, из-за которой не удалялись ресурсы (assets) из Оркестратора.
1. Исправлена ошибка, из-за которой невозможно было прочитать ресурс Оркестратора из Студии.
1. Исправлена ошибка валидации поля **Email** для заданий с триггером **Запуск при получении Email**. 
1. Исправлена ошибка, из-за которой задание с запуском при изменении папки учитывало только глобальную настройку стратегии очереди. Стали учитываться стратегии тенантов.
1. Исправлена ошибка `Email должен быть уникальным`, которая возникала при редактировании почты в профиле пользователя.
1. Исправлено некорректное указание времени в уведомлениях, отправляемых на почту при запуске робота с проектом.
1. Исправлена ошибка, из-за которой свободный робот не брал в работу проект из очереди.
1. Исправлена ошибка с удалением привязки роботов при удалении версии проекта.
1. Исправлена ошибка, когда для версий проектов не отображалась надпись `Не последняя` в таблице проектов. 
1. Понижен уровень лога `Робот не в состоянии мягкого останова` - теперь событие носит информационный характер. 
1. Исправлена ошибка, из-за которой логи attended-робота могли не передаваться в Оркестратор.
1. Исправлена ошибка, из-за которой в форме расписания невозможно было указать календарь, если их несколько (режим множественных календарей).
1. Исправлена ошибка, возникавшая при попытке разлогинить всех RDP-пользователей машины робота.
1. Исправлены проблемы со сбором счетчиков производительности у Агента.
1. Исправлена ошибка, возникавшая при создании папки. Добавлена проверка уникальности имени папки для пользователя.
1. Исправлена ошибка, из-за которой машины роботов переносились между папками без RDP-пользователей.
1. Исправлена ошибка, когда при переносе RPA-проектов из одной папки в другую промежуточные версии проектов терялись.


## Где найти
1. [Скачать комплект поставки Оркестратора:](https://disk.primo-rpa.ru/index.php/s/primo?path=%2FRelease%2FOrchestrator)
    * **Primo RPA Orchestrator 1.24.1 FULL.zip** - полный комплект поставки, в который входят дистрибутивы Оркестратора и внешних компонентов: например, базы данных PostgreSQL Server, брокера сообщений RabbitMQ и др. 
    * **Primo RPA Orchestrator 1.24.1.zip** - облегченный вариант поставки.
2. [Скачать дистрибутив Robot Enterprise](https://disk.primo-rpa.ru/index.php/s/primo?path=%2FRelease%2FRobot). Архив должен иметь название **Primo RPA Robot Orchestrator <архитектура> 1.24.1.zip**. Дистрибутив этого робота загружается непосредственно в Оркестратор.
