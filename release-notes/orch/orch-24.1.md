# Оркестратор 1.24.1

История изменений в Primo RPA Orchestrator за январь 2024-го года. 

## Обновления и улучшения

1. Робот Оркестратора ([unattended-робот](https://docs.primo-rpa.ru/primo-rpa/orchestrator/settings/licensing#tipy-licenzii-v-orkestratore)) теперь может использовать учетную запись, созданную администратором. Такой записи обязательно должна быть назначена [встроенная роль Robot](https://docs.primo-rpa.ru/primo-rpa/orchestrator/settings/users/common-scenarios), и при желании - роль с гибкими правами. Ранее робот мог использовать для работы только встроенную учетную запись. 
1. В форме [развертывания](https://docs.primo-rpa.ru/primo-rpa/orchestrator/basics/deploy-robot) робота добавлены опциональные параметры:
   * **Пользователь Оркестратора** - учетная запись с ролью Robot, созданная администратором для робота Оркестратора. Если оставить поле пустым, то по умолчанию будет использоваться встроенная учетная запись **robot**. 
   * **Пароль пользователя Оркестратора**.

   ![](<../../.gitbook/assets1/add-robot-orchuser.png>)

   Дополнительно, в разделе **Роботы > Все роботы**, стало возможным фильтровать данные по полю **Пользователь оркестратора**.
1. Добавлена возможность скрывать из интерфейса функцию **Консоль** с трансляцией RDP-сессии робота. Скрыть функцию можно в настройках конфигурационного файла WebApi. Для этого в секции **Worker** установите параметру **ShowRdpConsoleBtn** значение `false`:
   ```
   "Worker": {
   /* Показывать кнопку "Консоль" для просмотра сеанса робота */
   ShowRdpConsoleBtn": false
   ```    

   ![](<../../.gitbook/assets1/hide-console-button.png>) 

1. На странице **Роботы > Все роботы** добавлена подсветка недоступной машины робота. Так, если в столбце **Машина доступна** отображается статус `Нет`, то это значение подсветится красным. 
1. В журнале Оркестратора вновь стала доступной вкладка **Корректировка**. В ней выводятся события о корректировке оперативного взаимодействия узлов в кластере Оркестратора. События в таблице можно отфильтровать по следующим типам:
   * **Добавился узел** - в кластер Оркестратора добавлен новый узел (нода).
   * **Потерян узел** - один из узлов в кластере перестал быть доступным. В таких случаях требуется оперативное восстановление работы узла или переназначение задач другим узлам в кластере. 


1. В заданиях с триггером [**Запуск при наличии новых элементов в очереди обмена данными**](https://docs.primo-rpa.ru/primo-rpa/orchestrator/basics/tasks#id-3.-zapusk-pri-nalichii-novykh-elementov-v-ocheredi-obmena-dannymi) теперь можно указывать теги элементов. В результате триггер сработает только в том случае, если в очереди появятся элементы с указанными тегами.

   ![](<../../.gitbook/assets1/orch-task-item-tag.png>)


1. Для элементов очереди стало возможным указывать тайм-аут - максимальное время нахождения элемента в статусе InProgress. По истечении указанного времени система автоматически удалит элемент. По умолчанию параметр с тайм-аутом скрыт, настроить его отображение можно в конфигурационном файле WebAPi в параметре **EnabledInProgressTimeout**. 
   
   В конфиге новый bool параметр EnabledInProgressTimeout. Когда он отключен, InProgressTimeout не учитывается и, как мы договорились, должен скрываться в UI.
   https://azure-dos.s1.primo1.orch/PrimoCollection/Orchestrator/_boards/board/t/Orchestrator/Stories/?workitem=10294
   https://azure-dos.s1.primo1.orch/PrimoCollection/Orchestrator/_boards/board/t/Orchestrator/Stories/?workitem=355
 
1. Улучшено отображение значений и метаданных элементов в очереди обмена данными. Теперь, если кликнуть в столбце **Значения и Метаданные**, то данные со сложной структурой будут представлены в виде дерева. Ранее они выводились в виде строки.
1. Для RPA-проектов добавилось визуальное обозначение источника публикации, которые отправляет GitLab при наличии интеграции. Источник отображается на странице **Все RPA-проекты** в столбце **Версия**. По умолчанию скрыто\нет? За отображение источника публикации в интерфейсе отвечает параметр **какой?** в конфигурационном файле WebApi. 
   Возможные источники:
   * Оркестратор - проект опубликован через Оркестратор?;
   * Студия - проект опубликован из Студии?;
   * Git - проект опубликован каким именно образом?

   УТОЧНИТЬ, ГДЕ ОТОБРАЖАЮТСЯ - в столбце "версия", как на стенде, или в столбце "Наименование", как в задаче.

   https://azure-dos.s1.primo1.orch/PrimoCollection/Orchestrator/_workitems/edit/10333

   следующие необходимые изменения/работы (ЧТО ИЗ ЭТОГО СДЕЛАНО?):
   * Добавить интеграцию со стороны GitLab (скрипт/плагин) - при изменении в репо проекта - в Оркестратор должна заливаться новая версия из GitLab и она назначается Активной.
   * Добавить новый параметр/флаг к Проекту - источник: Студия, Git, UI Оркестратора. Добавить фильтр по этому флагу. 
   * Просят выгрузку Проектов с учетом фильтра по источнику публикации.


1. В [форме добавления проекта](https://docs.primo-rpa.ru/primo-rpa/orchestrator/basics/add-project#parametry-proekta) появились параметры **Версия** и **Предрелиз (RC)**. Функциональность предназначена для тех случаев, когда пользователь хочет протестировать последнюю версию RPA-проекта перед ее основным релизом. 

   ![](<../../.gitbook/assets1/orch-project-rc-parametr.png>)

   В таблице проектов данные о предрелизе будут отображаться в столбце **Версия**. Теперь верхняя часть (v0, …, vN) версии – это технические версии проектов, которые назначаются Оркестратором автоматически. Нижняя часть версии – строка формата, принятого разработчиками проектов. Значение может быть взято из метаданных, полученных при чтении архива проекта.

   ![](<../../.gitbook/assets1/версии проектов.png>)

1. В разделе настроек прав роли, в группу **RPA-проекты**, добавлена функция **Предрелизная версия**. С ее помощью можно настроить следующие права доступа к функции:
   * Просмотр - ?
   * Создание - ?
   * Редактирование - ?
   * Удаление - ?
   * Управление - не применимо для данного пункта.

   ![](<../../.gitbook/assets1/orch-rc-project.png>)

1. Добавлена возможность остановить сразу все запущенные [задания](https://docs.primo-rpa.ru/primo-rpa/orchestrator/basics/tasks), а также массово запустить их впоследствии. Для этого на странице **Все задания** появились кнопки **Остановить все** и **Запустить все остановленные**. Для массовой остановки/запуска заданий не требуется предварительно выбирать задания в таблице.

   ![](<../../.gitbook/assets1/orch-taska-stop-all-button.png>)



### ФИЧИ - НЕ ОПИСАНЫ


1. 10378 - Добавить признак выключенного Агента в UI. 
1. 10088 - Большая нагрузка на процессор при работе RDP2.
1. 9124 - Перенести подраздел раздел Роботы в Проектах.
1. 10062 - Поменять список для фильтра приоритеты в таблице Очереди проектов.
1. (993) Доступность свойств проекта в IdeaHub-Студии-Оркестраторе (Orchestrator фронт-бэк)
1. В форму создания ресурса (asset) добавлены опциональные параметры **Тип блокировки** и **Таймаут** блокировки. Возможные типы блокировки:
   * *Разрешено чтение* - 
   * *Запрещено чтение* -
   ПЕРЕСЛУШАТЬ ДЕМО, ТОЛЬКО ТАК

1. Добавить сортировку по датам/приоритету для элементов очереди обмена данными - Добавлена множественная сортировка для элементов очереди обмена данными. Это серверная сортировка, их можно испольовать одновременно. Сортировка осуществляется посредством нажатия на заголовок столбца.  Если снять сортировку со всех столбцов, то порядок будет определен исходя из приоритета (по восходящей, строки без приоритета в конце), потом по полю "Дата создания" по возрастающей. Сортировка добавлена в столбцы:
   * Дата создания
   * Дата, до которой элемент считается недоступным
   * Дата, после которой элемент считается недоступным
   * Дата прочтения элементов очереди роботом

     бэк - (980) Добавлена сортировка по датам/приоритету для элементов очереди обмена данными
1. UX - 9104 - раздел роботы, вкладка Группы. Поменялся внешний вид таблицы - теперь вместо двух таблиц стала одна, ей удобнее пользоваться. 
1. UX - На странице **Настройки > Стратегия очереди проектов** график привязки роботов к проекту стал изменяться в зависимости от выбранных настроек. 
1. UX - На странице **Настройки > Диструбив робота** добавлены индикаторы состояния дистрибутивов. В случае проблем с дистрибутивом, в столбце **Физически присутствует в хранилище** отобразится цветовой индикатор ошибки. При наведении курсора на индикатор появится текстовая подсказка.
1. UX - В таблицу роботов добавлены текстовые подсказки для статусов открытия RDP-сессии. Подсказка отобразится, если в колонке **Расположение** навести курсор на цветовой индикатор.


## ОПТИМИЗАЦИИ

- При согласовании дистрибутива нодами фиксация событий "Долгое время от какой-либо ноды нет подтверждения" и "В серии последовательных согласований подтверждение постоянно меняется"
- (9355) Возможность поиска элемента очереди по натуральному ключа без учета регистра


## Исправленные ошибки

1. Ошибки "Email должен быть уникальным" при создании и редактировании пользователя.
1. Не работает чтение ассетов орка из студии.
1. Ошибка валидации при сохранении задания с Email триггером.
1. Баг в блоке "Аргументы проекта" -> История запусков.
1. Некорректное отображение времени при получении уведомлений на почту при запуске робота с проектом.
1. Проблемы со сбором счетчиков производительности у Агента.
1. Дублируются запросы в таблице элементы очереди.
1. Свободный робот не берет в работу проект из очереди.
1. В форме Расписания нельзя указать календарь.
1. Не удаляются ассеты из Оркестратора.
1. (9299) Триггер по расписанию с мягкой остановкой не работает
1. (372) Исправлена работа кнопки Повторить (обнуление элемента, пересчет статистики)
1. (10423) Триггер на изменение папки работает только со стратегией "Прикрепленные роботы" (настройки стратегии брались только из дефолтного тенанта)
1. Сортировка (FIFO) при чтении из очереди в скоростном режиме
1. Повторные извлечения при чтении по FIFO, чтобы минимизировать возврат NULL.
1. Баг с расщеплением элемента очереди при чтении в скоростном режиме, приводящий к задваиванию чтения
1. Баг с кэшированием робота в методах работы с ассетами- О Отключение виджета с интенсивностью событий триггеров на главной
1. (10328) Баг с не отображением сообщения о не последней версии проекта
1. (11813) Исправлен баг, позволявший передавать значения параметров не входящих в Enum, которым задан тип параметра
1. (10186) Папки (добавить уникальность имени папки для пользователя, при удалении переподчинять её дочерние папки)
1. Размер поля с версией дистрибутива робота увеличен до 100
1. Понижен уровень лога "Робот не в состоянии мягкого останова"- Ф (8557) Признак выключенного агента 
1. Исправлен баг в авторизации аттендед-робота- Б (10151) Исправлен баг с удалением привязок роботов при удалении версии проекта
1. (11209) Ошибка в миграции для MSSQL с циклами в каскаде- Б (10432 Баг при массовом разлогоне
1. (10422) Машины агентов переносятся между папками без RDP пользователей
1. (10419) При переносе проектов между папками, промежуточные версии проектов теряются UI 2.0 (перенос всех версий).



## Hope-UI
1. Добавить информация о версиях агентов в HopeUI.
1. Доступность машины робота - Hope-UI.


## Где найти
1. [Скачать комплект поставки Оркестратора:](https://disk.primo-rpa.ru/index.php/s/primo?path=%2FRelease%2FOrchestrator)
    * **Primo RPA Orchestrator 1.24.1 FULL.zip** - полный комплект поставки, в который входят дистрибутивы Оркестратора и внешних компонентов: например, базы данных PostgreSQL Server, брокера сообщений RabbitMQ и др. 
    * **Primo RPA Orchestrator 1.24.1.zip** - облегченный вариант поставки.
2. [Скачать дистрибутив Robot Enterprise](https://disk.primo-rpa.ru/index.php/s/primo?path=%2FRelease%2FRobot). Архив должен иметь название **Primo RPA Robot Orchestrator <архитектура> 1.24.1.zip**. Дистрибутив этого робота загружается непосредственно в Оркестратор.
