# Обновления в версии Оркестратора 23.7

Примечания к выпуску Оркестратора 23.7 описывают изменения для версии приложения, выпущенной в июле 2023 года.

### Новые функции
1. Оптимизирована работа экземпляров Оркестратора при развертывании в одном кластере. Теперь в момент запуска им будет назначаться свой диапазон уникальных идентификаторов (id) сущностей из базы данных. Это позволяет ускорить опрос роботов, машин роботов и мониторинг RDP-сессий со стороны Оркестратора.


2. Также была сделана оптимизация работы с РПА-проектами: у нас теперь исходники проектов хранятся в базе, а раньше хранились на диске. Суть: службу, которая следила и проверяла файлики на диске, ее заглушили. перестала использоваться проверка наличия файлов на диске.
"Оптимизация работы с RPA-проектами - не используется проверка наличия файлов архива на диске, так как архивы хранятся в БД".

2. какая задача? - Устранение ошибки при возврате "Попытка изменить статус элемента другим роботом". (это фикс ВТБ (это подверсия орка? 23.6.1), который по чтению элементов в очереди). Там при чтении в очереди др роботом, не из студии, возвращался forbid, вместо конфликта. Максим нашел, поправил.

3. (2670) Просмотр активной сессии RDP. Про стрим рабочего стола машин робота - подсмотреть за роботом, не мешая ему. Функция добавлена в раздел UI "Машины робота" - надо в колонке "RDP-сессия активна" нажать кнопку "Консоль". Откроется окно стриминга. Благодаря этому можно посмотреть, запустился робот или нет. Без лишних теневых сессий, попыток перехватить у робота сессию, зайти под ним, посмотреть, завис он или нет. Фактически это новый сервис RDP, который отдает этот стрим. Этот же функционал доступен из формы с роботами: т.е. когда робот запустился, у него поднялась рдп-сессия, она поднялась раньше, чем он запустился - оттуда тоже можно перейти на его рабочий стол и посмотреть, как он запускается, как работает. (это не теневая сессия - она, кстати, мощнее, потому что позволяет контроль перехватить. в текущей реализации стрима контроля нет, можем только посмотреть). Передача картинки рдп-сервером идет на сервер Оркестратора. Наша служба создает сессию с помощью библиотеки (FreeRDP) и отдает стрим. Нагрузка на сервер тоже возрастает, но не критично. Нагрузку отдает служба РДП2, она у нас не на машине робота. Настройки РДП2 изменились: добавились новые параметры (это д.б. дописано в доке по разворачиванию рдп2 - новые параметры, которые в конфиг добавились). 

(Видеосигнал идет к Орку со службы рдп2, но забирается изначально с рдп-сервера (= тачка агента)
это стрим, mjpeg, не скрины)


### Исправленные ошибки
1. 2532 - не все пункты настроек доступны админу при AD-авторизации. Раньше при авторизации с доменной учеткой в UI некоторые пункты не отображались либо были недоступны для редактирования.
2. (2064) Раббит не создает каналы в WebApi при старте. Иногда вебапи стартовал нормально, иногда нет. Оказалось, что в раббите есть каналы (иксченжи) и очереди обычные и автоудаляемые. И вот на автоудаляемых очередях и иксченжах вот эта штука происходила. У нас одни и те же очереди и иксченжи могут создаваться как Орком, так и сервис.робот.логс. Если сервис.робот.логс запускается раньше орка, то все создается нормально. А если вебапи стартовал раньше сервис.робот.логс, то возникал баг, и он начинал сыпать исключениями, и порой раббит даже все коннекшены обрывал. Теперь исправлено, разницы между стартами нет.
3. (2019) Шифровать ключевую фразу для сертификата p12 к раббиту. Был тикет, сделать, чтобы коннекшн с раббитом был с сичпо-м ссл. Для этого исп-ся сертификат P12 и для него исп-ся ключевая фраза. Кл фраза была сделана по тикету без шифрования, поэтому мог кто-нибудь посмотреть ее и приконектиться. У нас 5 сервисов, которые работают с раббитом, и на всех сервисах надо было зашифровать кл фразу. Все сделано. (должны быть внесены изменения в доку по SSL).
4. (2653/846) Не происходит снятие зависших блокировок триггеров, если временные зоны у орка и БД разные. На снятие блокировок есть сервис специальный, который обходит и проверяет. Возникла проблема: если вдруг Орк и БД находятся в разных временных зонах, то эти проверки не срабатывают. Ибо по умолчанию у нас подразумевается, что они в одной зоне. И тут проверка не срабатывала. Поправили, перешли на UTC, проблема исчезла. (с# при преобразовании в код на sql преобразует в код на дату машине - поэтому если у орка дата одна, а на машине другая, ранняя, то роботы начинают работать, устанавливать блокировки, то сервис должен снимать блокировки через таймаут. а тут время разное, снять блокировку невозможно, они накапливались. а потом когда останавливались задания, блокировки снимались и через час-два задания могли самопроизвольно выполняться. баг касался только постгреса)

Это в Новом ажуре, видимо (это 2я часть видео):

5. (1868) Возможность указать для версии проекта значение "Закрыть RDP-сессию" отличное от значения родительской версии.

Это к паузам? -- (907) Фиксация периодов "простоя" машины роботов
- (778) Добавлено отображение времени запуска задания сразу после добавления задания



