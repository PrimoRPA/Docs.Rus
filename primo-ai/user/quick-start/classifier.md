# Работа с классификатором

В данном разделе вы узнаете, как работать со встроенным проектом Classifier. Проект предназначен для разпознавания типа входящего документа и полезен, если пользователь хранит смешанные изображения документов и хочет отсортировать их по типам.

это проект для модели классификации документов. предполагается, что она должна определять 3 типа документов: паспорт, СНИЛС, Торг-12.

## Общий порядок шагов

1. Перейдите в раздел проектом Classifier.
1. Добавьте в проект изображения. 
1. Разметьте добавленные изображения.



3. Перейдите в подраздел «Схемы разметки» и создайте схему разметки для ваших изображений.
4. Добавьте в схему разметки все поля, которые могут присутствовать в том типе документа, который вы хотите распознавать. Например, для паспорта понадобится добавить поля: ФИО, дата рождения и т.д.
5. Перейдите в подраздел «Разметка данных». Выберите схему разметки, созданную в шаге 3, нажмите **Add bounding box** и с помощью специального инструмента разметьте поле на изображении. Повторите это действие для всех полей, указанных в схеме.
6. Перейдите в подраздел «Обучение > Датасеты». Добавьте датасет. Выберите ваш датасет и схему, нажмите **Перейти к добавлению**. Отобразится страница «Добавить в датасет» с таблицей размеченных изображений и кнопкой «Добавить в датасет». Выбрать все изображения и нажать на «Добавить в датасет». Датасет на этом этапе будет успешно сформирован и состоять из схемы разметки и размеченных изображений.
7. Перейдите в подраздел «Обучение > Шаблоны обучения». Добавьте шаблон обучения. При отсутствии на портале шаблона модели, необходимо его добавить через «Настройки» -> «…» -> «Шаблоны моделей».
8. Активировать меню нового шаблона процесса, нажав на символ «≡», выбрать во всплывающем меню «Процессы». Отобразится страница «Процессы обучения» с пустой таблицей и кнопкой «Добавить процессы обучения».
Нажать на «Добавить процессы обучения». Отобразится форма «Добавить Процесс Обучения» с обязательными полями «Целевая машина» и «Датасет».
Если на портале не настроена целевая машина, перейти к Требованию 2.
В списке отображаются целевые машины, с которыми не связаны другие процессы обучения для указанного типа модели (в данном случае – Торг12).
Заполнить обязательные поля, выбрав свободную целевую машину и датасет, нажать на «Сохранить».
Новый процесс обучения отобразится в таблице.
Если целевая машина занята, или агент на ней недоступен, машина не отобразится в списке.

### Шаг 1 - Переходим в проект

Перейдите в раздел проектом Classifier.

### Шаг 2 - Добавляем изображения

1. Перейдите в подраздел проекта «Данные».
2. Нажмите кнопку **Добавить изображения**.
3. Выберите со своего диска все изображения, которые хотите добавить. Допускается массовое добавление изображений.
4. Нажмите **Сохранить** для добавления изображений.
5. Загруженные изображения отобразятся в общей таблице.

### Шаг 3 - Размечаем изображения

1. Перейдите в подраздел проекта «Разметка данных».
1. Нажмите кнопку **Создать схему**, если вы не добавляли схемы разметки ранее. Схема определяет, какие поля должна находить нейронная сеть в изображениях. 
1. Укажите название схемы и нажмите **Сохранить**.
1. Добавьте в схему поля: 
   * нажмите кнопку **Добавить поле**, в названии поля укажите passport, сохраните изменения;
   * нажмите кнопку **Добавить поле**, в названии поля укажите snils, сохраните изменения;
   * нажмите кнопку **Добавить поле**, в названии поля укажите torg-12, сохраните изменения.
1. Приступаем к разметке данных.



Активировать меню нового процесса, нажав на символ «≡», выбрать во всплывающем меню «Запустить».
В этот момент запустится длительный процесс обучения на целевой машине.
Дождаться статуса «Выполняется» процесса обучения, обновляя страницу.
В этот момент запущен реальный процесс обучения, который длится несколько часов.
Итогом процесса обучения является обученная модель (архив с .pth-файлом модели, а также её метаданными – config.yaml), которая отображается на странице «Модели».
Получить обученную модель.
Есть 3 способа выполнить этот шаг:
А. Сымитировав успешное завершение обучения.
Для этого необходимо разместить в рабочей директории модели файлы:
Сама модель – model.pth.
Метаданные модели – config.yaml.
Файл-индикатор успешного завершения процесса обучения – complete.succeed.
Б. Запустив процесс обучения на целевой машине, где развернут агент, работающий с тестовой утилитой.
В этом случае процесс займет около 2 минут, а сгенерированная модель не будет рабочей.
В. Нормальное ожидание завершения процесса (несколько часов).
Активировать пункт меню «Модели».
Отобразится страница «Модели» с таблицей.
Проверить наличие вновь сформированной модели в таблице.


**Выполнение инференса**


Активировать пункт меню «Инференс».
Отобразится страница «Шаблоны процесса Inference» с пустой таблицей и кнопкой «Добавить шаблон инференс».
Нажать на «Добавить шаблон инференс».
Отобразится форма создания шаблона.
Заполнить обязательные поля:
Тип (Торг12)
Название
Модель
(выбрать обученную при выполнении испытаний Требования 3 модель, или другую заранее обученную модель)
Схема разметки
(выбрать созданную при выполнении испытаний Требования 3 схему разметки, или другую, совпадающую по структуре полей)
Новый шаблон процесса обучения отобразится в таблице.
4. Активировать меню нового шаблона процесса, нажав на символ «≡», выбрать во всплывающем меню «Процессы».
Отобразится страница «Процессы Inference» с пустой таблицей и кнопкой «Добавить Процесс Inference».
5. Нажать на «Добавить Процесс Inference».
Отобразится форма создания процесса.
6. Выбрать доступную целевую машину и нажать на «Сохранить».
В списке отображаются целевые машины, с которыми не связаны другие процессы Inference для указанного типа модели (в данном случае – Торг12).
Новый процесс отобразится в таблице.
7. Активировать меню нового процесса, нажав на символ «≡», выбрать во всплывающем меню «Запустить».
8. Дождаться статуса «Выполняется» нового процесса, обновляя страницу.
9. Отправить запрос на распознавание изображения через API-метод POST https://10.0.0.124:5022/inference/Requests  с токеном доступа, содержащим разрешения типа «Permissions.ApiInference.Request». Указать в теле запроса типа multipart/form-data изображение с документом Торг-12.
Ответом будет ключ запроса, который далее используется для получения результатов распознавания.
10. Дождаться появления результата со статусом 200, опрашивая API сервиса Inference методом GET https://10.0.0.124:5022/inference/Requests/:requestKey , где вместо :requestKey требуется указать ответ сервиса из п. 9 без кавычек.
11. Убедиться, что размеченные поля в документе распознаны.
