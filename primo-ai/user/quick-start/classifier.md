# Работа с классификатором документов

В данном разделе вы узнаете, как работать со встроенным проектом «Классификатор». Проект предназначен для работы с моделью классификации документов или, иначе, *моделью-классификатором*. Данная модель будет полезна, если пользователь хранит у себя смешанные изображения документов и хочет автоматически распределить их по типам перед тем, как перейти к распознаванию данных в едином типе документов. 

## Ожидаемый результат 
Обученная модель-классификатор должна уметь определять 3 типа документов: 
* паспорт;
* СНИЛС;
* Торг-12.


## Стадии работы 

1. **Обучение модели-классификатора.** Успешный результат — обученная модель-классификатор.
2. **Настройка и запуск инференса на целевой машине.** Успешный результат — подготовленная машина, на которой возможно выполнять классификацию реальных изображений документов по их типам.


## Обучение модели-классификатора

### Шаг 1 — Переходим в проект

Перейдите в раздел проектом «Классификатор».

![](<../../../.gitbook/assets1/primo-ai/go-to-classifier.png>)

### Шаг 2 — Добавляем изображения

***Примечание**. Ознакомьтесь с [требованиями к изображениям для обучения](https://github.com/PrimoRPA/Docs.Rus/blob/1299-%D0%BD%D0%B0%D0%BF%D0%B8%D1%81%D0%B0%D1%82%D1%8C-%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82-%D0%BF%D0%BE-primoai/primo-ai/user/other/dataset-quality-requirements.md). Помните, что требуется добавить минимум 20 изображений одного типа документа.*

1. Перейдите в подраздел проекта «Данные».
2. Нажмите кнопку **Добавить изображения**.

   ![](<../../../.gitbook/assets1/primo-ai/classifier-2-new.png>)
 
3. Выберите со своего диска все изображения, которые вы хотите добавить. 
4. Нажмите **Сохранить**, чтобы изображения добавились в проект.

Загруженные изображения отобразятся в таблице данных проекта.

![](<../../../.gitbook/assets1/primo-ai/classifier-3.png>)

### Шаг 3 — Размечаем изображения

#### Перед началом работы
*Ознакомьтесь с [рекомендациями по разметке данных](https://github.com/PrimoRPA/Docs.Rus/blob/1299-%D0%BD%D0%B0%D0%BF%D0%B8%D1%81%D0%B0%D1%82%D1%8C-%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82-%D0%BF%D0%BE-primoai/primo-ai/user/other/datalabeling-requirements.md).*

#### 3.1. Создайте схему разметки
Перейдите в подраздел проекта «Разметка данных».

![](<../../../.gitbook/assets1/primo-ai/classifier-labeling-1.png>)

В панели справа, в блоке **Схема**, разверните список значений и нажмите кнопку **Создать схему**. Схема определяет, какие поля должна находить нейронная сеть в изображениях. 

![](<../../../.gitbook/assets1/primo-ai/classifier-5.png>)

Укажите произвольное название\* схемы и нажмите **Сохранить**. 

> \**Название может состоять только из букв и цифр, дефиса, подчеркивания и точки.*

#### 3.2. Добавьте поля в схему разметки
Добавьте в схему поля, соответствующие типу документа: 
* нажмите кнопку **Добавить поле**, назовите\* поле passport, сохраните изменения;
* нажмите кнопку **Добавить поле**, назовите поле snils, сохраните изменения;
* нажмите кнопку **Добавить поле**, назовите поле torg-12, сохраните изменения.

![](<../../../.gitbook/assets1/primo-ai/classifier-6.png>)

> \**Поля могут называться иначе, но должны передавать взаимосвязь с типом документа*.

#### 3.3. Соотнесите поля с изображениями

***Совет**:*
* *Колесиком прокрутки мыши можно увеличивать и уменьшать масштаб изображения в рабочей области.*
* *Если изображение необходимо повернуть, используйте инструмент **Rotate image (r)**.*

В панели справа выберите тип поля в соответствии с текущим изображением документа. Например, если вы начали работу с изображением документа Торг-12, то в панели справа тоже выберите поле torg-12.

![](<../../../.gitbook/assets1/primo-ai/classifier-7-new.png>)

В верхней панели выберите инструмент **Add Bounding Box (b)**.

![](<../../../.gitbook/assets1/primo-ai/classifier-bounding-box.png>)

Выделите инструментом **Add Bounding Box (b)** значимую часть документа — область с данными. На рисунке ниже область с данными отображается пунктирной линией.

![](<../../../.gitbook/assets1/primo-ai/classifier-9.png>)

Справа, в блоке «Датасет», выберите тип датасета «Обучение» и нажмите кнопку **Сохранить разметку**.

![](<../../../.gitbook/assets1/primo-ai/classifier-9-2.png>)

Перейдите к следующему изображению вашей галереи:
* сначала выберите тип поля в соответствии с документом на изображении. Например, если следующее изображение относится к паспорту, то выберите поле passport (1);
* инструментом **Add Bounding Box (b)** выделите значимую часть документа на изображении;
* сохраните разметку изображения в датасете «Обучение» (2 и 3). 

![](<../../../.gitbook/assets1/primo-ai/classifier-labeling-other-docs.png>)
  
Завершите разметку оставшихся изображений проекта. Добавляя изображение в датасет, не забывайте каждый раз сохранять разметку.

#### 3.4. Разделите датасеты

Оставьте примерно 10-20% изображений для тестового датасета. Соотнесите каждое изображение с правильным полем, выделите область с данными инструментом **Add Bounding Box (b)**, но при сохранении разметки изображения укажите датасет «Тестовый».

Изображения, добавленные в тестовый датасет, будут помечены зеленым цветом в вашей галерее.

![](<../../../.gitbook/assets1/primo-ai/classifier-test-dataset.png>)


#### 3.5. Проверьте качество разметки

После окончания разметки изображений проверьте еще раз соответствие документов выбранным полям. Ошибка негативно повлияет на качество распознавания документов моделью-классификатором.


### Шаг 4 — Создаем шаблон обучения

1. Перейдите в подраздел проекта «Обучение» на вкладку «Шаблоны обучения».
1. Нажмите кнопку **Добавить шаблон обучения**.

   ![](<../../../.gitbook/assets1/primo-ai/classifier-processtemplates.png>)

1. Заполните форму:
   * Укажите произвольное название шаблона. Наименование должно состоять только из букв и цифр, дефиса, подчеркивания и точки.
   * В поле **Тип** выберите `classifier`.
   * В качестве шаблона модели выберите значение `Базовая модель`.
   * При необходимости укажите краткое описание модели, которое позволит идентифицировать шаблон среди других шаблонов проекта.
   * Убедитесь, что в параметре **Искусственно расширить датасет** указано значение `повороты + экспозиция + шум` — это позволит искусственно расширить датасет и улучшить результаты обучения модели.
   * Все оставшиеся параметры оставьте без изменений.

   ![](<../../../.gitbook/assets1/primo-ai/classifier-add-training-templates.png>) 

После чего нажмите **Сохранить**, чтобы добавить шаблон в систему.


### Шаг 5 — Создаем процесс обучения

***Примечание**. На одной целевой машине можно создать только один процесс*.

1. Перейдите в подраздел «Обучение» на вкладку «Шаблоны обучения».
1. В строке с вашим шаблоном выберите действие **Процессы**.

   ![](<../../../.gitbook/assets1/primo-ai/class-goto-training-proccesses.png>) 

1. Нажмите кнопку **Добавить процесс обучения**.
  
   ![](<../../../.gitbook/assets1/primo-ai/class-add-training-proccess.png>) 

1. В форме добавления процесса укажите целевую машину, на которой будет проводиться обучение модели классификатора.

   ***Примечание**. Целевая машина заранее настраивается администратором системы. Если у вас нет доступных целевых машин, обратитесь с данным вопросом к ответственному лицу*.

Сохраните настройки, чтобы добавить процесс в систему. Новый процесс отобразится в таблице и будет иметь статус **Создан**.

![](<../../../.gitbook/assets1/primo-ai/class-training-processadded.png>) 


### Шаг 6 — Запускаем процесс обучения

1. Перейдите в подраздел проекта «Обучение» на вкладку «Шаблоны обучения».
1. В строке с вашим шаблоном выберите действие **Процессы**.
1. Для созданного процесса обучения выберите действие **Запустить**.
1. Дождитесь, когда статус изменится на «Выполняется».

![](<../../../.gitbook/assets1/primo-ai/class-training-process-is-running.png>) 

В результате запустится процесс обучения модели на целевой машине. Это длительный процесс, который, как правило, занимает несколько часов и зависит от размера датасета. Чтобы узнать приблизительное время обучения вашей модели, разверните справочную информацию о процессе. В колонке «~До окончания» вы увидите примерное время, оставшееся до завершения процесса. 

![](<../../../.gitbook/assets1/primo-ai/class-training-process-timeuntil.png>) 


### Шаг 7 — Мониторинг процесса обучения 

***Примечание**. Данный шаг является необязательным.*

1. Чтобы отследить метрики запущенного обучения, выберите для вашего процесса действие **Мониторинг обучения**.

   ![](<../../../.gitbook/assets1/primo-ai/class-process-monitoring.png>) 

3. На странице мониторинга вы увидите график со следующими показателями:
   * *Изменение коэффициента обучения (зеленая кривая).*
   * *Функция потерь или количество ошибок на обучающем датасете (синяя кривая). Успешный сценарий предполагает, что это значение должно уменьшаться по мере улучшения обучения модели.*
   * *Рост качества на тестовом датасете, т.е. средней точности предсказания (красная кривая).*

   ![](<../../../.gitbook/assets1/primo-ai/>) 


### Шаг 8 — Проверяем наличие обученной модели

***Примечание**. Обученная модель представляет собой архив с .pth-файлом модели, а также её метаданными – файл config.yaml.*

1. Убедитесь, что обучение модели завершено успешно — в колонке «Статус» должно отобразиться состояние **Успешно завершен**.

   ![](<../../../.gitbook/assets1/primo-ai/class-training-process-success.png>)
   
1. Перейдите на страницу «Модели». Если все прошло успешно, то в таблице отобразится имя вашей обученной модели. 

   ![](<../../../.gitbook/assets1/primo-ai/class-model-is.png>)

Теперь можно переходить к следующему этапу — настройке и запуску инференса на целевой машине. 


## Настройка и запуск инференса


### Шаг 1 — Создаем шаблон процесса инференса

1. Перейдите на страницу «Инференс» на вкладку «Шаблоны процесса Inference».
1. Нажмите кнопку **Добавить шаблон инференс**.

   ![](<../../../.gitbook/assets1/primo-ai/class-add-inftemplate.png>)

1. Заполните поля формы:
   * **Название\*** — название шаблона инференса для отображения в веб-интерфейсе. Должно состоять только из 
   * **Описание** — краткое описание шаблона, если необходимо.
   * **Модель\*** — выберите из списка обученную модель для классификации изображений.
   * **Схема разметки\*** — укажите схему разметки, которую вы использовали для обучения вашей модели-классификатора.
   * **Допустимые расширения файлов** — выберите допустимые расширения для изображений инференса. Если расширения не указаны, то......
1. Укажите в форме положение параметров-переключателей:
   * **Определение ориентации страницы перед распознаванием** — следует ли определять ориентацию страницы перед распознаванием. Если включено, то..... По умолчанию выключено — ориентация не определяется.
   * **Удаление линий** — следует ли удалять линии из изображений (какие линии, для чего?). По умолчанию выключено — линии не будут удаляться.
   * **Вычитание из текста наименований полей** — следует ли вычитать из текста названия полей. Если включено, то......   По умолчанию выключено — названия полей не вычитаются.
   * **Парсинг заголовка таблицы** — следует ли парсить заголовки таблицы (что это значит). Если включено, то... По умолчанию выключено — заголовки не парсятся.

1. Нажмите **Сохранить**.



### Шаг 2 — Создаем процесс инференса

1. Перейдите на страницу «Инференс» на вкладку «Шаблоны процесса Inference».
1. 


### Шаг 3 — Запускаем процесс инференса

1.


## Работа с RPA-проектом






