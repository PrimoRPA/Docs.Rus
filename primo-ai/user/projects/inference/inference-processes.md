# Инструкция по запуску инференса

Роль пользователя должна иметь следующие минимальные права: 
* Шаблоны инференс — Просмотр, Создание
* Процесс инференс — Просмотр, Создание, Управление

## Шаг 1. Настройка полей для инференса

Настройка полей схемы разметки помогает качественнее произвести распознавание на новых данных. Выполните настройку полей перед тем, как выполнять инференс на целевой машине.

### Если вы работаете с моделью распознавания
1. Перейдите на страницу **Инференс > Поля**:
   * В центре рабочей области откроется изображение из обучающего датасета. Изображение служит в качестве наглядного примера, чтобы было легче настраивать поля схемы.
   * Справа от рабочей области отобразится панель с полями схемы разметки.

   ![](<../../../../.gitbook/assets1/primo-ai/user-guide/tab-fields-inf.png>)
   
1. Разверните каждое поле и произведите настройку его параметров.

   ![](<../../../../.gitbook/assets1/primo-ai/user-guide/parameters-field-inf.png>)

   Так, на рисунке выше, у поля «Грузоотправитель» есть следующие параметры:
   * **Тип\*** — тип данных значения. Для грузоотправителя типом данных будет String — он совпадает с типом данных по умолчанию.
   * **Язык\*** — язык данных в выбранном поле. Возможные значения:
     * *Any — русский и английский. Значение по умолчанию.*
     * *Rus;*
     * *Eng.*
   * **Ориентация\*** — ориентация значения в поле. Возможные значения:
     * *0 — горизонтальная ориентация. Значение по умолчанию.*
     * *90 — поворот на 90 градусов по часовой стрелке.*
     * *180 — поворот на 180 градусов по часовой стрелке.*
     * *270 — поворот на 270 градусов по часовой стрелке.*
   * **Строки** — максимальное количество строк, которое ожидается в данном поле. Так, в поле «Грузоотправитель» максимально может быть 3 строки текста, а в поле «Дата составления»  — 1 строка. По умолчанию значение не задано.
1. В завершение нажмите **Сохранить**.

Перейдите к настройке следующего поля, не забывайте каждый раз сохранять изменения. Поля для выбранной схемы разметки настраиваются один раз и затем применяются для всех изображений данного вида.


### Если вы работаете с моделью-классификатором
Поскольку каждое поле при классификации представляет собой определенный тип документа, то настройка полей для модели-классификатора производится проще и быстрее.

Чтобы настроить поля:
1. Перейдите на страницу **Инференс > Документы**.

   ![](<../../../../.gitbook/assets1/primo-ai/user-guide/tab-doc-in-inference.png>)

1. В панели справа разверните каждое поле и выберите тип модели нейросети, который должен распознавать данные в этом документе после выполнения классификации.
1. Нажмите **Сохранить**.

Подобным образом выберите тип модели для каждого поля, не забывая сохранять указанные настройки. 


## Шаг 2. Создание шаблона процесса инференса

1. Перейдите на страницу **Инференс > Шаблоны процесса Inference**.
1. Нажмите кнопку **Добавить шаблон инференс**.

   ![](<../../../../.gitbook/assets1/primo-ai/class-add-inftemplate.png>)

1. Заполните поля формы:
   * **Название\*** — название шаблона инференса для отображения в веб-интерфейсе. Название может состоять только из букв и цифр, дефиса, подчеркивания и точки.
   * **Описание** — краткое описание шаблона.
   * **Модель\*** — выберите из списка обученную модель для инференса.
   * **Схема разметки\*** — укажите схему разметки, которую вы использовали для обучения модели.
   * **Допустимые расширения файлов** — выберите расширения, допустимые для изображений инференса. Обязательно укажите хотя бы одно расширение, иначе инференс будет невозможен. 

   ![](<../../../../.gitbook/assets1/primo-ai/user-guide/inference-template-form-1.png>)

1. Укажите положение параметров-переключателей:

   :large_orange_diamond:***Важно**. Если вы работаете с моделью классификации, то оставьте все переключатели выключенными (значение по умолчанию). Для модели классификации их положение не играет роли.*

    * **Определение ориентации страницы перед распознаванием** — переведите переключатель вправо, если документы для инференса могут иметь неправильную ориентацию (например, документ на скане повернут боком). Автоматическое определение ориентации поможет распознать данные правильно, но увеличит время инференса на несколько секунд для каждого изображения. По умолчанию ориентация страницы не определяется.
   * **Удаление линий** — переведите переключатель вправо, если из документов для инференса следует удалять линии. Например, данные на странице паспорта разделены линиями, что может мешать распознаванию. Автоматическое удаление линий поможет распознать данные правильно, но увеличит время инференса. По умолчанию линии не удаляются.
   * **Вычитание из текста наименований полей** — переведите переключатель вправо, если из распознанных значений следует вычитать фрагменты названий полей. Фрагменты названий могут случайно попасть в область для распознавания, если разметка изображений на этапе обучения была произведена с небольшими погрешностями. Активированный переключатель увеличит время инференса.
   * **Парсинг заголовка таблицы** — переведите переключатель вправо, если в документах для инференса, содержащих таблицы, следует распознавать заголовки столбцов. Активированный переключатель увеличит время инференса. Если в вашем документе таблица имеет постоянную структуру и известные названия столбцов, то для ускорения инференса заголовки можно не распознавать (значение по умолчанию).

   ![](<../../../../.gitbook/assets1/primo-ai/user-guide/inference-template-form-2.png>)

1. В завершение нажмите **Сохранить** — cозданный шаблон отобразится в табличной части страницы.


## Шаг 3. Создание процесса инференса

1. Выберите для вышего шаблона действие **Процессы**.

   ![](<../../../../.gitbook/assets1/primo-ai/class-goto-infprocess.png>)

1. Нажмите кнопку **Добавить Процесс Inference**.
1. Выберите доступную целевую машину и нажмите **Сохранить**.

   :large_blue_diamond:***Примечание**. Целевые машины настраиваются заранее администратором. Если доступных машин нет, обратитесь к ответственному лицу в вашей организации.*

В результате процесс инференса отобразится в табличной части со статусом `Создан`.


## Шаг 4. Запуск процесса инференса

1. Выберите для вашего процесса инференса действие **Запустить**.

   ![](<../../../../.gitbook/assets1/primo-ai/class-run-inferece-process.png>)

1. Дождитесь, когда статус процесса изменится на `Выполняется`. 

   :large_orange_diamond:***Примечание**. Если статус изменился на **Ошибку**, то разверните запись с процессом инференса и ознакомьтесь с текстом ошибки, чтобы понять, что именно необходимо исправить.*

## Что дальше

На этом работа с проектом в интерфейсе Primo RPA AI Server может быть окончена. Если все шаги пройдены корректно, то вы получите целевую машину, подготовленную для принятия и обработки изображений обученной моделью. Время, в течение которого машина будет готова к инференсу, программно не ограничено\*. 

Если в вашей организации имеются другие доступные целевые машины, то вы можете создать дополнительные процессы инференса в текущем шаблоне, чтобы горизонтально масштабировать работу по предсказанию новых данных и сократить время на инференс.

> \**Пользователь имеет возможность вручную остановить запущенный процесс инференса, чтобы освободить целевую машину. Для этого ему нужно применить действие **Остановить**.*



