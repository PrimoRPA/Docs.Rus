# Инструкция по разметке изображений

## Перед началом работы
Ознакомьтесь с [рекомендациями по разметке данных](https://github.com/PrimoRPA/Docs.Rus/blob/1299-%D0%BD%D0%B0%D0%BF%D0%B8%D1%81%D0%B0%D1%82%D1%8C-%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82-%D0%BF%D0%BE-primoai/primo-ai/other/datalabeling-requirements.md).

Роль пользователя, производящего разметку, должна иметь права «Разметка — Просмотр», «Разметка — Создание», «Разметка — Удаление».

## Описание рабочей области

Разметка изображения производится на странице **Разметка данных**. На ней вы увидите следующую рабочую область.

![](<../../../../.gitbook/assets1/primo-ai/user-guide/labeling-workspace.png>)

#### 1. Панель инструментов

Сверху расположена панель инструментов для работы с изображением. Слева направо:
* **Select (v)** — позволяет выбрать размеченное поле (*регион*), чтобы применить к нему какое-либо действие. Например, удалить клавишей `Del`, скорректировать выделенную область, перетащить в другое место изображения (потянув за точку в центре). 
* **Drag/Pan (right or middle click) (d)** — перетаскивание изображения в пределах рабочей области.
* **Zoom In/Out (scroll)  (z)** — позволяет увеличить или уменьшить масштаб изображения в рабочей области. Также масштаб возможно изменить колесиком мыши.
* **Add Bounding Box (b)** — описывающий прямоугольник. Основной инструмент для разметки данных, используется для обозначения местоположения и размера объекта на изображении. Bounding box должен минимально охватывать объект на изображении.
* **Fit to screen (f)** — расположить изображение по размеру экрана.
* **Rotate image (r)** — повернуть изображение. Выравнивание / поворот изображение позволяет выполнить разметку точнее.

#### 2. Функциональный блок для работы со схемой разметки
В данном блоке вы можете:
* Выбрать схему разметки, если вы ее создали заранее.
* Создать схему разметки, если в проекте нет ни одной схемы.
* Добавить в схему новые поля.
* Выбрать поле для разметки.

#### 3. Функциональный блок для работы с регионами

Регион представляет собой сохраненную размеченную область. Название региона — это поле, которое вы выбрали при разметке. Справа от названия региона находятся кнопки:
* Удалить — позволяет удалить регион из датасета.
* Блокировать / Разблокировать — при блокировке размеченную область нельзя скорректировать. При разблокировке (замочек открыт), вы можете скорректировать область с данными, которую ранее выделили инструментом **Add Bounding Box (b)**.
* Скрыть / Отобразить — управляет видимостью региона на изображении.

![](<../../../../.gitbook/assets1/primo-ai/user-guide/regions-labeling.png>)


#### 4. Функциональный блок для работы с датасетами

В каждом проекте существует 2 датасета, созданных автоматически:
* Обучение — на этом наборе данных модель будет тренироваться. Поместите в этот датасет 90% размеченных изображений.
* Тестовый — на этом наборе данных модель будет проверять свои способности между этапами обучения. Поместите в этот датасет 10% размеченных изображений.

#### 5. Галерея изображений проекта

В галерее отображаются все изображения, которые вы загрузили в проект. После того, как вы закончили разметку одного изображения, кликните по другой миниатюре, чтобы переключиться между изображениями. При необходимости добавить новое изображение, нажмите `+`. 


## Как разметить изображение

Порядок выполнения шагов:
1. Создание либо выбор существующей схемы разметки.
2. Добавление полей в схему разметки.
3. Разметка данных по выбранным полям.
4. Сохранение размеченных изображений в датасеты для обучения и тестирования обучения. 
5. Ручная валидация разметки.


### Шаг 1. Создайте схему разметки

:large_orange_diamond:***Важно**. Если схема уже создана, просто выберите ее в списке значений*.

В функциональном блоке **Схема** разверните список значений и, если он пуст, нажмите кнопку **Создать схему**. Схема определяет, какие поля должна находить нейронная сеть в изображениях. 

![](<../../../../.gitbook/assets1/primo-ai/classifier-5.png>)

Укажите произвольное название\* схемы и нажмите **Сохранить**. 

> \**Название может состоять только из букв и цифр, дефиса, подчеркивания и точки.*

### Шаг 2. Добавьте поля в схему разметки
:large_orange_diamond:***Важно**. Пропустите данный шаг, если схема уже создана, и все необходимые поля добавлены*.

![](<../../../../.gitbook/assets1/primo-ai/user-guide/block-scheme-addfield.png>)

Добавьте в схему поля: 
* Если вы используете модель-классификатор, то название поля должно соответствовать типу документа. Например, ваша цель классифицировать изображения по трем типам документов: паспорт, СНИЛС, Торг-12. Значит, поля должны называться аналогично.
* Если вы используете модель для распознавания данных в документе, то название поля — это категория информации, которая должна быть извлечена из документа. Например, если вы обучаете модель для распознавания данных в паспортах, то поля «Фамилия» или «Дата рождения» будут являться категориями информации, которые необходимо извлечь и структурировать для использования моделью. 


### Шаг 3. Соотнесите поля с изображениями

:large_blue_diamond:***Совет**. Разметка должна быть выполнена одинаковым образом для всех изображений одного типа. Соблюдайте одинаковые зазоры между текстом и описывающим прямоугольником (bounding box).*

1. В блоке **Схема** выберите тип поля, кликнув по нему. Выбранное поле подсветится синим. Так, на рисунке ниже выбрано поле `Грузополучатель`.

   ![](<../../../../.gitbook/assets1/primo-ai/user-guide/field-choosed.png>)

1. В панели инструментов выберите **Add Bounding Box (b)**.

   ![](<../../../../.gitbook/assets1/primo-ai/classifier-bounding-box.png>)

1. Выделите инструментом **Add Bounding Box (b)** значимую область документа:
   * Для **модели-классификатора** значимой областью будет весь документ. Например, на рисунке ниже прямоугольником выделен документ Торг-12.

   ![](<../../../../.gitbook/assets1/primo-ai/classifier-9.png>)

   * Для **модели, распознающей поля в документе**, значимой областью будет часть изображения, содержащая данные, относящиеся к выбранному полю. Так, на рисунке ниже для поля `Грузоотправитель` выбрана область накладной, содержащая данные о грузоотправителе.

   ![](<../../../../.gitbook/assets1/primo-ai/user-guide/labeling-shipper-field.png>)

   Если ваш документ содержит таблицу, то советуем размечать ее следующим образом:
   * Создайте в схеме разметки поле **Шапка_таблицы**, выберите это поле, после чего выделите инструментом **Add Bounding Box (b)** область, содержащую заголовки таблицы.
   * Создайте в схеме разметки поле **Тело_таблицы**, выберите это поле, после чего выделите инструментом **Add Bounding Box (b)** область, содержащую ячейки с данными таблицы. 
   * Создайте в схеме разметки поле **Подвал_таблицы**, выберите это поле, после чего выделите инструментом **Add Bounding Box (b)** область, содержащую нижнюю часть таблицы с результирующими данными.

   Если шапка, тело или подвал таблицы может содержать разное количество строк, позаботьтесь о том, чтобы в вашем датасете было как можно больше изображений с примерами для каждого случая. Это позволит модели лучше обучиться и понять, что в документах одного типа могут быть разные варианты таблиц.

1. В блоке **Датасет** выберите тип датасета «Обучение» и нажмите кнопку **Сохранить разметку**.

   ![](<../../../../.gitbook/assets1/primo-ai/classifier-9-2.png>)

1. Размеченные области отобразятся в функциональном блоке **Регионы**.

1. Перейдите к следующему изображению вашей галереи и разметьте его аналогичным образом. Не забывайте сохранять разметку для каждого изображения.


### Шаг 4. Разделите датасеты

Оставьте примерно 10-20% изображений для тестового датасета. При сохранении разметки этих изображений указывайте датасет «Тестовый». Изображения, добавленные в тестовый датасет, будут помечены зеленым цветом в вашей галерее.

![](<../../../../.gitbook/assets1/primo-ai/classifier-test-dataset.png>)


### Шаг 5. Проверьте качество разметки

После окончания разметки изображений проверьте еще раз соответствие областей с данными выбранным полям. Ошибка негативно повлияет на качество обучения и распознавания документов моделью.

Если вы хотите скорректировать какую-либо размеченную область, воспользуйтесь доступными действиями в функциональном блоке **Регионы**. После того, как вы скорректировали регион, не забудьте повторно сохранить разметку для вашего изображения.

