# Как запустить инференс

Роль пользователя должна обладать следующими минимальными правами: 
* Шаблоны инференс — Просмотр, Создание
* Процесс инференс — Просмотр, Создание, Управление

## Шаг 1. Настройте поля схемы разметки перед инференсом

Настройка полей поможет модели качественнее произвести распознавание на новых данных. 

### 1.1. Для модели распознавания документа

1. Перейдите на страницу **Инференс > Поля**:
   * В центре рабочей области откроется изображение из обучающего датасета. Изображение служит в качестве наглядного примера, чтобы было легче настраивать поля схемы.
   * Справа от рабочей области отобразится панель с полями схемы разметки.

   ![](<../../../../.gitbook/assets1/primo-ai/user-guide/tab-fields-inf.png>)
   
1. Разверните каждое поле и произведите настройку его параметров.

   ![](<../../../../.gitbook/assets1/primo-ai/user-guide/parameters-field-inf.png>)

   Так, на рисунке выше, у поля «Грузоотправитель» есть следующие параметры:
   * **Тип\*** — тип данных значения. Например, у грузоотправителя тип данных String — он совпадает с типом данных по умолчанию.
   * **Язык\*** — язык данных в выбранном поле. Возможные значения:
     * *Any — русский и английский. Значение по умолчанию.*
     * *Rus;*
     * *Eng.*
   * **Ориентация\*** — ориентация значения в поле. Возможные значения:
     * *0 — горизонтальная ориентация. Значение по умолчанию.*
     * *90 — поворот на 90 градусов по часовой стрелке.*
     * *180 — поворот на 180 градусов по часовой стрелке.*
     * *270 — поворот на 270 градусов по часовой стрелке.*
   * **Строки** — максимальное количество строк, которое ожидается в данном поле. Так, в поле «Грузоотправитель» максимально может быть 3 строки с текстом, а в поле «Дата составления»  — 1 строка. По умолчанию значение не задано.
1. В завершение нажмите **Сохранить**.

Перейдите к настройке следующего поля и каждый раз сохраняйте изменения. Поля для выбранной схемы разметки настраиваются один раз и затем применяются для всех изображений данного вида.


### 1.2. Для модели-классификатора
Поскольку каждое поле при классификации представляет собой определенный тип документа, то настройка полей для модели-классификатора производится проще и быстрее.

Чтобы настроить поля:
1. Перейдите на страницу **Инференс > Документы**.

   ![](<../../../../.gitbook/assets1/primo-ai/user-guide/tab-doc-in-inference.png>)

1. В панели справа разверните каждое поле и выберите тот тип модели, который должен распознавать данные в этом документе после выполнения классификации.
1. Нажмите **Сохранить**.

Подобным образом выберите тип модели для каждого поля, не забывая сохранять указанные настройки. 


## Шаг 2. Создайте шаблон процесса инференса

1. Перейдите на страницу **Инференс > Шаблоны процесса Inference**.
1. Нажмите кнопку **Добавить шаблон инференс**.

   ![](<../../../../.gitbook/assets1/primo-ai/user-guide/add-infbutton.png>)

1. Заполните поля формы:
   * **Название\*** — название шаблона инференса для отображения в веб-интерфейсе. Название может состоять только из букв и цифр, дефиса, подчеркивания и точки.
   * **Описание** — краткое описание шаблона.
   * **Модель\*** — выберите из списка обученную модель для инференса.
   * **Схема разметки\*** — укажите схему разметки, которую вы использовали для обучения модели.
   * **Допустимые расширения файлов** — выберите расширения, допустимые для изображений инференса. Обязательно оставьте хотя бы одно расширение, иначе инференс будет невозможен. 

   ![](<../../../../.gitbook/assets1/primo-ai/user-guide/inf-template-form-1.png>)

1. Определите положение чекбоксов:

{% hint style="warning" %}
**Важно**. Если вы работаете с моделью классификации, оставьте все чекбоксы выключенными. Для модели классификации их положение не играет роли.
{% endhint %}

  * **Определение ориентации страницы перед распознаванием** — установите галочку, если документы для инференса могут иметь неправильную ориентацию (например, документ на скане повернут боком). Автоматическое определение ориентации поможет распознать данные правильно, но увеличит время инференса на несколько секунд для каждого изображения. По умолчанию ориентация страницы не определяется.
  * **Удаление линий** — установите галочку, если из документов для инференса следует удалять линии. Например, данные на странице паспорта разделены линиями, что может мешать распознаванию. Автоматическое удаление линий поможет распознать данные правильно, но увеличит время инференса. По умолчанию линии не удаляются.
  * **Парсинг заголовка таблицы** — установите галочку, если в документах для инференса, содержащих таблицы, следует распознавать заголовки столбцов. Распознавание увеличит время инференса. Если в вашем документе таблица имеет постоянную структуру и известные названия столбцов, то для ускорения инференса заголовки можно не распознавать (значение по умолчанию).

  Блок c дополнительными параметрами оставьте без изменений.

  ![](<../../../../.gitbook/assets1/primo-ai/user-guide/inf-templ-form-2.png>)

1. В завершение нажмите **Сохранить** — cозданный шаблон отобразится в табличной части страницы.


## Шаг 3. Создайте процесс инференса

{% hint style="info" %}
Целевые машины настраиваются заранее администратором. Если в списке нет доступной и включенной целевой машины, обратитесь к вашему администратору AI Server.
{% endhint %}

1. Выберите для шаблона действие **Процессы**.

   ![](<../../../../.gitbook/assets1/primo-ai/class-goto-infprocess.png>)

1. Нажмите кнопку **Добавить Процесс Inference**.
1. Выберите доступную целевую машину и нажмите **Сохранить**.

   ![](<../../../../.gitbook/assets1/primo-ai/user-guide/inf-process-machine.png>)

Готово — процесс инференса отобразится в табличной части со статусом `Создан`.


## Шаг 4. Запустите процесс инференса

1. Выберите для процесса инференса действие **Запустить**.

   ![](<../../../../.gitbook/assets1/primo-ai/class-run-inferece-process.png>)

1. Дождитесь, когда статус процесса изменится на `Выполняется`. 

{% hint style="warning" %}
Если статус изменился на **Ошибку**, то разверните запись с процессом инференса и ознакомьтесь с текстом ошибки, чтобы понять, что именно необходимо исправить.
{% endhint %}


## Что дальше

В результате вы получите целевую машину, подготовленную для принятия и обработки изображений обученной моделью. Время, в течение которого машина готова к инференсу, программно не ограничено. 

Если в вашей организации имеются другие целевые машины, то вы можете создать дополнительные процессы инференса в текущем шаблоне, чтобы горизонтально масштабировать работу по предсказанию новых данных и сократить время на инференс.

{% hint style="info" %}
**Примечание.** Доступна возможность вручную остановить процесс инференса, чтобы освободить целевую машину. Для этого примените к запущенному процессу действие **Остановить**.
{% endhint %}

После успешного запуска инференса на целевой машине вы можете:
* Продолжить работу в AI Server и перейти на страницу [Тестирование](https://docs.primo-rpa.ru/primo-rpa/primo-rpa-ai-server/user/smart-ocr/testing), чтобы проверить качество ответов модели перед её эксплуатацией.
* Начать разработку RPA-проекта в Primo RPA Studio, который будет взаимодействовать с AI Server и целевой машиной с запущенным инференсом. 

Для разработки RPA-проекта требуется установить в Primo RPA Studio библиотеку **Primo.AI.Server**. Описание пакета для Studio с ОС Windows см. [здесь](https://docs.primo-rpa.ru/primo-rpa/g_elements/el_extra/ai_server).




