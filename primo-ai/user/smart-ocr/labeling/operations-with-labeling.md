# Инструкция по разметке изображений

Роль пользователя должна иметь права «Разметка — Просмотр», «Разметка — Создание», «Разметка — Удаление».

Перед тем, как приступать к разметке, ознакомьтесь с [рекомендациями по разметке](https://docs.primo-rpa.ru/primo-rpa/primo-rpa-ai-server/user/smart-ocr/labeling/requirements) и [описанием](https://docs.primo-rpa.ru/primo-rpa/primo-rpa-ai-server/user/smart-ocr/labeling/work-area) рабочей области.



## Как разметить изображение

Порядок выполнения шагов:
1. Создание либо выбор существующей схемы разметки.
2. Добавление полей в схему разметки.
3. Разметка данных по выбранным полям.
4. Сохранение размеченных изображений в датасеты для обучения и тестирования обучения. 
5. Ручная валидация разметки.


### Шаг 1. Создайте схему разметки

{% hint style="info" %}
Если схема уже создана, просто выберите ее в списке значений.
{% endhint %}

В функциональном блоке **Схема** разверните список значений и, если он пуст, нажмите кнопку **Создать схему**. Схема определяет, какие поля должна находить модель на изображениях. 

![](<../../../../.gitbook/assets1/primo-ai/classifier-5.png>)

Укажите произвольное название\* схемы и нажмите **Сохранить**. 

> \**Название может состоять только из букв и цифр, дефиса, подчеркивания и точки.*

### Шаг 2. Добавьте поля в схему разметки

{% hint style="info" %}
Пропустите данный шаг, если схема уже создана, и все необходимые поля добавлены.
{% endhint %}

![](<../../../../.gitbook/assets1/primo-ai/user-guide/block-scheme-addfield.png>)

Добавьте в схему поля: 
* Если вы используете **модель-классификатор**, то название поля должно соответствовать типу документа. Например, ваша цель классифицировать изображения по трем типам документов: паспорт, СНИЛС, Торг-12. Значит, поля должны называться аналогично этим типам.
* Если вы используете **модель для распознавания данных в документе**, то название поля — это категория информации, которая должна быть извлечена из документа. Например, если вы обучаете модель для распознавания данных в паспортах, то поля «Фамилия» или «Дата рождения» будут являться категориями информации, которые необходимо извлечь и структурировать для использования моделью. 


### Шаг 3. Соотнесите поля с изображениями

{% hint style="success" %}
**Совет**. Разметка должна быть выполнена одинаковым образом для всех изображений одного типа. Соблюдайте одинаковые зазоры между текстом и описывающим прямоугольником (bounding box).
{% endhint %}


1. В блоке **Схема** выберите тип поля, нажав на его название. Выбранное поле подсветится синим. Так, на рисунке ниже выбрано поле `Грузополучатель`.

   ![](<../../../../.gitbook/assets1/primo-ai/user-guide/field-choosed.png>)

1. В панели инструментов выберите **Add Bounding Box (b)**.

   ![](<../../../../.gitbook/assets1/primo-ai/classifier-bounding-box.png>)

1. Выделите инструментом **Add Bounding Box (b)** значимую область документа:
   * Для **модели-классификатора** значимой областью будет весь документ. Например, на рисунке ниже прямоугольником выделен документ Торг-12.

   ![](<../../../../.gitbook/assets1/primo-ai/classifier-9.png>)

   * Для **модели, распознающей поля в документе**, значимой областью будет часть изображения, которая содержит данные, относящиеся к выбранному полю. Так, на рисунке ниже для поля `Грузоотправитель` выбрана область накладной, содержащая данные о грузоотправителе.

   ![](<../../../../.gitbook/assets1/primo-ai/user-guide/labeling-shipper-field.png>)

   **Если ваш документ содержит таблицу**, то советуем размечать ее следующим образом:
   * Создайте в схеме разметки поле **Шапка таблицы**, выберите это поле, после чего выделите инструментом **Add Bounding Box (b)** область, содержащую заголовки таблицы.
   * Создайте в схеме разметки поле **Тело таблицы**, выберите это поле, после чего выделите инструментом **Add Bounding Box (b)** область, содержащую строки с данными таблицы. 
   * Создайте в схеме разметки поле **Подвал таблицы**, выберите это поле, после чего выделите инструментом **Add Bounding Box (b)** область, содержащую нижнюю часть таблицы с результирующими данными.

   Если шапка, тело или подвал таблицы может содержать разное количество строк, позаботьтесь о том, чтобы в вашем датасете было как можно больше изображений с примерами для каждого случая. Это позволит модели лучше обучиться и в дальнейшем понимать, что в документах одного типа могут быть разные варианты таблиц.

1. В блоке **Датасет** выберите тип датасета **Обучение** и нажмите кнопку **Сохранить разметку**.

   ![](<../../../../.gitbook/assets1/primo-ai/classifier-9-2.png>)

1. Размеченные области отобразятся в функциональном блоке **Регионы**.

1. Перейдите к следующему изображению вашей галереи и разметьте его аналогичным образом.
1. Сохраняйте разметку для каждого изображения.


### Шаг 4. Разделите датасеты

Оставьте примерно 10-20% изображений для тестового датасета. При сохранении разметки этих изображений указывайте датасет **Тестовый**. Изображения, добавленные в тестовый датасет, будут помечены зеленым цветом в вашей галерее.

![](<../../../../.gitbook/assets1/primo-ai/classifier-test-dataset.png>)


### Шаг 5. Проверьте качество разметки

После окончания разметки изображений проверьте еще раз соответствие областей с данными выбранным полям. Ошибка негативно повлияет на качество обучения и распознавания документов моделью.

Если вы хотите скорректировать какую-либо размеченную область, воспользуйтесь доступными действиями в функциональном блоке **Регионы**. После того, как вы скорректировали регион, повторно сохраните разметку для вашего изображения.

