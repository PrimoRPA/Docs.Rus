# Автоматическая разметка данных

Автоматическая разметка данных позволяет ускорить процесс разметки за счёт применения обученной модели. Чтобы модель смогла самостоятельно размечать изображения, её следует обучить на примере 10% изображений, которые пользователь разметил вручную. Тогда оставшиеся 90% от загруженных изображений она сможет разметить автоматически.

Порядок действий следующий:
1. На странице **Данные** добавьте все изображения, которые понадобятся для обучения модели. 
1. На странице **Разметка данных** вручную разметьте 10% от загруженных изображений и сохраните разметку в датасет **Обучение**.
1. На странице **Разметка данных** воспользуйтесь инструментом ![](<../../../../../primo-ai/resources/user/smartocr/labeling/automarkup-tool.png>), чтобы перейти к шаблонам автоматической разметки.
1. Создайте шаблон автоматической разметки.
1. Создайте процесс шаблона автоматической разметки.
1. Запустите процесс на целевой машине, чтобы модель начала обучаться.
1. Дождитесь завершения обучения, чтобы стало доступным действие **Применить разметку**.
1. Примените разметку, после чего перейдите на страницу **Разметка данных**.
1. Проверьте все изображения, для которых применилась автоматическая разметка, и скорректируйте регионы, если это необходимо.
1. Не забудьте поместить 10% от всех размеченных изображений в датасет **Тестовый**. 


## Создание шаблона

1. На странице **Разметка данных** разметьте ~ 10% изображений.
1. На панели инструментов выберите инструмент **Автоматическая разметка**, чтобы перейти на страницу **Шаблоны автоматической разметки**. Кнопка становится активной, только если имеются размеченные изображения.

   ![Инструмент **Автоматическая разметка** на странице **Разметка данных**](<../../../../../primo-ai/resources/user/smartocr/labeling/labeling-automarking-tool.png>)

1. Нажмите кнопку **Добавить шаблон обучения**.
1. В открывшейся форме укажите параметры:
   * **Название\*** — название шаблона автоматической разметки. Должно состоять только из букв и цифр, дефиса, подчеркивания и точки.
   * **Шаблон модели\*** — тип базовой модели. По умолчанию доступен универсальный тип `base-SmartOCR-01`. 
   * **Описание** —  краткое описание шаблона.
   * **Искусственно расширить датасет** — определите, следует ли расширять датасет с помощью модификации входящих в него изображений. Например, за счет поворотов на 90/180/270 градусов, изменения экспозиции случайным образом и добавления шума. Возможные значения:
     * `повороты + экспозиция + шум` — значение по умолчанию, которое повышает качество обучения модели.
     * `экспозиция + шум` — применять только изменение экспозиции и добавление шума.
     * `нет` — не применять модификацию изображений. Установка этого значения повысит скорость обучения, но может снизить его качество.
   * **Кол-во процессов для загрузки датасета** — количество процессов для загрузки данных в модель, по умолчанию `8`. Значение не должно превышать количество физических ядер CPU в целевой машине. Рекомендации:
     * *если целевая машина обладает высокопроизводительными характеристиками, вы можете увеличить это значение;*
     * *не рекомендуется устанавливать значение ниже 4-х, так как это замедлит обучение.*
   * **Кол-во картинок используемых в расчетах на одной итерации** — количество изображений, которые загружаются в модель в одной итерации ([batch size](https://docs.primo-rpa.ru/primo-rpa/primo-rpa-ai-server/glossary#batch-size)). По умолчанию `2`. Рекомендации:
     * *Увеличение количества изображений в итерации помогает ускорить обучение, но требует больше памяти. Если на целевой машине используется GPU, и вы столкнулись с ошибкой `out of memory`, то следует уменьшить значение в данном параметре.*
   * **Кол-во итераций в расчетах** — количество итераций в процессе обучения, по умолчанию `1000`. Значение определяет, сколько раз требуется отправить изображение модели. Рекомендации:
     * *Более высокое значение (3-5 тыс.) повышает точность предсказаний, но требует более производительных характеристик целевой машины и удлиняет процесс обучения. Не рекомендуется устанавливать значение выше `5000`, чтобы избежать ситуации, когда модель [переобучилась](https://docs.primo-rpa.ru/primo-rpa/primo-rpa-ai-server/glossary#pereobuchenie).*
   * **Начальный коэф обучения (меняется по правилам определенным в scheduler)** — по умолчанию `0,005`. Начальный коэффициент ([learning rate](https://docs.primo-rpa.ru/primo-rpa/primo-rpa-ai-server/glossary#learning-rate-lr)) определяет размер шага, с которым модель обновляет веса в процессе обучения. Параметр влияет на то, насколько быстро или медленно модель сходится к оптимальным весам, а также на результат обучения. Рекомендации:
     * *Если выбрать слишком маленький начальный коэффициент (например, `0,0005`), то процесс обучения значительно затянется.* 
     * *Если выбрать слишком большой начальный коэффициент (например, `0,01`), то скорость обучения повысится, но модель может "перепрыгнуть" оптимальные значения весов и, в худшем случае, не сойдется к правильному решению.* 
     * **Время обновления файла (сек)** — по умолчанию `60`. Не рекомендуется изменять это значение. 
   * **Device** — определяет, какой компонент целевой машины требуется использовать для процесса обучения. Возможные значения:
     * `CUDA` — если на целевой машине нет CUDA, то автоматически будет использоваться CPU. Архитектура CUDA позволяет использовать графический процессор (GPU) от NVIDIA для повышения производительности параллельных вычислений. CUDA представляет собой набор инструментов и библиотек для работы с графическим процессором. 
     * `CPU` — центральный процессор, выполняющий основные операции и управляющий работой компьютера.
1. Нажмите **Сохранить**.

## Создание процесса для шаблона

1. На странице **Шаблоны автоматической разметки** выберите пункт **Процессы** в строке вашего шаблона. 

   ![](<../../../../../primo-ai/resources/user/smartocr/labeling/automarking-all.png>)

1. На открывшейся странице **Процессы автоматической разметки** нажмите **Добавить процесс**.
1. Выберите название целевой машины, на которой следует запустить процесс. Машина должна быть включена и доступна.
1. Нажмите **Сохранить**.

   ![](<../../../../../primo-ai/resources/user/smartocr/labeling/automarking-processes-create.png>) 

{% hint style="info" %}
**Примечание**. На одной целевой машине можно создать только один процесс обучения. Целевая машина заранее настраивается администратором. Если в списке нет включённых и доступных целевых машин, обратитесь с данным вопросом к вашему администратору AI Server.
{% endhint %}


## Запуск процесса 

1. На странице **Процессы автоматической разметки** выберите действие **Запустить** в строке вашего процесса.

   ![](<../../../../../primo-ai/resources/user/smartocr/labeling/automarking-processes-run.png>) 

1. Дождитесь окончания обучения — процесс должен перейти в статус `Завершен`. 

   ![](<../../../../../primo-ai/resources/user/smartocr/labeling/automarking-process-statuses.png>)

после чего можно нажать кнопку **Применить разметку**. когда нажимаем, нет никаких уведомлений. Но поля наносятся на неразмеченные картинки на момент запуска процесса. Процесс довольно длительный.

еще есть - **Откатить разметку**. 


если после применения авторазметки вы захотели добавить новые изображения, то придется заново обучать модель, чтобы применить авторазметку.
