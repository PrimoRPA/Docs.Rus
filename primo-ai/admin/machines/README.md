# Управление целевыми машинами

Администратор может создать [целевую машину](https://docs.primo-rpa.ru/primo-rpa/primo-rpa-ai-server/glossary#celevaya-mashina), изменить, выключить (заблокировать), включить, удалить из системы. Чтобы выключить/включить машину, пользователь должен обладать правом «Агенты — Управление». У встроенных административных ролей все необходимые права есть по умолчанию.

Кроме того, администратор может просмотреть загруженность целевых машин — сколько процессов разного вида выполняет машина на заданном промежутке времени и сколько к ней поступает запросов. Это поможет определить, нужны ли вам дополнительные лицензии на агентов и следует ли улучшить аппаратные характеристики какой-либо машины.

![](<../../../.gitbook/assets1/primo-ai/admin/machines-main.png>)

### В каком случае машина удерживает лицензию агента

По умолчанию все целевые машины создаются со статусом `Включена` — это означает, что если если конфигурационный файл агента настроен корректно и физическая/виртуальная машина доступна, то такая машина будет удерживать лицензию агента. 

Чтобы освободить лицензию, потребуется выключить целевую машину. Перед выключением машины необходимо убедиться, что на ней не запущены процессы инференса/обучения модели OCR или не запущена модель NLP в проекте. 

Если запрос инференса будет отправлен на машину без лицензии, то запрос завершится ошибкой с соответствующим текстом.



## Управление целевыми машинами

### Создать целевую машину

Перед тем, как создавать в системе сущность целевой машины убедитесь, что системный администратор выполнил необходимую настройку реальной машины. Узнайте у него номер сетевого порта для подключения к агенту и IP-адрес машины.

**Как создать машину:**

1. Перейдите в раздел **Настройки ➝ Целевые машины**. 
1. Нажмите кнопку **Создать машину**.
1. В открывшейся форме укажите параметры:
   * **Название\*** — название целевой машины.
   * **IP\*** — IP-адрес или DNS машины. Может состоять только из латинских букв и цифр, точки, дефиса и подчеркивания.
   * **Порт** — сетевой порт для подключения к агенту. Например, 5002.
   * **Описание** — краткое описание машины при необходимости.

   ![](<../../../.gitbook/assets1/primo-ai/admin/create-agent-machine.png>)
   
1. Нажмите **Сохранить**.


Добавленной машине автоматически присвоится идентификатор. Просмотреть выданный идентификатор можно в таблице целевых машин либо при редактировании машины.

:large_orange_diamond:***Важно**. Скопируйте и передайте идентификатор целевой машины системному администратору, чтобы он добавил его в конфигурационный файл агента.*


### Список целевых машин

Добавленная машина отобразится в табличной части страницы **Настройки ➝ Целевые машины**. 

![](<../../../.gitbook/assets1/primo-ai/admin/agents-table.png>)

Таблица целевых машин содержит следующие поля:
* **Наименование** — название машины, которое было задано при создании.
* **Описание** — дополнительная информация о машине, если оно было указано. Описание можно добавить при создании машины или ее редактировании.
* **Версия агента** — версия агента на целевой машине.
* **IP** — IP-адрес физической/виртуальной целевой машины.
* **Идентификатор** — автоматический идентификатор целевой машины, который присваивается при создании.
* **Дата создания** — дата создания целевой машины.
* **Доступна** — указывает на доступность физической/виртуальной целевой машины. Возможные значения:
    * `Да` — машина включена и доступна, а под статусом отображается время последнего опроса машины. Период опроса настраивается в конфигурационном файле Api в параметре **Agents > Period**.
    * `Нет` — машина включена, но недоступна. В этом случае рекомендуется проверить настройки конфигурационного файл агента данной машины. На недоступной машине пользователь не сможет запустить процессы инференса/обучения или NLP-модель.
    * `Выключена` — машина выключена, а под статусом отображается дата и время ее отключения. 
* **Удерживает лицензию** — показывает, удерживает ли машина лицензию агента. Возможные значения:
  * `Да` — машина удерживает лицензию. Если требуется освободить лицензию, остановите в проектах запущенные на машине процессы, после чего выключите целевую машину.
  * `Нет` — машина не удерживает лицензию.
* **Действия** — отображает список возможных действий с целевой машиной: редактировать, включить/выключить, удалить.


### Включить целевую машину

По умолчанию все созданные машины включены. 

**Как включить машину, если ранее она была выключена:**

1. Перейдите в раздел **Настройки ➝ Целевые машины**.
2. В таблице машин найдите нужную запись и нажмите значок ☰ для вызова меню действий.
3. Выберите пункт **Включить**.


### Выключить целевую машину
:large_orange_diamond:***Важно**. Спустя ~ минуту после выключения машины освободится лицензия, которую занимает ее агент. На выключенной машине невозможно запускать обучение/инференс или NLP-модель — такая машина будет считаться заблокированной.*

1. Перейдите в раздел **Настройки ➝ Целевые машины**.
2. В таблице машин найдите нужную запись и нажмите значок ☰ для вызова меню действий.
3. Выберите **Выключить**.
4. Подтвердите действие.


### Изменить целевую машину

1. Перейдите в раздел **Настройки ➝ Целевые машины**.
2. В таблице машин найдите нужную запись и нажмите значок ☰ для вызова меню действий.
3. Выберите пункт **Редактировать**.
4. Измените необходимые свойства машины.
5. Нажмите **Сохранить**.

![](<../../../.gitbook/assets1/primo-ai/admin/edit-agent-machine.png>)


### Удалить целевую машину

1. Перейдите в раздел **Настройки ➝ Целевые машины**.
2. В таблице машин найдите нужную запись и нажмите значок ☰ для вызова меню действий.
3. Выберите **Удалить**.
4. Подтвердите действие.

### Загрузка целевых машин

1. Перейдите в раздел **Настройки ➝ Целевые машины**.
1. Нажмите кнопку **Загрузка целевых машин**.

   ![](<../../../.gitbook/assets1/primo-ai/admin/macnines-graph-button.png>)

1. Откроется график, отображающий загруженность целевых машин. На верхней панели расположены фильтры:
   * **Дата события** — дата и время начала и конца временного отрезка, за который вы хотите просмотреть график событий. При указании значений не забудьте нажать в календаре кнопку **ОК**.
   * **Идентификатор** — идентификатор целевой машины, загруженность которой вы хотите просмотреть. 
   * **Компонент** — компонент AI Server. Доступные значения:
     * `Умный OCR` — отобразится график загруженности машин для компонента Умный OCR. 
     * `NLP` — отобразится график загруженности машин для компонента NLP. 

#### Пример графика для Умного OCR


   ![](<../../../.gitbook/assets1/primo-ai/admin/macnines-graph.png>)

   На графике ось X — выбранная дата событий, а ось Y — количество запущенных процессов и запросов.

   На графике отображаются события:
   * **Процессов инференс** (фиолетовая кривая) — какое количество процессов инференса выполняется на машине. На одной машине в определенный промежуток времени должен выполняться либо 1 процесс инференса, либо 1 процесс обучения — это позволяет оптимально использовать ресурсы машины.
   * **Запросов инференс** (зеленая кривая) — какое количество запросов на инференс, т.е. изображений для распознавания, поступает машине от роботов. Для машины с 16-ю виртуальными ядрами максимальной нагрузкой является 7 запросов, если их больше 7-ми — значит, машина перегружена. 
   * **Процессов тест** (оранжевая кривая) — какое количество тестовых процессов инференса выполняется на машине. Под тестовым процессом подразумевается инференс тестового датасета — он запускается кнопкой **Запустить тест** в разделе с процессами инференса. Тестовый инференс позволяет проверить на тестовом датасете, насколько хорошо обучена модель. Тестовых процессов инференса может быть несколько на одной машине.
   * **Процессов обучения** (красная кривая) — какое количество процессов обучения выполняется на машине. На одной машине в определенный промежуток времени должен выполняться либо 1 процесс инференса, либо 1 процесс обучения.


#### Пример графика для NLP

(пока отсутствует)
