# Управление целевыми машинами

Под целевой машиной понимается физическая или виртуальная машина, на которой установлены агент и IDP. Целевая машина необходима, чтобы выполнять процессы обучения и инференса. 

Администратор может создать целевую машину, изменить, выключить, включить, удалить из системы. Чтобы выключить или включить машину, администратор должен обладать правом «Агенты — Управление». У встроенных административных ролей это право есть по умолчанию.

Кроме того, администратор может просмотреть загруженность целевых машин — сколько определенная машина выполняет процессов разного вида на заданном промежутке времени и сколько к ней поступает запросов на инференс. Это поможет определить, нужны ли вам дополнительные лицензии на агентов и следует ли улучшить аппаратные характеристики какой-либо машины.

![](<../../../.gitbook/assets1/primo-ai/admin/machines-main.png>)


## Управление целевыми машинами

### Создать целевую машину

Перед тем, как создавать в системе сущность целевой машины убедитесь, что системный администратор выполнил необходимую настройку реальной машины. Узнайте у него номер сетевого порта для подключения к агенту и IP-адрес машины.

1. Перейдите в раздел **Настройки ➝ Целевые машины**. 
1. Нажмите кнопку **Создать машину**.
1. В открывшейся форме укажите параметры:
   * **Название\*** — название целевой машины.
   * **IP\*** — IP-адрес или DNS машины. Может состоять только из латинских букв и цифр, точки, дефиса и подчеркивания.
   * **Порт** — сетевой порт для подключения к агенту. Например, 5002.
   * **Описание** — краткое описание машины при необходимости.
1. Нажмите **Сохранить**.

![](<../../../.gitbook/assets1/primo-ai/admin/create-agent-machine.png>)

Добавленной машине автоматически присвоится идентификатор. Просмотреть выданный идентификатор можно при редактировании машины.

:large_orange_diamond:***Важно**. Скопируйте и передайте идентификатор целевой машины системному администратору, чтобы он добавил его в конфигурационный файл агента.*


### Список целевых машин

Добавленная машина отобразится в табличной части страницы **Настройки ➝ Целевые машины**. 

Убедитесь в доступности целевой машины — если агент настроен корректно, то в столбце **Доступна** отобразится значение `Да` и время последнего опроса машины. Период опроса настраивается в конфигурационном файле агента.

![](<../../../.gitbook/assets1/primo-ai/admin/agents-table.png>)


### Изменить целевую машину

1. Перейдите в раздел **Настройки ➝ Целевые машины**.
2. В таблице машин найдите нужную запись и нажмите значок ☰ для вызова меню действий.
3. Выберите пункт **Редактировать**.
4. Измените необходимые свойства машины.
5. Нажмите **Сохранить**.

![](<../../../.gitbook/assets1/primo-ai/admin/edit-agent-machine.png>)


### Выключить целевую машину
:large_orange_diamond:***Важно**. Если машина выключена, то на ней невозможно будет запустить обучение и инференс. Такая машина будет отображена как недоступная (см. столбец «Доступна»).*

1. Перейдите в раздел **Настройки ➝ Целевые машины**.
2. В таблице машин найдите нужную запись и нажмите значок ☰ для вызова меню действий.
3. Выберите пункт **Выключить**.
4. Подтвердите действие.


### Включить целевую машину

1. Перейдите в раздел **Настройки ➝ Целевые машины**.
2. В таблице машин найдите нужную запись и нажмите значок ☰ для вызова меню действий.
3. Выберите пункт **Включить**.


### Удалить целевую машину

1. Перейдите в раздел **Настройки ➝ Целевые машины**.
2. В таблице машин найдите нужную запись и нажмите значок ☰ для вызова меню действий.
3. Выберите пункт **Удалить**.
4. Подтвердите действие.

### Загрузка целевых машин

1. Перейдите в раздел **Настройки ➝ Целевые машины**.
1. Нажмите кнопку **Загрузка целевых машин**.

   ![](<../../../.gitbook/assets1/primo-ai/admin/macnines-graph-button.png>)

1. Откроется график, отображающий загруженность целевых машин. На верхней панели расположены фильтры:
   * **Дата события** — дата и время начала и конца временного отрезка, за который вы хотите просмотреть график событий.
   * **Идентификатор** — идентификатор целевой машины, загруженность которой вы хотите просмотреть. 
   * **Запросов (от)** —
   * **Запросов (до)** —

   ![](<../../../.gitbook/assets1/primo-ai/admin/macnines-graph.png>)

   На графике ось Y — количество процессов и запросов, ось X — выбранная дата событий.

   На графике отображаются события:
   * **Процессов инференс** (фиолетовая кривая) — какое количество процессов инференса выполняется на машине. На одной машине в определенный промежуток времени должен выполняться либо 1 процесс инференса, либо 1 процесс обучения — это позволяет оптимально использовать ресурсы машины.
   * **Запросов инференс** (зеленая кривая) — какое количество запросов на инференс, т.е. изображений для распознавания, поступает машине от роботов. Для машины с 16-ю виртуальными ядрами максимальной нагрузкой является 7 запросов, если их больше 7-ми — значит, машина перегружена. Запросы, которые не могут быть обработаны сейчас, сохраняются в очереди в компоненте Инференс.Апи. Файлы запросов отправляются агентам, на агентах в папке `AgentData/HotDir/<название модели>` запросы сохраняются в виде временных файлов с раширением `*.queue`. Файлы копятся как очередь и по мере работы агента он их разгребает. 
   * **Процессов тест** (оранжевая кривая) — какое количество процессов инференса..тестовый датасет (когда нажимаешь для процесса инференса кнопку "запустить тест") - оценка тестового инференса. Прогоняется тестовый датасет, нейронка сравнивает координаты, которые нашла и координаты при разметке и дальше мы получаем процент. Мы проверяем насколько хорошо обучена модель на тестовом датасете (оценка тестового инференса - 0,8 значит, что размечено хорошо).
   * **Процессов обучения** (красная кривая) — какое количество процессов обучения выполняется на машине. На одной машине в определенный промежуток времени должен выполняться либо 1 процесс инференса, либо 1 процесс обучения.
