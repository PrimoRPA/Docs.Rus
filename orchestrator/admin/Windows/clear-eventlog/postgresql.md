# Настройка автоматической очистки событий Оркестратора для PostgreSQL 

Руководство предназначено для PostgreSQL, установленном на Windows 2016 Server.

Для настройки автоматической очистки событий выполните следующие шаги:

1. Находим на машине Application Stack Builder:

![](<../../../../.gitbook/assets/Postgre. Очистка логов. Application Stack Builder.png>)

2. Выбираем сервер установки:

![](<../../../../.gitbook/assets/Postgre. Очистка логов. Выбор сервера.png>)

3. Выбираем компонент **Категории->Add-ons, tools and utilities->pgAgent**:

![](<../../../../.gitbook/assets/Postgre. Очистка логов. Выбор компонента.png>)

4. Выбираем каталог загрузки для установки пакета, нажимаем **Следующий**. В следующем окне так же нажимаем **Следующий**: 

![](<../../../../.gitbook/assets/Postgre. Очистка логов. Выбор каталога загрузки.png>)

5. В появившемся окне Setup pgAgent нажимаем **Next**, в окне Upgrade Mode нажимаем **Next**:

![](<../../../../.gitbook/assets/Postgre. Очистка логов. Окно Setup.png>)

6. Указываем детали подключения к серверу, нажимаем **Next**:

![](<../../../../.gitbook/assets/Postgre. Очистка логов. Детали подключения к серверу.png>)

7. Указываем учетные данные службы pgAgent, нажимаем **Next**:

![](<../../../../.gitbook/assets/Postgre. Очистка логов. Учетка pgAgent.png>)

8. В конце получаем сообщение о том, что схема pgagent была создана.
9. Добавляем метод trust в файл `<Posgresql_folder>\data\pg_hba.conf` для `host   all             all             ::1/128`:

![](<../../../../.gitbook/assets/Postgre. Очистка логов. Метод trust.png>)

10. Запускаем программу pgAdmin, подключаемся к серверу Postgresql.
11.	Создаем pgAgent job:

![](<../../../../.gitbook/assets/Postgre. Очистка логов. PgAgent job.png>)

12.	Задаем название job, переходим на вкладку Steps.
13.	Создаем шаг job. Указываем название **TruncLogs**. Нажимаем **Edit**, выбираем базу **ltoolslogs**.

![](<../../../../.gitbook/assets/Postgre. Очистка логов. Шаг job.png>)

14.	Переходим на вкладку Code, указываем команду вызова процедуры:
```
CALL public.truncate_logs(30,524288000);
```
![](<../../../../.gitbook/assets/Postgre. Очистка логов. Вкладка Code.png>)

15. Переходим на вкладку Schedules, добавляем расписание. Указываем название **RunEvery30mins**. В поле Start указываем текущую дату и время.
16.	Переходим на вкладку Repeat. В поле Hours выбираем значение **\<Select All\>**. В поле Minutes выбираем **00** и **30**^

![](<../../../../.gitbook/assets/Postgre. Очистка логов. Вкладка Repeat.png>)

17. В завершение нажимаем кнопку **Save**.


 
