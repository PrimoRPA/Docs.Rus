# Трансляция RDP-сессии  

Параметры трансляции RDP-сессий находятся в секции `RDP` в конфиг-файле WebApi:

![](<../../.gitbook/assets/broadcast-rdp-session.png>)

| Параметр            | Назначение           | Примечание         | 
| ------------------- | -------------------- | ------------------ |
| **RdpBaseUrl**      | URL (конечная точка Nginx) одной службы RDP2 – для случая, когда не задан AddressFilter в конфиге службы RDP2 | Начинается с внешнего URL Оркестратора. Например, на рисунке выше это: `https://192.168.0.19:44392` |
| **RdpBaseUrls**     | Сопоставление URL (конечной точки Nginx) служб RDP2 – для случая, когда задан AddressFilter в конфигах служб RDP2. Ключом является внутренний IP сервера с RDP2, значением – внешний URL, который проксируется в Nginx во внутренний IP. Внешний URL склеивается из базового внешнего URL Оркестратора и идентификатора для проксирования | В конфиге службы RDP2 должен быть прописан IP сервера с RDP2 (параметр Host). Если он не будет прописан, то определится (возможно, неправильно) из HTTP-запроса RDP2 к Оркестратору |


Параметры `RdpBaseUrl` и `RdpBaseUrls` должны соотноситься с настройкой Nginx и параметром `Host` конфиг-файла каждого экземпляра службы RDP2. Каждый экземпляр устанавливается на отдельной машине.

* **Вариант 1 – Используется один экземпляр RDP2 для всех машин роботов.**

  На рисунке ниже приведен пример конфигурации Nginx для одного экземпляра RDP2:

  ![](<../../.gitbook/assets/config-nginx-for-1-instance-rdp2.png>)

  Если используется IIS, настройка осуществляется аналогично в `Web.config` узла Primo.UI\*. На рисунке ниже приведен пример конфигурации IIS для одного экземпляра RDP2:

  ![](<../../.gitbook/assets/config-iis-for-1-instance-rdp2.png>)

  В конфигурационном файле WebApi используется только параметр `RdpBaseUrl`, параметр `RdpBaseUrls` не используется.

  В конфигурационном файле RDP2 параметр `Host` можно не задавать.


  > \* *Это правило должно идти первым или выше правила для прокси /api/*


* **Вариант 2 – Используется несколько экземпляров RDP2**.

  Множество машин роботов поделено (без пересечения) между экземплярами за счет параметра `AddressFilter`:

  ![](<../../.gitbook/assets/config-for-some-instance-rdp2.png>)

  В конфиге WebApi используется только параметр `RdpBaseUrls`. Параметр `RdpBaseUrl` не используется. 

  В конфиге RDP2 параметр `Host` (внутренний IP сервера) рекомендуется указать, так как определение IP машины с RDP2 из HTTP-запроса может работать неправильно (зависит от настройки сети).
   ```
  "Host": "192.168.0.160", //IP машины с сервисом RDP2. Если не задан, IP резолвится из HTTP-запроса
  ```

  Для IIS настраивается аналогично в `Web.config` узла Primo.UI. 
 
  :bangbang: ***В секции `EnabledOrigins` конфигурационного файла каждого экземпляра службы RDP2 должен быть прописан внешний URL Оркестратора***:

  ![](<../../.gitbook/assets/enabledorigins-in-config-rdp2.png>)


