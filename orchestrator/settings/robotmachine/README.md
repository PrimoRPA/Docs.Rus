# Настройка машины для Робота на CentOS 8

Инструкция предназначена для системных администраторов, имеющих навыки:
1.	Обязательно – уверенный пользователь ОС Linux:    
    * Владеть основными командами для перемещения по папкам и файлам.    
    * Создавать и редактировать текстовые файлы.    
    * Копировать файлы, копировать текст из файлов, сохранять файлы.    
2.	Обязательно – опыт администрирования ОС Linux:    
    * Уметь запускать программы и скрипты.    
    * Иметь опыт работы c bash.     
    * Иметь опыт сетевого и системного администрирования ОС Linux.    

## Введение
Компоненты Оркестратора (выборочно ) и их связи и с Роботами/Машиной робота приведены на схеме ниже:
 
![](<../../../.gitbook/assets/Компоненты Оркестратора и Роботы.png>)

**Агент** – self-hosted веб-приложение. Агент выполнен как .NET Core 3.1-приложение. Агент используется для развертывания и управления Роботом на машине Робота.

**Робот** – приложение, которое посредством Оркестратора развертывается на специальным образом настроенной машине (машине Робота) и выполняет RPA-проект, который формируется заранее в Студии .
На одной машине может работать несколько Роботов. Все машины Роботов должны быть настроены одинаково (версии ОС могут отличаться) и на каждой машине Робота должен быть развернут Агент.
Машин Роботов может быть много.

**Порты**, указанные на рисунке выше, далее используются при настройке конфигурационных файлов компонентов Агента, машин Роботов и открытия портов на файерволе (в том числе аппаратном в сети организации).
Должно быть разрешено управление машиной робота по RDP. 

Для настройки машины Робота нужна (желательно) чистая  машина с CentOS 8.3 (обязательно с последними обновлениями). И на неё должна быть скопирована папка с комплектом поставки (см. ниже «Комплект поставки»). Это может быть любая папка, для определенности, пусть будет папка /srv/samba/shared/install .
 
## Файлы из комплекта поставки Оркестратора
Для настройки машины робота потребуются следующие файлы из комплекта поставки Оркестратора:

| Наименование файла | Описание                          |
| :---------------: | :----------------------------------: |
| Agent-linux.zip   | Дистрибутив Агента                  | 

Остальное ПО должно быть предустановлено в Linux.
 
## Аппаратные требования
Для машины Робота требуется рабочая станция под управлением Cent OS 8.3:

| Параметр          | Требование                           |
| :---------------: | :----------------------------------: |
| CPU	              | 4 ядер                               | 
| RAM	              | 8 Гб                                 | 
| HDD	              | 250 Гб (OS + Data)                   | 


##  Инструкции
Пошагово настройка машины Робота описана в следующих инструкциях:

1. [Установка агента Оркестратора]().
2. [Проверка настройки машины Робота]().

Подключаемся к серверу по SSH с пользователем с правами root. 
Копируем папку /srv/samba/shared/install/Agent-linux в /opt/Primo/Agent:

# cp -R  /srv/samba/shared/install/Agent-linux /opt/Primo/Agent

	Создаем службу:
	Переходим в каталог /opt/Primo/Agent

# cd /opt/Primo/Agent

	Копируем файл службы (идет с комплектом поставки) в /etc/systemd/system:

# cp Primo.Orchestrator.Agent.service /etc/systemd/system/Primo.Orchestrator.Agent.service
# systemctl daemon-reload
	
Помещаем службу в автозапуск:
	
# systemctl enable /etc/systemd/system/Primo.Orchestrator.Agent.service
	
	Даем права на запуск:

# chmod -R 777 /opt/Primo/Agent/Primo.Orchestrator.Agent
# chmod -R 777 /opt/Primo/Agent/BashScripts

В конфигурационном файле службы appsettings.WorkerLinux.json прописываем адрес Оркестратора и TenantId (если эта машина не в тенанте по умолчанию) и пользователя из тенанта :
 
Стартуем службу:

# systemctl start Primo.Orchestrator.Agent

	Проверяем состояние службы:

# systemctl status Primo.Orchestrator.Agent

	Открываем порт на файерволе:

# firewall-cmd --zone=public --add-port=5002/tcp --permanent
# firewall-cmd --reload

 
2.	Проверка настройки машины Робота

Проверяем доступность машины Оркестратора с машины Робота. На машине Робота выполняем команду:
# curl -k https://<IP-адрес-машины-Оркестратора>:5001/api/version
и убеждаемся, что вернется версия оркестратора.


