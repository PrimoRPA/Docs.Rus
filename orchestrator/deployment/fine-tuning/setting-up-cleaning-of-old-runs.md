# Настройка очистки старых запусков 

Очистка старых завершенных запусков осуществляется (если включена) как удаление запусков из оперативной БД ltools и перенос их вместе со значениями аргументов проекта на запуске в БД с логами ltoolslogs. Завершенным считается запуск, у которого зафиксировано одно из: завершение работы робота, принудительное завершение работы робота, освобождение робота по таймауту, ошибка при запуске. 

Очистка старых запусков настраивается в конфигурационном файле WebApi в секции **RpaProjectLaunch.** Описание параметров настройки приведено ниже.

## Параметры очистки старых запусков

1. **LogsThreadSleep** - время (сек.) засыпания потока сброса завершенных старых запусков в БД с логами. Рекомендуемое значение 300 (5 минут). Чем чаще будет просыпаться поток, тем более оперативно старые завершенные запуски будут переноситься в БД с логами, меньшими пачками. Но, сильно частая работа потока может создать повышенную нагрузку на сервер.
2. **MaxBatch** - максимальный размер пачки за один раз передаваемый в БД с логами. Рекомендуемое значение 500. Чем больше размер пачки, тем быстрее (в сочетании с параметром LogsThreadSleep) старые запуски будут переноситься в БД с логами. Но, сильно большие пачки могут создать повышенную нагрузку на сервер.
3. **Period** - время (мин.) после которого завершенный запуск считается старым. Рекомендуемое значение примерно 80640 (4 недели). Рекомендуется выбирать в зависимости от интенсивности запусков: чем чаще запуски, тем меньшее значение может использоваться, чтобы в оперативной БД не копилось слишком много запусков.
4. **EnableLogsTransfer** - разрешен автоматический перенос старых запусков в БД с логами. Не рекомендуется выключать, так как ведет к росту размера оперативной БД.

Пример:

```
"RpaProjectLaunch": {
    /* Время (сек) засыпания потока сброса завершенных старых запусков в БД с логами */
    "LogsThreadSleep": 300, // 5 минут
    /* Максимальный размер пачки за один раз передаваемый в БД с логами */
    "MaxBatch": 500,
    /* Время (мин) после которого завершенный запуск считается старым */
    "Period": 80640, // 4 недели
    /* Разрешен автоматический перенос в БД с логами */
    "EnableLogsTransfer": false
  },
```

## Пример расчета

Рассмотрим пример расчета значений параметров настройки очистки старых запусков:

Частота запусков – 1000 в сутки. Целевой объем запусков в оперативной БД – за последние 2 недели. 

Чтобы обеспечить постоянный объем оперативной БД частота переноса запусков в БД с логами должна равняться частоте запусков, то есть 1000 в сутки. Period = 20160 обеспечит актуальности 2 недели. Чтобы переносить ежесуточно 1000 записей о запусках, не нагружая пиками серверы и одновременно не нагружая их холостой работой, выберем MaxBatch = 100. Это значит поток переноса должен проснуться не менее 10 раз в сутки, то есть 
LogsThreadSleep = 135 * 60 = 8100. 

Рекомендуемые значения параметров в таблице 17 выбраны исходя из примерно 10-ти кратного запаса.

