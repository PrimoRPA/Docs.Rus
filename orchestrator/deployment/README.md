# Развертывание 
Раздел предназначен для системных администраторов, которые владеют навыками:

1.	**Уверенный пользователь ОС:**
    *	Владеть инструментами ОС для навигации по папкам и файлам.
    * Создавать и редактировать текстовые файлы в стандартном для ОС редакторе.
    * Копировать файлы, копировать текст из файлов, сохранять файлы. 
    * Работать с архиватором ZIP.
    * Знать, что такое BAT-файлы, и уметь их создавать .
2.	**Опыт администрирования ОС:**
    * Запускать команды ОС и программы из-под Администратора/root.
    * Работать в cmd .
    * Работать в PowerShell .
    * Иметь навыки администрирования AD, DNS .
    * Иметь навыки установки и администрирования служб.
    * Иметь навыки администрирования пользователей и удаленного доступа.
3.	**Минимальный опыт администрирования БД PostgreSQL/MS SQL Server :**
    * Устанавливать PostgreSQL/MS SQL Server на сервер и производить базовую настройку.
    * Запускать SQL-скрипты. 


## Введение

Оркестратор предназначен для развертывания в локальной сети организации. Локальная сеть может быть построена на основе AD - службы Active Directory. Интеграция Оркестратора с AD организации позволяет использовать технологию единого входа SSO (Single Sign-On). Настройка интеграции с AD описана в специальном разделе **ССЫЛКА**. 

Если организация состоит из обособленных подразделений/филиалов, Оркестратор может функционировать в мультитенантном варианте. В этом случае филиалу назначается тенант, который можно рассматривать как относительно независимый экземпляр Оркестратора. Настройка мультитенантности описана в разделе **ССЫЛКА**.

## Структура системы

Компоненты Оркестратора (выделены замкнутой пунктирной линией) и их связи между собой, с Роботами и внешними сервисами\* приведены на схеме ниже: 

> \*Распределение по машинам серверной части может отличаться в зависимости от комплекта поставки и/или принятых в организации решений по развертыванию Системы. Некоторые сервисы не показаны на рисунке.

![](<../../.gitbook/assets/1. Компоненты Орка.png>)

Оркестратор содержит следующие компоненты (подсистемы):

1.	**Серверы БД** (PostgreSQL 13\*):
    * Основная БД с настройками Оркестратора – Main DB (ltools\**).
    * БД с пользователями и правами – Identity DB (ltoolsidentity).
    * БД с лицензиями – License DB (ltoolslicense).
    * БД с логом событий – Logs DB с надстройкой TimescaleDB\*** (ltoolslogs).
2. **Серверы приложений**:
    * WebApi – REST веб-API -.NET Core 3.1-приложение (служба Windows или IIS).
    * RDP – приложение или служба для поддержки активных RDP-сессий (рисунок 2 **ССЫЛКА**).
    * MachineInfo – служба определения параметров оборудования для работы с лицензиями.
    * Front – веб-сервер для отдачи статического контента (UI администрирования в браузере, SPA) и реверс-прокси для WebApi (Nginx или IIS).
    * States – служба вычисления системных состояний.
    * Notification – служба нотификаций на email.
    * LogEventsWebhook – служба интеграции логов посредством веб-хуков\*\*\*\* .
    * RabbitMQ – брокер очередей сообщений.
3. **Agent** – .NET Core 3.1-приложение. Агент устанавливается на машине Робота как служба Windows и используется для управления Роботом и машиной Робота.
4. **Программа для шифрования паролей в конфигурационных файлах**.

> \* Также поддерживается работа с MS SQL SERVER 2016+.\
>  \** Здесь и далее – физическое название БД, используется в конфигурационных файлах.\
>  \*** В зависимости от комплекта поставки и/или принятых в организации решений по разворачиванию Системы.\
>  \**** Заказчик самостоятельно в соответствии со спецификацией разрабатывает интеграционный шлюз.

## Рекомендации по развертыванию

БД желательно разворачивать на отдельной машине\*. Logs DB также рекомендуется развернуть на отдельной от других БД машине, поскольку данная БД высоко нагружена. 

Робот – приложение, которое  выполняет RPA-проект, сформированный заранее в Студии (не входит в комплект поставки - **ЧТО ИМЕННО? СТУДИЯ? РОБОТ?**). Робот разворачивается посредством Оркестратора на специальным образом настроенной машине. На одной машине может работать несколько Роботов. 

Все машины Роботов должны быть настроены одинаково (версии ОС могут отличаться), на каждой машине должен быть установлен и настроен Aгент. Машин Роботов может быть много.

Указанные порты (см. рисунок выше) используются при настройке конфигурационных файлов компонентов Оркестратора, машин Роботов и при открытии портов на файерволе (в том числе аппаратном в сети организации).

Устанавливать Оркестратор рекомендуется на чистой машине\** с последними обновлениями. На неё должна быть скопирована папка с комплектом поставки (см. раздел 2 **ССЫЛКА**). Это может быть любая папка, например, папка **C:\Install** - полный путь зависит от ОС.

Для развертывания компонентов под OC Windows требуется PowerShell 7.1.3+. Для выполнения команд и скриптов cmd и PowerShell в ОС Windows должны запускаться с правами администратора. В OC \*nix - под root (sudo).

После того как комплект поставки скопирован на сервер, где требуется развернуть Оркестратор, выполните шаги раздела 4 **ССЫЛКА** настоящего руководства или произведите автоматизированную установку согласно разделу 9**ССЫЛКА**.

> \* В зависимости от комплекта поставки и/или принятых в организации решений по разворачиванию Системы.\
> \** Чтобы не возникло конфликтов занятых портов, файлов и т.п.

## Дополнительно

В комплект поставки включена внешняя аналитическая система Grafana, которая технически не является компонентом Оркестратора. Ее стоит рассматривать как стороннее средство для получения/визуализации аналитики по работе Оркестратора (таблица 1 №№ п/п 30 – 33, таблица 2 № п/п 28).

Оркестратор может выполнять почтовую рассылку о событиях, для этого он должен быть настроен для подключения к SMTP-серверу Организации.

Оркестратор может выполнять чтение писем для срабатывания триггеров заданий, для этого он должен быть настроен для подключения к POP3-серверам Организации.


