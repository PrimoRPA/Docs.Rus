# Компоненты системы

На схеме ниже приведены компоненты Оркестратора и их связи между собой, с Роботами, Студией и внешними сервисами\*: 

> \* *Распределение по машинам серверной части может отличаться в зависимости от комплекта поставки и/или принятых в организации решений по развертыванию Системы. Некоторые сервисы не показаны на рисунке.*

![](<../../.gitbook/assets/system-component-schema-2.png>)

Оркестратор содержит следующие компоненты (подсистемы):

1.	**Серверы БД** (PostgreSQL 13 или MS SQL SERVER 2016+):
    * Основная БД с настройками Оркестратора – Main DB (ltools - здесь и далее физическое название БД, которое используется в конфигурационных файлах).
    * БД с пользователями и правами – Identity DB (ltoolsidentity).
    * БД с лицензиями – License DB (ltoolslicense).
    * БД с логом событий – Logs DB (ltoolslogs).
    * БД NuGet-сервера – NuGet DB (ltoolsnuget).
2. **Серверы приложений**:
    * WebApi – REST веб-API.
    * NuGet-сервер.
    * RDP2 – служба для поддержки активных RDP-сессий. Также может использоваться для трансляции активных RDP-сессий в UI.
    * MachineInfo – служба определения параметров оборудования для работы с лицензиями.
    * Front – веб-сервер для отдачи статического контента (UI администрирования в браузере, SPA) и реверс-прокси для WebApi, RobotLogs, RDP2 (Nginx или IIS).
    * States – служба вычисления системных состояний.
    * Notification – служба для рассылки уведомлений на email.
    * RobotLogs – служба приема логов от роботов.
    * LogEventsWebhook – служба интеграции логов посредством веб-хуков\*\* .
    * RabbitMQ – брокер очередей сообщений.
3. **Агент Оркестратора**. Agent устанавливается на машине Робота как служба Windows и используется для управления Роботом и машиной Робота. Если одна машина Робота делится между несколькими тенантами, то для каждого тенанта устанавливается отдельный Агент на своем порту (5002, 5003, 5004, ...).
4. **Программа для шифрования паролей в конфигурационных файлах**.

В [комплект поставки](https://docs.primo-rpa.ru/primo-rpa/orchestrator/deployment/kit) также включена внешняя аналитическая система Grafana, которая технически не является компонентом Оркестратора. Ее стоит рассматривать как стороннее средство для получения/визуализации аналитики по работе Оркестратора. Инструкция по установке Grafana приведена в документе «Руководство по установке и настройке Grafana под Windows 2016 Server.docx» - входит в комплект поставки.

>  \** *Заказчик самостоятельно в соответствии со спецификацией разрабатывает интеграционный шлюз*.

## Рекомендации по развертыванию

Базы данных желательно разворачивать на отдельной машине\*. При этом Logs DB также лучше развернуть на отдельной машине от других БД, поскольку данная БД высоко нагружена. Логи желательно собирать и анализировать через Logstash в ElasticSearch (на отдельном сервере) и периодически удалять из БД.

Робот – приложение, которое разворачивается посредством Оркестратора на специальным образом настроенной машине и выполняет RPA-проект, заранее сформированный в Студии (она не входит в комплект поставки). На одной машине может работать несколько Роботов. Все машины Роботов должны быть настроены одинаково (версии ОС могут отличаться), и на каждой машине должен быть установлен и настроен Aгент. Машин Роботов может быть много.

Указанные на схеме порты (см. рисунок выше) используются при настройке конфигурационных файлов компонентов Оркестратора, машин Роботов и открытия портов на файерволе (в том числе аппаратном в сети организации).

Устанавливать Оркестратор рекомендуется на чистой машине\** с последними обновлениями. На неё должна быть скопирована папка с [комплектом поставки](https://docs.primo-rpa.ru/primo-rpa/orchestrator/deployment/kit). Это может быть любая папка, для определенности, пусть будет `C:\Install` - полный путь зависит от ОС.

Для развертывания компонентов под OC Windows требуется PowerShell 7.1.3+. Для выполнения команд и скриптов cmd и PowerShell в ОС Windows они должны запускаться с правами администратора. 

В OC \*nix - под root (sudo).

После того как комплект поставки скопирован на сервер, где будет развернут Оркестратор, выполните шаги из раздела [Установка компонентов](https://docs.primo-rpa.ru/primo-rpa/orchestrator/deployment/install-orch).

> \* *В зависимости от комплекта поставки и/или принятых в организации решений по разворачиванию Системы.*\
> \** *Чтобы не возникло конфликтов занятых портов, файлов и т.п.*

## Дополнительно

Оркестратор может выполнять почтовую рассылку о событиях, для этого он должен быть настроен для подключения к SMTP-серверу организации.

Оркестратор может выполнять чтение писем для срабатывания триггеров заданий, для этого он должен быть настроен для подключения к POP3/IMAP-серверам организации.
