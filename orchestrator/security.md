# Безопасность

Раздел содержит информацию об используемом шифровании данных и регистрируемых событиях безопасности Оркестратора.

### Шифрование паролей в элементах Студии
Студия обладает набором готовых элементов для создания роботизированного сценария. Элементы, использующие пароли, имеют специальное свойство **Защищенный пароль**. Оно позволяет вводить пароли в зашифрованном виде и, таким образом, не хранить их открытыми даже в памяти компьютера в целях безопасности использования учетных данных. Для защиты пароля используется формат значений SecureString.

### Шифрование очередей обмена данными в Оркестраторе
Очереди обмена данными – это структуры данных в БД Оркестратора, которые используются при выполнении RPA-проектов для организации обмена данными между:
*	Роботами;
*	Роботами и Студией.

При создании очереди обмена данными в UI Оркестратора существует возможность настроить шифрование элементов очереди в БД. 
Для шифрования используется AES-алгоритм.

### Шифрование в ресурсах Оркестратора
Ресурсы – именованные переменные в хранилище Оркестратора. Ресурсы могут читать/устанавливать роботы и Студия при выполнении RPA-проектов. 
Значение всех ресурсов шифруется в БД посредством AES-алгоритма.

### Шифрование паролей в конфигурационных файлах
Конфигурационные файлы поставляются с зашифрованными паролями для доступа пользователей к БД (PostgeSQL; MS SQL Server) и другим службам/компонентам Системы (ActiveDirectory, SslCert, RabbitMQ). 

Смена предустановленного пароля, например, для пользователя БД, требует обязательного шифрования нового пароля при помощи программы LTools.Orchestrator.PasswordEncryptor.exe. После чего он копируется в конфигурационные файлы.
Программа для шифрования паролей PasswordEncryptor.exe входит в комплект поставки Оркестратора.

Для шифрования могут использоваться AES- (по умолчанию) или RSA-алгоритмы. Соль для алгоритма шифрования паролей находится в одной из обфусцированных dll Оркестратора, поэтому шифрование доступно только с помощью LTools.Orchestrator.PasswordEncryptor.exe.

### Шифрование паролей в БД
В целях безопасности БД не хранит пароли, за исключением паролей для машин Роботов. Пароли для машин хранятся не в открытом, а в зашифрованном виде - при помощи AES-алгоритма. 

## События безопасности
В журнале Оркестратора регистрируются события, относящиеся к классу **Инцидент безопасности**. Их можно найти в UI Оркестратора в разделе **Журнал > Инцидент безопасности**:

![](<../.gitbook/assets/sec-tab.png>) 

К таким событиям относятся: 

1. Конфигурационный файл изменен. Код: 2. Фиксируется, если с прошлого запуска файл изменился. В Оркестраторе есть возможность просмотреть прошлое содержание конфигурационного файла.
1. Пользователь включен. Код: 106. Фиксируется, если администратор установил в настройках отметку, что пользователь активен. 
1. Пользователь отключен. Код: 104. Фиксируется, если администратор заблокировал пользователя.
1. Пользователю назначены роли. Код: 105. Фиксируется, если администратор назначил выбранные роли/роль пользователю. 
1. Пользователь авторизовался. Код: 2001. Фиксируется, когда пользователя еще как такового нет, есть только его реквизиты (credential) – т.е. будущему пользователю только отдали его сессию.
1. Пользователь не существует. Код: 2002. Фиксируется в разных ситуациях. Например, если были запрошены изменения для пользователя, найти которого по Id не удалось. 
1. Пользователь заблокирован. Код: 2003. Фиксируется, если пользователь был заблокирован системой при достижении максимального количества неправильных попыток входа. Число попыток настраивается в конфигурационном файле.
1. Ошибка авторизации. Код: 2004. Фиксируется, если пользователь ввел неправильные данные учетной записи.
1. Ошибка авторизации в AD. Код: 2005. Фиксируется, если пользователь входил с помощью учетной записи Active Directory и указал неправильные данные.
1. Группа AD не имеет привязки к роли. Код: 2006. Для пользователя AD, входящего в определенную группу AD, в UI Оркестратора должна быть назначена роль, соотнесенная с этой группой AD. Событие фиксируется, если такой привязки нет. В этом случае пользователь AD не может войти в систему. 
1. Пользователь вышел из системы. Код: 2007. Фиксируется при разлогине пользователя.  
1. Срок действия учетной записи истек. Код: 2008. Фиксируется, если срок для учетной записи был задан, и он истек.  
1. Робот занял свободную лицензию. Код: 608. Фиксируется в случае, когда робот после запуска запросил лицензию и успешно ее получил. 
1. Ошибка занятия лицензии роботом. Код: 609. Фиксируется, если робот не смог получить лицензию. Причины могут быть разными, например, отсутствие свободной лицензии.
1. Студия заняла свободную лицензию. Код: 613. Фиксируется в случае, когда при запуске Студии был запрошен оркестраторный тип лицензии.
1. Ошибка занятия лицензии Студией. Код: 614. Фиксируется, если Студия не смогла получить оркестраторную лицензию.
1. Очистка логов. Код: 20000. Фиксируется, если администратор очистил журнал событий.

В последующих версиях Оркестратора список событий может быть пополнен. 

### Состав информации о событии
Фиксируемая информация о событии зависит от типа события. В общем случае фиксируются: 
1. **eventName** - название события. Например, *Пользователь авторизовался*.
1. **event** - код события. У каждого события есть свой постоянный код. Например, у события *Пользователь авторизовался* постоянный код 2001. Он и будет отображаться в данном поле.
1. **orchTimestampUtc** - дата и время события по UTC в формате Timestamp. Когда был зафиксирован прием события по времени Оркестратора.
1. **IP** - IP-адрес машины владельца события.
1. **userId** - идентификатор пользователя. Логин пользователя, который является владельцем события. 
1. **tenantId** - идентификатор тенанта, в котором произошло событие. Тенант, используемый по умолчанию, не указывается. 
1. **Text** – в этом поле может быть любая произвольная информация от разработчика, связанная с событием. Чаще всего присутствует при ошибках. 
1. **Entity Data** – расширенная информация о событии, например, сведения об объекте изменений. Информация варьируется и зависит от типа события. Пример: событие *Пользователь авторизовался* подразумевает, что пользователя еще как такового нет, есть только реквизиты (credential). Будущему пользователю отдали его сессию - кому именно (credential), отображается в EntityData. Когда этот, уже настоящий, пользователь снова обратится в Оркестратор в сессии, например, выполнит какую-то операцию по кнопке, он будет уже зафиксирован в userId. 
1. **entityId** - изначально содержало идентификатор сущности, связанной с событием. Например, если это событие 104 (Пользователь отключен), то в поле будет содержаться id пользователя, которого отключили. В настоящее время это поле находится в переходном периоде реструктуризации. То есть, оно по-прежнему может содержать как идентификатор, так и более расширенную информацию о сущности каждого события.
Например, для события 2001 (Login / Пользователь авторизовался) оно будет содержать информацию о логине пользователя и его тенанте. А для события 101 (UserCreated / Пользователь создан) - по-прежнему только идентификатор созданного пользователя.
1. **сorrectSignature** – подпись данных события.
1. **operationKey** – код бизнес-операции. Код есть только у событий, которые связаны с роботом, поскольку именно они выполняют операции. Операция – это поток событий в рамках одного логического блока.

В зависимости от типа события значение некоторых из данных параметров может быть null.



