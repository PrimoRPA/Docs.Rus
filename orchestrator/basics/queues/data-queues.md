# Очереди обмена данными

Очереди обмена данными – это структуры данных в БД Оркестратора. С их помощью можно организовать коммуникацию Роботов и Студии при выполнении RPA-проектов.

Очереди могут:
1. Использовать принцип «Первым пришёл – первым обслужен» (FIFO).
2. Вместо FIFO использовать логику «Прочитать элемент может только один Робот».

### Работа по FIFO

Для того, чтобы соблюдался принцип FIFO, необходимо правильно сформировать RPA-сценарий. Для чтения элемента по FIFO используйте компонент [Получить из очереди](https://docs.primo-rpa.ru/primo-rpa/g_elements/el_basic/els_orch/els_queues/readfromqueue). В этом случае Робот будет получать для обработки первый элемент, вошедший в очередь.

### Работа без FIFO

Работа по этому принципу предполагает, что Робот может обратиться к любому незанятому элементу, а не только к первому. 

Пример:

1. Обратиться к элементу напрямую по его идентификатору (ID), чтобы прочитать его значение. Для этого используйте в сценарии компонент [Получить из очереди по ID](https://docs.primo-rpa.ru/primo-rpa/g_elements/el_basic/els_orch/els_queues/peekqueueid).
2. Прочитать сразу список элементов, используя настроенный фильтр. В том числе прочитать с чекаутом (занять их). Чтение с чекаутом гарантирует, что другие роботы не смогут прочитать занятые элементы. Этот механизм можно считать аналогом FIFO, только для множественного чтения, и с более оптимальным использованием блокировок в БД. Для чтения по фильтру используйте в сценарии компонент [Получить из очереди по фильтру](https://docs.primo-rpa.ru/primo-rpa/g_elements/el_basic/els_orch/els_queues/peekqueuefilter). 


## Создание очереди
Для создания очереди:
1. Перейдите в раздел Оркестратора **Роботы > Очереди обмена данными** (1, 2 на рисунке).
2. Нажмите кнопку **«Добавить очередь»** (3):

   ![](<../../../.gitbook/assets/orch-add-queue-upd.png>)

3. Укажите параметры очереди.

**Таблица 1 - Параметры очереди обмена данными**.

| Параметр                                                          | Описание                                                                                    |
| ----------------------------------------------------------------- | ------------------------------------------------------------------------------------------- |
| Время жизни элемента очереди (сек.)                               | Время, после которого элемент принудительно удаляется из очереди |
| Максимальное количество попыток поставить элемент в очередь повторно | Когда элемент очереди получает статус **Завершилось с ошибкой общего вида** или **Завершилось с бизнес-ошибкой**, он ставится в очередь по FIFO повторно. После превышения этого значения элемент в очередь повторно не ставится  |
| На какие ошибки элемент должен ставиться в очередь повторно       | **Завершилось с ошибкой общего вида** (Error) или **Завершилось с бизнес-ошибкой** (BusinessError) |
| Specific JSON Schema     | JSON-схема, которой должен соответствовать элемент очереди  |
| Output JSON Schema       | JSON-схема, которой должен соответствовать элемент очереди  |
| Analytics JSON Schema    | JSON-схема, которой должен соответствовать элемент очереди  |
| Робот может удалять только свои элементы | Робот по ключу сможет удалить только те элементы, которые он сам поместил в очередь |
| Зашифрована              | Определяет, будут ли элементы очереди храниться в БД в зашифрованном виде. Если потом при редактировании очереди снять этот флаг, новые элементы останутся незашифрованными. По умолчанию элементы не шифруются |
| Публичная                | Определяет, каким роботам будет доступна очередь: всем роботам, либо только перечисленным  |
| Физическое удаление      | Определяет, как элемент будет удален из очереди. Если логически, то они остаются в БД, а также их можно видеть в UI Оркестратора |
| Реакция на невозможность извлечения элемента по FIFO | Вернуть null или вернуть ошибку роботу. «Вернуть ошибку» рекомендуется использовать при обработке заранее подготовленной очереди, чтобы отличать от случая, когда очередь пустая – пустая очередь является признаком завершения. Если используется динамическая очередь (одновременно работают писатели и читатели), рекомендуется использовать «Вернуть null» – признак завершения внешний, например, достижение максимального количества итераций, или получение внешнего сигнала  |
| Кол-во попыток при извлечении элемента по FIFO       | Применяется, если в качестве реакции на невозможность извлечения элемента по FIFO выбрано вернуть ошибку. Под нагрузкой ведет к увеличению времени извлечения элемента очереди, может негативно влиять на клиентские таймауты на стороне робота |

## Элементы очереди
О том, как наполнить очередь элементами, см. раздел [Элементы очереди](https://docs.primo-rpa.ru/primo-rpa/orchestrator/basics/data-queues/items).


