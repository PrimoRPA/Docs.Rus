# Элементы очереди

## Создать элемент

Чтобы добавить элемент через интерфейс Оркестратора:
1. Перейдите в очередь, в которой хотите создать элемент. Для этого на странице **Роботы > Очереди обмена данными** найдите в таблице запись с очередью и кликните на количество элементов в диаграмме.

![](<../../../.gitbook/assets1/come-in-queue.png>)

2. Откроется страница выбранной очереди. Вверху страницы нажмите кнопку **Добавить элемент**.
3. Укажите параметры элемента очереди и нажмите **Сохранить**.

### Параметры элемента очереди

1. **Значение (JSON)** - значение элемента очереди. Заполняется в виде JSON. 
2. **Дата, до которой элемент считается недоступным** - дата и время, до которого откладывается обработка элемента роботом.
3. **Дата, после которой элемент считается недоступным** - дата и время, после которого элемент будет удален из очереди.
4. **Натуральный ключ** - содержательный идентификатор элемента очереди. Уникальность ключа может отсутствовать, может быть задана в пределах очереди или глобально - в пределах всех очередей. Это определяется настройками очереди, где создается элемент.
5. **Приоритет** - согласно приоритету элементы сортируются для извлечения из очереди. Сначала извлекаются элементы с не пустым минимальным значением этого свойства. Порядок сортировки следующий:
   * Если приоритет указан, то для сортировки используется сначала он, а потом дата добавления.
   * Если приоритета нет (или он совпадает у нескольких элементов), то элементы сортируются по дате добавления.
 
   Значение `0` - это высший приоритет. Чем выше значение, тем ниже приоритет элемента. Значение **не может** быть отрицательным. 

6. **Метаданные** - словарь вида Ключ-значение с произвольными строковыми данными. 

### Теги элемента

К созданному элементу впоследствии можно добавить теги - произвольные ассоциированные строки, которые помогают при поиске элемента в очереди. Для этого:
1. Выделите в таблице нужный элемент очереди (1).
2. Нажмите ставшую активной кнопку **Теги элемента** (2).
3. Вверху открывшейся страницы нажмите кнопку **Добавить тег**.

![](<../../../.gitbook/assets1/add-item-tag.png>)


## Статусы элемента 

Созданный элемент автоматически получает статус **New** (Новый). Последующая смена статусов зависит от обработки элемента роботом. 

Текущее состояние элемента можно увидеть в таблице, в колонке **Статус**:

![](<../../../.gitbook/assets1/orch-item-state.png>)

Существуют следующие статусы элемента: 
* New – элемент добавлен в очередь, но еще не извлечен.
* InProgress – элемент извлечен из очереди.
* Success – обработка элемента завершена успешно.
* Error – обработка элемента завершена с ошибкой общего вида.
* Business Error – обработка элмента завершена с бизнес-ошибкой.

![](<../../../.gitbook/assets1/items-states-diargam.png>)  

Присвоение финальных статусов (Success, Error, Business Error) возможно только из статуса InProgress - т.е. когда элемент извлечен роботом для дальнейшей работы.

В истории статусов в БД фиксируются только финальные статусы. Статусы New и InProgress являются логическими и вычисляются системой по косвенным признакам.

## Управление элементами

Элементы очереди можно изменять, удалять, клонировать и повторять. Для этого вверху страницы очереди есть соответствующие кнопки.

![](<../../../.gitbook/assets1/work-buttons-for-items.png>)

При клонировании и повторении элементы снова ставятся в очередь:
* **Клонированный элемент** - это полностью новый элемент с новым идентификатором, аналогичный оригинальному элементу. У него нулевой счетчик повторов.
* **Повторенный элемент** - это физически тот же самый элемент, который переходит в статус «Новый». У него не меняется идентификатор. При повторе элемента сбрасывается признак его прочтения, ссылка на текущий статус и счетчик повторов. 

Таким образом, клонирование создает копию элемента, а повтор - возвращает в статус New элемент, который был обработан или удален из очереди при логическом типе удаления.

По событиям работы роботов с очередью вычисляется статистика – количество элементов очереди в разных статусах и график среднего времени обработки элемента очереди роботом (разница между временем извлечения элемента и проставления ему финального статуса).   


![](<../../../.gitbook/assets1/average-item-processing-time.png>)
