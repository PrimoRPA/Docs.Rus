# Задания

Задания – это основной инструмент автоматизации запуска RPA-проектов. Оно может быть запущено вручную или автоматически - при срабатывании триггера. 

## Виды триггеров

Триггеры позволяют запускать RPA-проекты по событию, образуя реактивные цепочки исполнения и/или периодическое исполнение проектов. Имеются следующие типы триггеров:

| Триггер        | Описание   | Параметры              |
| -------------- | ------ | ------------------------------------------ |
| Запуск по расписанию    | Срабатывает по фиксированному расписанию | Расписание, заданное Cron-строкой или конструктором. Расписание должно быть предварительно задано в справочнике расписаний |
| Запуск при получении Email | Срабатывает при поступлении в заранее настроенный ящик входящей почты письма | Ящик входящей почты, отправитель письма, тема письма |
| Запуск при изменении очереди обмена данными | Срабатывает при добавлении в очередь нового элемента | Очередь обмена данными |
| Запуск при изменении папки | Бывает двух типов: для папки на машине робота или для сетевой папки. Срабатывает при изменении содержимого папки: добавлении/изменении/удалении файлов | Для папки на машине робота: машина робота и абсолютный путь к папке. Для сетевой папки: UNC-имя папки. Папки должны быть настроены заранее |
| Запуск при завершении проекта Роботом | Срабатывает при завершении проекта каким-либо роботом | RPA-проект, результат завершения (с ошибкой или без ошибки) |
| Запуск из другого Робота | Срабатывает при прямом вызове запуска триггера из робота  | RPA-проект, результат завершения (с ошибкой или без ошибки) |
| Запуск при наличии новых элементов в очереди обмена данными | Добавлено в версии 2.2.21. Срабатывает, когда при очередном опросе очереди в ней появляются новые элементы | Очередь обмена данными, периодичность опроса, количество новых элементов |

Одному заданию может быть одновременно назначено несколько триггеров.

![](<../../.gitbook/assets/Триггеры.png>)

Так, на рисунке выше **Задание 1** имеет сразу 2 триггера: запуск по расписанию и запуск при получении Email. Триггер на получение Email может использоваться, например, для внепланового удаленного запуска проекта.

Таким образом, на рисунке выше:
1. В процессе выполнения проекта **Задания 1** происходит запись в очередь обмена данными Queue1, на изменение которой подписано **Задание 2**.
2. В процессе выполнения проекта **Задания 2** происходит запись в папку C:\tmp на машине Робота, на изменение которой подписано **Задание 3**.
3. По завершению выполнения проекта **Задания 3** запустится проект **Задания 4**, так как **Задание 4** подписано на завершение проекта **Задания 3**.

## Как добавить задание

Задания создаются в разделе **Задания ➝ Все задания** при помощи кнопки **Добавить задание**:

![](<../../.gitbook/assets/0 (13)>)

В форме создания заполните все необходимые поля. Если Вы установили флаг **Запуск по триггеру**, потребуется выбрать тип триггера:

* Для работы триггера **Запуск по расписанию** нужно выбрать готовое расписание из справочника: они создаются предварительно на вкладке **Расписания**.
  > **ВАЖНО!** При создании расписания требуется задать ему имя (латиница и цифры) и выбрать настройки запуска. Особого внимания требует поле **Cron-строка**. Чтобы правильно заполнить поле **Cron-строка**, изучите поддерживаемый [формат и примеры выражений](https://www.quartz-scheduler.net/documentation/quartz-3.x/tutorial/crontrigger.html#introduction). Также можете воспользоваться [генератором cron-выражений](https://www.freeformatter.com/cron-expression-generator-quartz.html).

* Для работы триггера **Запуск при получении Email** должен быть задан минимум один почтовый ящик для тенанта (в настройках тенанта) для входящей почты. Дополнительные ящики могут быть добавлены на вкладке [Настройки ➝ Email для входящей почты](https://docs.primo-rpa.ru/primo-rpa/orchestrator/settings/register-robot/email).

* Для работы триггера **Запуск при изменении папки** на машине Робота должна быть задана [стратегия выполнения проектов](https://docs.primo-rpa.ru/primo-rpa/orchestrator/settings/projects-queue), разрешающая выполнение проекта на привязанных к нему Роботах. Соответственно, к проекту должны быть [привязаны развернутые на данной машине Роботы](https://docs.primo-rpa.ru/primo-rpa/orchestrator/basics/assign-task). 
* Задание с триггером **Запуск из другого Робота** запускается при следующем условии: выполняется задание X, в проекте которого есть элемент [**Запустить робота**](https://docs.primo-rpa.ru/primo-rpa/g_elements/osnovnye-elementy/orkestrator/els_process/el_invokerobot). В этом элементе указано название задания Y, для которого выбран тип триггера **Запуск из другого Робота**. Как только данный элемент начинает обрабатываться Роботом, происходит запуск задания Y.

В случае если одному заданию назначено сразу несколько триггеров, нужно убедиться, что триггеры не вступают в логическое противоречие для RPA-проекта задания. Также проверьте, что триггеры не вступают в логическое противоречие для разных заданий.

## Управление заданиями

Задание запускается или ставится на паузу при помощи кнопок управления **Запустить/Остановить** (раздел *Все задания*). Поставить на паузу можно только задания, выполняющиеся по триггерам.

Запуск означает, что RPA-проект задания будет поставлен в очередь на выполнение. Для разового задания это произойдет сразу при запуске. Для задания по триггеру – каждый раз при срабатывании триггера.\
В столбце **Состояние** отображается состояние задания, не Робота. Активных Роботов в этот момент может не быть, а проект задания может ожидать своего выполнения в очереди. Наблюдать за процессом запуска Робота можно также в разделе **Роботы ➝ Все роботы**.

При срабатывании триггера задания его RPA-проект ставится в очередь выполнения. И если есть подходящий для выполнения Робот – будет выполняться им. Если нет – RPA-проект находится в очереди, пока не будет обработан или удален из неё вручную. Очередь проектов отображается в разделе главного меню [**Обзор**](https://docs.primo-rpa.ru/primo-rpa/orchestrator/monitoring/dashboard).

Информация о последнем Роботе, выполняющим проект задания, отображается в столбце **История выполнения**. 

Такие общие параметры системы как *Время срабатывания задания*, *Количество роботов*, *Количество заданий* и *Количество лицензий* должны быть согласованы. Иначе возможна ситуация – при нехватке свободных роботов/лицензий – когда очередь проектов на выполнение будет только расти. Фактически – это отказ в обслуживании, очередь нужно будет принудительно чистить вручную.

### Дополнительно

Возможно настроить кэширование проекта в конфиге Оркестратора (appsettings.Prod<Win\Linux>.json из папки WebApi). Для включения кэширования установите в параметре **AllowCaching** значение true:

```
"RpaProject": {
"RemoveOrphans": false,
"AllowCaching": true
},
```
Если кэширование отключено (значение false), то Робот каждый раз перед запуском каждый будет скачивать процесс. Это является более безопасным вариантом, но занимает больше времени.
