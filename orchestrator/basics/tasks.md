# Задания

Задания – это основной инструмент автоматизации запуска RPA-проектов. Оно может быть запущено вручную или автоматически - при срабатывании триггера.\
Триггеры позволяют запускать RPA-проекты по событию, образуя реактивные цепочки исполнения и/или периодическое исполнение проектов.  

## Виды триггеров

Всего имеется 6 типов триггеров:

1.	Запуск по расписанию.
2.	Запуск при получении Email.
3.	Запуск при изменении очереди обмена данными (при добавлении нового элемента).
4.	Запуск при изменении папки (на машине Робота или в сетевой папке).
5.	Запуск при завершении проекта Роботом.
6.	Запуск из другого Робота.

Одному заданию можно назначить одновременно несколько триггеров. При этом нужно следить, чтобы триггеры не вступали в логическое противоречие для RPA-проекта задания. Также убедитесь, что триггеры не вступают в логическое противоречие для разных заданий.

![](<../../.gitbook/assets/Триггеры.png>)

На рисунке выше **Задание 1** имеет сразу 2 триггера: запуск по расписанию и запуск при получении Email. Триггер на получение Email может использоваться, например, для внепланового удаленного запуска проекта.

Таким образом, на рисунке выше:
1. В процессе выполнения проекта **Задания 1** происходит запись в очередь обмена данными Queue1, на изменение которой подписано **Задание 2**.
2. В процессе выполнения проекта **Задания 2** происходит запись в папку C:\tmp на машине Робота, на изменение которой подписано **Задание 3**.
3. По завершению выполнения проекта **Задания 3** запустится проект **Задания 4**, так как **Задание 4** подписано на завершение проекта **Задания 3**.

## Как добавить задание

Задания создаются в разделе **Задания ➝ Все задания** при помощи кнопки **Добавить задание**:

![](<../../.gitbook/assets/0 (13)>)

В форме создания заполните все необходимые поля. Если Вы установили флаг **Запуск по триггеру**, дополнительно потребуется выбрать тип триггера:

* Для задания с триггером **Запуск по расписанию** можно создать расписание в этой же форме или выбрать существующее из справочника. В справочник попадают расписания, созданные ранее на вкладке **Расписания**, а также те, что были сохранены вместе с заданиями, если для которых был выбран триггер по расписанию.
  > **ВАЖНО!** При создании расписания требуется задать ему имя (латиница и цифры) и выбрать настройки запуска. Особого внимания требует поле **Cron-строка**. Чтобы правильно заполнить поле **Cron-строка**, изучите поддерживаемый [формат и примеры выражений](https://www.quartz-scheduler.net/documentation/quartz-3.x/tutorial/crontrigger.html#introduction). Также можете воспользоваться [генератором cron-выражений](https://www.freeformatter.com/cron-expression-generator-quartz.html).

* Для работы триггера **Запуск при получении Email** должен быть задан минимум один почтовый ящик для тенанта (в настройках тенанта) для входящей почты. Дополнительные ящики могут быть добавлены на вкладке [Настройки ➝ Email для входящей почты](https://docs.primo-rpa.ru/primo-rpa/orchestrator/settings/register-robot/email).

* Для работы триггера **Запуск при изменении папки** на машине Робота должна быть задана [стратегия выполнения проектов](https://docs.primo-rpa.ru/primo-rpa/orchestrator/settings/projects-queue), разрешающая выполнение проекта на привязанных к нему Роботах. Соответственно, к проекту должны быть [привязаны развернутые на данной машине Роботы](https://docs.primo-rpa.ru/primo-rpa/orchestrator/basics/assign-task). 
* Задание с триггером **Запуск из другого Робота** запускается при следующем условии: выполняется задание X, в проекте которого есть элемент [**Запустить робота**](https://docs.primo-rpa.ru/primo-rpa/g_elements/osnovnye-elementy/orkestrator/els_process/el_invokerobot). В этом элементе указано название задания Y, для которого выбран тип триггера **Запуск из другого Робота**. Как только данный элемент начинает обрабатываться Роботом, происходит запуск задания Y.

## Управление заданиями

Задание запускается или ставится на паузу при помощи кнопок управления **Запустить/Остановить** (раздел *Все задания*). Поставить на паузу можно только задания, которые выполняются по триггерам.

Запуск задания означает, что RPA-проект задания будет поставлен в очередь на выполнение. Для разового задания это произойдет сразу при запуске. Для задания по триггеру – каждый раз при срабатывании триггера.\
В столбце **Состояние** отображается состояние задания, не Робота. Активных Роботов в этот момент может не быть, а проект задания может ожидать своего выполнения в очереди. Наблюдать за процессом запуска Робота можно также в разделе **Роботы ➝ Все роботы**.

При срабатывании триггера задания его RPA-проект ставится в очередь выполнения. И если есть подходящий для выполнения Робот – будет выполняться им. Если нет – RPA-проект находится в очереди, пока не будет обработан или удален из неё вручную. Очередь проектов отображается в разделе главного меню [**Обзор**](https://docs.primo-rpa.ru/primo-rpa/orchestrator/monitoring/dashboard).

Информация о последнем Роботе, выполняющим проект задания, отображается в столбце **История выполнения**. 

Такие общие параметры системы как *Время срабатывания задания*, *Количество роботов*, *Количество заданий* и *Количество лицензий* должны быть согласованы. Иначе возможна ситуация – при нехватке свободных роботов/лицензий – когда очередь проектов на выполнение будет только расти. Фактически – это отказ в обслуживании, очередь нужно будет принудительно чистить вручную.

### Дополнительно

Возможно настроить кэширование проекта в конфиге Оркестратора (C:\Primo\WebApi\appsettings.ProdWin.json или C:\Primo\WebApi\appsettings.ProdLinux.json). Для включения кэширования установите в параметре **AllowCaching** значение true:

```
"RpaProject": {
"RemoveOrphans": false,
"AllowCaching": true
},
```
Если кэширование отключено (значение false), то Робот каждый раз перед запуском каждый будет скачивать процесс. Это является более безопасным вариантом, но занимает больше времени.
