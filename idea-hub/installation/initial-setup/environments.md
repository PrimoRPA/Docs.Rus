# Создание и настройка контуров

Контур (или окружение) — изолированная подсеть внутри общей сети организации. При наличии у организации нескольких контуров, каждый контур должен иметь уникальное название в Idea Hub.

Названия контуров, которые вы создадите, следует прописать при настройке файла `.env` для корректной работы скрипта `get_data.sh`.

## Создание контура

Контуры создаются в веб-интерфейсе Idea Hub пользователем с административными правами. Требуется создать столько контуров, сколько существует Оркестраторов у организации. Например, если у организации существует тестовый и продуктивный контур, то требуется создать контуры с именами Prod и Test соответственно (названия даны для примера).

Для создания контура:
1. Перейдите в раздел **Административное меню > Структура > Таксономия**.
1. В списке словаря найдите строку **Контур** и нажмите **Список терминов**.

   ![Таксономия](<../../../idea-hub/resources/admin/installation/taxonomy.png>)

1. В правом верхнем углу нажмите **Добавить термин**.
1. На открывшейся странице:
   * В поле **Имя** укажите название будущего контура.
   * В поле **Описание** можете добавить краткую информацию о контуре.
   * В блоке **Отношения** вы можете указать, какой контур следует считать родительским для того, который вы создаете.
   * В поле **Вес** вы можете указать приоритет контура для вывода в таблице контуров. По умолчанию `0` — высший приоритет. Если у всех контуров указан вес 0, то они будут упорядочиваться по названию.
1. В завершение:
   * Нажмите **Сохранить и перейти к списку**, если вы хотите добавить только один контур.
   * Нажмите **Сохранить**, если вы хотите добавить контур и остаться на странице добавления, чтобы сразу создать следующий контур.
   

## Настройка контура

Для каждого контура возможно настроить подключение к источнику данных для импорта в Idea Hub. В первую очередь данная настройка требуется для синхронизации Idea Hub с Оркестратором, чтобы система могла получать актуальные данные о проектах, очередях обмена данными и т.п.

**Чтобы настроить синхронизацию с Оркестратором:**

1. На странице **Контур** выберите строку с нужным контуром и рядом с пунктом **Изменить** нажмите стрелочку для отображения выпадающего списка.
1. В выпадающем списке выберите **Edit source data settings**.
  
   ![Edit source data settings](<../../../idea-hub/resources/admin/installation/env-overview-list-menu.png>)

1. На открывшейся странице нажмите **Добавить импортер**. 
1. В открывшемся окне:
   * В поле **Тип исходных данных** выберите в качестве источника данных **Primo RPA Global**.
   * В поле **Время начала импорта исходных данных** установите время, когда Idea Hub будет автоматически забирать данные из каталога, в котором скрипт `get_data.sh` хранит собранные данные из Оркестратора.
   
     Время устанавливается по следующему принципу: `get_data.sh` по настроенному расписанию, обычно раз в сутки, собирает данные из Оркестратора и складывает их в определенный каталог. Idea Hub, согласно времени начала импорта данных, забирает данные из каталога — как правило, тоже раз в сутки. Таким образом, время работы `get_data.sh` и Idea Hub должно различаться: Idea Hub следует забирать данные из каталога хотя бы на час позже, чем их складывает туда `get_data.sh`.
1. В поле **Source type** оставьте значение `CSV`.
1. В параметре **Select which data you want to import** выберите, какие данные следует получать из Оркестратора (кому забирать - скрипту?):
   * Licenses — список существующих лицензий и их типов, который есть у организации в Оркестраторе. 
   * Machines — сведения о машинах роботов.
   * Projects — сведения об RPA-проектах, загруженных в Оркестратор.
   * Queues — сведения об очередях обмена данными.
   * Robots — сведения об оркестраторных роботах.
   * RobotStats — статистика по роботам, как например: запуски роботов, удержания лицензий роботов. Данная статистика позволяет оценить, насколько эффективно работают роботы. 
   * QueueStats — статистика по очередям обмена данными. Например: количество успешно обработанных элементов очереди, количество элементов, которые были обработаны с ошибками и бизнес-ошибками.
   * ProjectStats — статистика по работе RPA-проектов. Например: время и результат выполнения проекта и т.п.
1. В поле **Path to folder with source data** (посмотреть, есть ли переводы на норм стенде) укажите путь до каталога, в который скрипт `get_data.sh` складывает данные из Оркестратора для Idea Hub. 
1. В завершение:
   * Нажмите **Сохранить конфигурацию**, если вы хотите добавить только один импортер.
   * Нажмите **Добавить импортер**, чтобы указать дополнительный источник данных в конфигурации контура.

Кнопка **Добавить импортер** позволяет добавить дополнительный источник данных для контура. Например, вы можете собирать только часть данных из Оркестратора, а для остальных данных использовать внешнюю систему — например, какую-либо базу данных. 

**Чтобы добавить дополнительный импортер:**

1. Предварительно убедитесь, что учетные данные целевой базы данных указаны в файле `settings.local.php`.
1. После нажатия кнопки **Добавить импортер** выберите в качестве **Типа исходных данных** значение **Metadata**. 
1. Укажите время начала импорта исходных данных.
1. **А что дальше?**
1. Нажмите **Сохранить конфигурацию**.



## Что дальше
Следующий шаг - добавляем процессы, которые будут коннектиться со статистикой, которую мы собираем из Орка.

Мы говорим: принесите нам список процессов в файле Ecxel - позволяет массово импортировать в противовес ручному созданию через админ меню. Только если вручную, то сначала создается Идея - тут еще не можем подключить его к Орку, а когда перешел в статус эксплуатации, то тогда уже подключаем к Орку и статистике.

Пользователь приносит файл xlsx со всеми параметрами процессов, в том числе связи с очередями и проектами, чтобы в процессе можно было посчитать показатели, опираясь на статистику. Кроме этого, у процесса есть свойства user и департаменты.

Тут появляется разница:

Если без ЛДАП: необходимо загрузить пользователей через файл user xlsx, а департаменты через areas.xlsx. Формат их описан. Прежде чем сделать импорт процессов через файл xlsx, то необходимо подключить эти два файлы - они автоматически импортируются во время импорта данных из процесса. Если этого не произойдет, процессы тоже импортируются, но без связи с пользаками и департаментами.


Если с ЛДАП: подключаемся к ЛДАП, после чего автоматом должны подтянуться оттуда пользаки и департаменты. Для пользаков - ключи (емейлы), для департаментов - внутренние коды в ЛДАП. Эти ключи должны быть указаны в колонках (area и т.п., owners) в файле процессов. Когда процесс загружаем, должны указать связи. 
