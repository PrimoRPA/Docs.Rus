# Создание и настройка контуров

Контур (или окружение) — изолированная подсеть внутри общей сети организации. При наличии у организации нескольких контуров, каждый контур должен иметь уникальное наименование.

Названия контуров, которые вы создадите, далее следует указать при настройке файла `.env` для корректной работы скрипта `get_data.sh`.

## Создание контура

Контуры создаются в веб-интерфейсе Idea Hub пользователем с административными правами. Требуется создать столько контуров, сколько существует Оркестраторов у организации. Например, если у организации существует тестовый и продуктивный контур, то требуется создать контуры с именами Prod и Test соответственно (названия даны для примера и могут быть другими).

Для создания контура:
1. Перейдите в раздел **Административное меню > Структура > Таксономия**.
1. В списке словаря найдите строку **Контур** и нажмите **Список терминов**.

   ![Таксономия](<../../../idea-hub/resources/admin/installation/taxonomy.png>)

1. В правом верхнем углу нажмите **Добавить термин**.
1. На открывшейся странице:
   * В поле **Имя** укажите название будущего контура.
   * В поле **Описание** можете добавить краткую информацию о контуре.
1. Чтобы добавить контур:
   * Нажмите **Сохранить и перейти к списку**, если вы хотите добавить только один контур.
   * Нажмите **Сохранить**, если вы хотите добавить контур и остаться на странице добавления, чтобы сразу создать следующий контур.
   
Создаем столько контуров, сколько Оркестраторов у нас существует. Если их несколько, например, есть тестовый, например Прод и Тест.

Для каждого контура есть возможность настроить подключение к источнику данных - в данном случае это как раз get-data (в котором есть файл sh, испольняемый). Когда мы подключили get-data, он собрал данные из Орка и сложил файлы в каком-то из каталогов Орка. Нам нужно, чтобы Идеа хаб знал, где эти каталоги и что данные именно в формате, в котором их собирает get-data.

## Настройка контура

**Настройка синхронизации с Оркестратором настраивается через контуры:**

Чтобы добавить источник к контуру - напротив контура жмем **Изменить**, выбираем **Edit source data settings**, выбираем **Добавить импортер**. 

В открывшемся окне:
1. В поле **Тип исходных данных** выбираем значение **Primo RPA Global**. 
1. В поле **Время начала импорта исходных данных** устанавливаем время, когда Идеа хаб будет автоматически ходить в каталог, куда get-data сложил данные из Оркестратора. Принцип такой: get-data по своему расписанию, обычно раз в сутки, ходит и собирает данные из Орка, складывает их в каталог на диске, а Идеа Хаб ходит в каталог и забирает данные - обычно тоже раз в сутки. Время должно отличаться: Идеа хаб должен ходить в каталог чуть позже, хотя бы на час позже, чем get-data.
1. В поле **Source type** оставьте значение `CSV`.
1. В параметре **Select which data you want to import** - выбираем, какие данные мы забираем из Орка:
   * LicenseTypesOrch - откуда Идеа Хаб узнает о существующих типах лицензий.
   * Environments - контуры. (Почему этот пункт здесь есть? Ошибка? Уточнить у Кости, убрали ли его)
   * Licenses - список существующих лицензий и их параметров, который есть в Оркестраторе. Обязательно вместе с галкой LicenseTypesOrch. 
   * Machines - сведения о сущностях из Орка.
   * Projects - сведения о сущностях из Орка.
   * Queues - сведения о сущностях из Орка.
   * Robots - сведения о сущностях из Орка.
   * RobotStats - статистика по роботам, которая будет собираться из Оркестратора. Запуски роботов, удержания лицензий роботов. Позволяет оценить, насколько эффективно работают роботы. 
   * QueueStats - статистика по очередям, которая будет собираться из Оркестратора.
   * ProjectStats - статистика по проектам, которая будет собираться из Оркестратора. Время и результат выполнения проектов и т.д.
1. В поле **Path to folder with source data** - (посмотреть, есть ли переводы на норм стенде) путь, в который get-data складывает данные для Идеа Хаба. 
1. Жмем **Добавить импортер**.

Статистика может собираться не только из Орка, но и из другой системы, которую клиент настроил. В этом случае нужно добавлять несколько импортеров - но указываем все равно Primo RPA Global?


## Что дальше
Следующий шаг - добавляем процессы, которые будут коннектиться со статистикой, которую мы собираем из Орка.

Мы говорим: принесите нам список процессов в файле Ecxel - позволяет массово импортировать в противовес ручному созданию через админ меню. Только если вручную, то сначала создается Идея - тут еще не можем подключить его к Орку, а когда перешел в статус эксплуатации, то тогда уже подключаем к Орку и статистике.

Пользователь приносит файл xlsx со всеми параметрами процессов, в том числе связи с очередями и проектами, чтобы в процессе можно было посчитать показатели, опираясь на статистику. Кроме этого, у процесса есть свойства user и департаменты.

Тут появляется разница:

Если без ЛДАП: необходимо загрузить пользователей через файл user xlsx, а департаменты через areas.xlsx. Формат их описан. Прежде чем сделать импорт процессов через файл xlsx, то необходимо подключить эти два файлы - они автоматически импортируются во время импорта данных из процесса. Если этого не произойдет, процессы тоже импортируются, но без связи с пользаками и департаментами.


Если с ЛДАП: подключаемся к ЛДАП, после чего автоматом должны подтянуться оттуда пользаки и департаменты. Для пользаков - ключи (емейлы), для департаментов - внутренние коды в ЛДАП. Эти ключи должны быть указаны в колонках (area и т.п., owners) в файле процессов. Когда процесс загружаем, должны указать связи. 
