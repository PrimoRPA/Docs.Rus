# Создание и настройка контуров

Контур (окружение) — это экземпляр Оркестратора. При наличии у организации нескольких контуров, каждый контур должен иметь уникальное название в Idea Hub.

Рекомендуется называть контуры так же, как вы указывали их при настройке файла `.env`, чтобы другим специалистам было легче поддерживать работу системы.

## Создание контура

Контуры создаются в веб-интерфейсе Idea Hub пользователем с административными правами. Требуется создать столько контуров, сколько существует Оркестраторов у организации. Например, если у организации существует тестовый и продуктивный контур, то требуется создать контуры с именами Prod и Test соответственно (названия даны для примера).

**Чтобы создать контур:**
1. Перейдите в раздел **Административное меню > Структура > Таксономия**.
1. В списке словаря найдите строку **Контур** и нажмите **Список терминов**.

   ![Таксономия](<../../../idea-hub/resources/admin/installation/taxonomy.png>)

1. В правом верхнем углу нажмите **Добавить термин**.
1. Заполните поля формы:
   * **Имя**\* — название будущего контура.
   * **Описание** — краткая информация о контуре.
   * **Отношения** — здесь вы можете указать, какой контур следует считать родительским для будущего контура.
   * **Вес** — здесь вы можете указать приоритет контура для вывода в таблице контуров. По умолчанию `0` — высший приоритет. Если у всех контуров указан вес 0, то они будут упорядочиваться по названию.
1. В завершение:
   * Нажмите **Сохранить и перейти к списку**, если вы хотите добавить только один контур.
   * Нажмите **Сохранить**, если вы хотите сохранить изменения и остаться на странице, чтобы сразу создать следующий контур.
   

## Настройка контура

Для каждого контура возможно настроить подключение к источнику данных для импорта в Idea Hub. В первую очередь данная настройка требуется для синхронизации Idea Hub с Оркестратором, чтобы система могла получать актуальные данные о проектах, роботах, очередях обмена данными и т.п.

**Чтобы настроить контур:**

1. В строке нужного контура нажмите на стрелку вниз, которая находится справа от действия **Изменить**. Откроется выпадающий список.
1. В выпадающем списке выберите **Edit source data settings**.
  
   ![Edit source data settings](<../../../idea-hub/resources/admin/installation/env-overview-list-menu.png>)

1. На открывшейся странице нажмите **Добавить импортер**. 
1. Заполните поля формы:
   * **Тип исходных данных** — выберите в качестве источника данных **Primo RPA Global**.
   * **Время начала импорта исходных данных** — установите время, когда Idea Hub будет автоматически забирать данные из каталога, в котором скрипт `get_data.sh` хранит собранные данные из Оркестратора.
   
     Время устанавливается по следующему принципу: `get_data.sh` по настроенному расписанию, обычно раз в сутки, собирает данные из Оркестратора и складывает их в определенный каталог. Idea Hub, согласно времени начала импорта данных, забирает данные из каталога — как правило, тоже раз в сутки. Таким образом, время работы `get_data.sh` и Idea Hub должно различаться: Idea Hub следует забирать данные из каталога хотя бы на час позже, чем их складывает туда `get_data.sh`.
   * **Source type** — оставьте значение `CSV`.
1. В параметре **Select which data you want to import** выберите, какие данные следует получать из Оркестратора:
   * Лицензии — список существующих лицензий и их типов, который есть у вашей организации в Оркестраторе. 
   * Машины — сведения о машинах роботов.
   * Проекты — сведения об RPA-проектах, загруженных в Оркестратор.
   * Очереди — сведения об очередях обмена данными.
   * Роботы — сведения об оркестраторных роботах.
   * Статистика роботов — статистика по роботам, как например: запуски роботов, удержания лицензий роботов. Данная статистика позволяет оценить, насколько эффективно работают роботы. 
   * Статистика очередей — статистика по очередям обмена данными. Например: количество успешно обработанных элементов очереди, количество элементов, которые были обработаны с ошибками и бизнес-ошибками.
   * Статистика проектов — статистика по работе RPA-проектов. Например: время и результат выполнения проекта и т.п.
1. В поле **Path to folder with source data** укажите путь до каталога контура, в который скрипт `get_data.sh` складывает данные из Оркестратора для Idea Hub. 
1. В завершение:
   * Нажмите **Сохранить конфигурацию**, если вы хотите добавить только этот импортер.
   * Нажмите **Добавить импортер**, чтобы указать дополнительный источник данных в конфигурации контура. Например, в том случае, если какие-то данные вы хотите забирать из другой базы данных.


### Дополнительный импортер

В Idea Hub существует возможность указать для одного контура несколько источников данных (импортеров). Например, вы можете собирать только часть данных из Оркестратора, а остальные данные получать из другого источника.

С версии Idea Hub 25.3 появилась возможность использовать в качестве дополнительного импортера БД ltoolsanalytic — аналитическую подсистему Оркестратора, которая есть у версии Оркестратора 1.24.8 и выше. Аналитическая подсистема предоставляет более точную статистику запусков роботов и проектов. 

**Чтобы подключить дополнительный импортер:**
1. Предварительно убедитесь, что учетные данные целевой базы данных указаны в файле `settings.local.php`.
  
   Пример для БД Оркестратора ltoolsanalytic:
   ```
   $databases['psd_primo_analytic'][886] = [
   'driver' => 'pgsql',
   'autoload' => 'core/modules/pgsql/src/Driver/Database/pgsql/',
   'namespace' => 'Drupal\\pgsql\\Driver\\Database\\pgsql',
   'prefix' => '',
   'port' => '5432',
   'host' => '127.0.0.1',
   'database' => 'ltoolsanalytic',
   'username' => 'postgres',
   'password' => 'postgres',
   ];
   ```
1. В веб-интерфейсе Idea Hub, нажмите в строке вашего контура **Изменить** и выберите **Edit source data settings**.
1. Внизу страницы, под конфигурацией уже существующего импортера, нажмите кнопку **Добавить импортер**.
1. В параметре **Тип исходных данных** выберите из списка дополнительный импортер:
   * **Primo Analytic** — аналитическая подсистема Оркестратора для сбора статистики по запускам проектов и роботов (БД ltoolsanalytic).
   * **Metadata** — внешняя целевая БД. 
1. Укажите время начала импорта исходных данных и дополнительные параметры.

   Например, для импортера **Primo Analytic** установите галочки напротив тех данных, которые вы хотите импортировать:
   * Статистика проектов — если эта галочка установлена, то убедитесь, что для импортера **Primo RPA Global** отсутствует галочка напротив данных **Статистика проектов**.
   * Статистика роботов — если эта галочка установлена, то убедитесь, что для импортера **Primo RPA Global** отсутствует галочка напротив данных **Статистика роботов**.
1. Нажмите **Сохранить конфигурацию**.



## Что дальше
Следующий шаг — [импортировать](https://docs.primo-rpa.ru/primo-rpa/primo-rpa-idea-hub/installation/initial-setup/import) в Idea Hub файл с процессами, для которых вы настроили сбор статистики из Оркестратора. Импорт процессов выполняется с помощью загрузки файла `process.xlsx`. Он позволяет массово добавить в Idea Hub все существующие процессы вместо того, чтобы создавать каждый из них вручную.

Если вы не используете LDAP, то перед импортом процессов следует массово импортировать данные о пользователях и департаментах.

Если вы используете подключение к LDAP, то информацию о пользователях и департаментах Idea Hub получит автоматически. В этом случае следует указать в файле `process.xlsx` в соответствующих колонках электронную почту пользователей (владельцев процессов) и коды департаментов из LDAP.


