# Утилита Pass

Pass — консольный менеджер паролей.

**_Для операционной системы CentOS_**

Есть два варианта установки утилиты **pass**:
1. Машина, на которую устанавливается утилита, имеет выход в Интернет.
2. Выход в Интернет отсутствует

**ВАРИАНТ 1**
Поскольку утилита **pass** не входит в состав стандартных репозиториев ОС CentOS, для ее установки  необходимо подключение дополнительного репозитория.
**EPEL** (Extra Packages for Enterprise Linux) ―  открытое бесплатное хранилище пакетов от Fedora.

В версиях CentOS ниже 9 версии иногда требуется ввести следующие команды для обеспечения работы установщика пакетов **yum**:

_$ sudo sed -i 's/mirrorlist/#mirrorlist/g' /etc/yum.repos.d/CentOS-*_
_$ sudo sed -i 's|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g' /etc/yum.repos.d/CentOS-*_
_$ sudo dnf update -y_

- Установка дополнительного репозитория:
	$ sudo yum install epel-release

- Установка **pass**
	_$ sudo yum install pass_
Будет выдано предупреждение о том, что потребуется установка 
дополнительных пакетов. Согласитесь с ним (`y`). 
Пакет будет установлен со всеми необходимыми зависимостями.

**ВАРИАНТ 2**

На стенде разворачивается виртуальная машина с необходимой версией CentOS. В данном случае это CentOS 8.5.2111

Версию ОС можно посмотреть командой 
_$ cat /etc/os-release_

Повторяем шаги, описанные для ВАРИАНТА 1:

_$ sudo sed -i 's/mirrorlist/#mirrorlist/g' /etc/yum.repos.d/CentOS-*_
_$ sudo sed -i 's|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g' /etc/yum.repos.d/CentOS-*_
_$ sudo dnf update -y_

- Установка дополнительного репозитория:
	$ sudo yum install epel-release

Перечень пакетов, необходимых для установки утилиты **pass**:
- qrencode-libs-3.4.4-5.el8.x86_64.rpm
- qrencode-3.4.4-5.el8.x86_64.rpm
- qrencode-libs-0.13-8.el8.x86_64.rpm 
- git-core-2.27.0-1.el8.x86_64.rpm
- pass-1.7.3-7.el8.noarch.rpm 

Для скачивания этих пакетов необходима утилита **yumdownloader**, которая входит в пакет **yum-utils**.
Установите пакет:
_$ sudo yum install yum-utils_

После чего скачайте вышеперечисленные пакеты в текущий каталог:

_$ sudo yumdownloader --resolve qrencode-libs_
_$ sudo yumdownloader --resolve tree_
_$ sudo yumdownloader --resolve pass_

Отправьте скачанные пакеты адресату, загрузите их на машину Idea Hub без выхода в Интернет и установите следующими командами:
_$ sudo rpm -Uvh qrencode-libs-3.4.4-5.el8.x86_64.rpm_
_$ sudo rpm -Uvh qrencode-3.4.4-5.el8.x86_64.rpm_
_$ sudo rpm -Uvh xclip-0.13-8.el8.x86_64.rpm_
_$ sudo rpm -Uvh git-core-2.27.0-1.el8.x86_64.rpm_
_$ sudo rpm -Uvh tree-1.7.0-15.el8.x86_64.rpm_
_$ sudo rpm -Uvh pass-1.7.3-7.el8.noarch.rpm_

**НАСТРОЙКА PASS**
В данном примере рассматривается настройка утилиты от пользователя **_cron_fetch_**, который является стандартным при установке ПО Idea Hub.

**ВАЖНО!!!**
Настройку pass для конкретного пользователя нельзя производить при переходе под этого пользователя через команду su. 
**_Для корректной настройки pass обязательным условием  является
вход в систему под логином пользователя, который будет использовать утилиту_**.
В данном примере это пользователь **_cron_fetch_**.

**ВАЖНО ДВА!!!**
**Если зайти под пользователя** не представляется возможным кроме как **через утилиту SU** то вы при генерации GPG ключа **столкнётесь с ошибкой доступа**. Потому как эта утилита будет пытаться обратиться к оригинальному юзеру запустившему терминал.

Перед генерацией ключа gpg надо ввести команду `screen`

Зайдите  в систему под пользователем **_cron_fetch_**.
Создайте приватный и публичный ключи:
_$ gpg --full-generate-key_
    1. RSA & RSA
    - 4096
    - 0 (0 - бессрочно, 10n - 10 дней, 10w - 10 недель, 10m - 10 месяцев, 3y - 3 года)
    - Real name: cron_fetch
После заполнения всех необходимых полей установщик дважды запросит установку мастер-пароля для доступа к хранилищу.

Просмотреть свои ключи можно командой:
_$ gpg --list-secret-keys --keyid-format LONG_

         sec   rsa4096/53703779705153A4 2024-06-18 [SC]
               72812BA187831602F3CC881C53703779705153A4
         uid               [  абсолютно ] cron_fetch
         ssb   rsa4096/8F30EE1D486DCD1E 2024-06-18 [E]

Используя свой GPG key ID можно инициировать свое хранилище 
_$ pass init 53703779705153A4_

         Password store initialized for 53703779705153A4

Теперь можно помещать свои пароли в хранилище паролей RSA4096-encrypted.

Пример для пользователя postgres:
_$ pass insert postgres_ 
Будет дважды запрошен пароль для пользователя postgres.

Просмотреть список пользователей, для которых в хранилище сохранены пароли, можно командой:
_$ pass ls_
Для просмотра пароля в cleartext:
_$ pass show postgres_
Система запросит мастер-пароль и покажет пароль для пользователя postgres.

**НАСТРОЙКА ИНТЕГРАЦИИ PASS С IDEA HUB**

Для того, чтобы Idea Hub, обращаясь к серверу БД, использовал хранилище паролей и передавал по сети пароли в зашифрованном виде, достаточно в конфигурационном файле сервера IdeaHub
/var/www/ideahub/scripts/orc-data-fetch/.env
сделать следующие настройки (для БД LTOOLS):

USE_PASS=1
DB_PASS_LTOOLS_PROD=postgres

