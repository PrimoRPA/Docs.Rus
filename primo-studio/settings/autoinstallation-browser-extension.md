# Автоматизация установки браузерного расширения 

Раздел содержит инструкцию по автоматизации установки  браузерного расширения Primo RPA Extension.

## Общая информация

Primo RPA для взаимодействия с веб-браузерами Chrome, Firefox, Edge, Yandex использует расширение (плагин) Primo RPA Extension. Дистрибутив плагина расположен в подпапке `\Extensions\Chrome` установленной программы. 

Плагин может быть установлен:
* вручную после установки Студии/Робота согласно [инструкции](https://docs.primo-rpa.ru/primo-rpa/primo-studio/settings/plugin-install);
* автоматически - с помощью скриптов `_Install_BrowserExtensions_GPO.bat` и `_InstallWebBrowserNative.bat`. 

Студия и робот взаимодействуют с браузером и его расширением через файл `LTools.WebBrowser.Native.exe`, находящийся в папке с программами Primo Studio и Primo Robot. Расширение связывается с этим файлом через реестр Windows, соответствующий браузеру и его плагину, и файл json, в котором указан путь к `LTools.WebBrowser.Native.exe`. 

Если связь установлена корректно, то запуск браузера с непустым URL при включенном плагине автоматически запускает `LTools.WebBrowser.Native.exe`. После чего происходит обмен данными с браузером: робот управляет веб-страницей, кликает по ее html-элементам, обновляет страницу, переходит на другие URL-адреса, в общем, выполняет все действия в соответствии с RPA-проектом.

## Автоматическая установка расширения

1. Скачайте архив [InstallExtensions.zip](https://drive.google.com/file/d/1cIXwlojb_9nkF3KSDDsggSldqjjvaScM/view?usp=sharing).
2. Разархивируйте его. Скопируйте файлы `_Install_BrowserExtensions_GPO.bat` и `_InstallWebBrowserNative.bat` в папку с программой.
3. Последовательно запустите скрипты. 

Другой вариант установки - это запустить скрипты из любой доступной папки, но использовать параметр, указывающий на соответствующую папку с программой (без слеша на конце). Например:

`C:\Scripts\_InstallWebBrowserNative.bat “C:\Program Files\Primo\Primo Robot x64”`


:small_blue_diamond: **Примечание**: скрипт `_Install_BrowserExtensions_GPO.bat` необходимо запускать от имени администратора с повышенными правами. Для запуска второго файла права администратора не требуются. Если расширение у текущего пользователя уже было установлено, и в меню расширений браузера оно отображается, включено и имеет последнюю версию, то достаточно использовать только `_InstallWebBrowserNative.bat`.

Для удаления расширения из браузеров воспользуйтесь скриптом `Uninstall_BrowserExtensions.bat`, который достаточно запустить от имени администратора из любой папки.

### Описание автоматической установки
Процесс установки можно разделить на два этапа:

1 - установка расширения браузера, чтобы он был виден и включен в браузере для текущего пользователя.
2 - связывание расширения с файлом LTools.WebBrowser.Native.exe через реестр и файл json для каждого пользователя.

`_Install_BrowserExtensions_GPO.bat` запускается один раз на сервере. Одним запуском он автоматически установит групповую политику установки расширения для всех браузеров и для всех пользователей, под которыми будет работать Primo Robot на этом компьютере (терминальном сервере). Сделать это сможет пользователь, обладающий администраторскими правами на этом сервере. Повторный запуск этого скрипта потребуется только в случае обновления версии плагина в новом дистрибутиве Студии\Робота. Наличия Интернета для установки не требуется, что важно в корпоративных средах.

Принудительная установка расширения основана на групповой политике [ExtensionInstallForcelist](https://chromeenterprise.google/policies/#ExtensionInstallForcelist).

Аналогичная политика также применима для Edge и Yandex. Расширение для этих браузеров устанавливается из локального файла \Extensions\Chrome\chrome.crx.

Для Firefox используется другая политика, подробно описанная [здесь](https://github.com/mozilla/policy-templates#extensions).
Установка Firefox производится из файла `\Extensions\primo_rpa_extension-1.2-fx.xpi`.


Скрипт `_InstallWebBrowserNative.bat` запускается один раз для каждого пользователя из папки, где расположен соответствующий Primo Robot и его LTools.WebBrowser.Native.exe. Запуск не требует администраторских прав и может быть выполнен вручную даблкликом или скриптом, даже из Primo процесса - например заданием из Оркестратора, если в текущем профиле пользователя он ранее еще не запускался. Повторный запуск потребуется только если профиль пользователя был обновлен по какой-то причине или папка Студии\Робота вместе с файлом LTools.WebBrowser.Native.exe была перенесена в другое месторасположение.

Если расширение у текущего пользователя уже ранее было установлено и в меню расширений браузера оно видно, включено и имеет последнюю версию, то достаточно связать его с LTools.WebBrowser.Native.exe, то есть использовать только _InstallWebBrowserNative.bat

Скрипт `Uninstall_BrowserExtensions.bat` запуском от имени администратора из любой папки, удаляет расширение изо всех браузеров. Делается это внутри скрипта откатом изменений установки, то есть удалением групповой политики установки расширения, которая включалась скриптом _Install_BrowserExtensions_GPO.bat
При использовании скриптов следует учесть, что установится только расширение “Primo RPA Extension”, зарегистрированное в магазине приложений Хром под идентификатором id=pbdnfhljkbaiibahdfcmgnfpapchlmmp
