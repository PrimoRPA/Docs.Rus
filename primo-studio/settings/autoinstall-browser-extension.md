# Автоматизация установки расширения 

Primo RPA взаимодействует с веб-браузерами Chrome, Firefox, Edge, Yandex с помощью расширения **Primo RPA Extension**. 

Автоматизация установки расширения основана на применении групповой политики управления расширениями браузеров. В данном разделе приводится пример эмуляции использования групповых политик, примененных для сервера агента — компьютера, на котором работает программа Primo Robot. Использование данных скриптов, после согласования с системным администратором сервера, позволит упростить процедуру развертывания расширения на сервере Windows.

## Перед началом работы

Установите на компьютере программы Primo RPA Studio или Primo RPA Robot. Устанавливаемое расширение расположено в папке `\Extensions` (\ExtensionsV3) этих программ. 

Для браузеров Chrome, Edge и Yandex используется файл расширения:
* `\Extensions\Chrome\chrome.crx` — расширение на базе манифеста V2.
* `\ExtensionsV3\Chrome\chrome.crx` — расширение на базе манифеста V3.

Для браузера Firefox — файл `\Extensions\primo_rpa_extension_firefox.xpi`.

Студия и робот взаимодействуют с браузером и его расширением через файл `LTools.WebBrowser.Native.exe`. Он находится в папке с программами Primo RPA Studio и Primo RPA Robot. Расширение связывается с этим файлом через:
* реестр Windows, соответствующий браузеру и его плагину;
* и файл json, в котором указан путь к `LTools.WebBrowser.Native.exe`. 

Если связь установлена корректно, то запуск браузера с непустым URL при включенном расширении автоматически запускает `LTools.WebBrowser.Native.exe`. После чего происходит обмен данными между роботом и браузером: робот управляет веб-страницей, кликает по ее HTML-элементам, обновляет страницу, переходит на другие URL-адреса, в общем, выполняет все действия в соответствии с запущенным RPA-проектом.

### Особенности установки

Для автоматизированной установки расширения не нужен интернет, достаточно запустить инсталлятор один раз от имени администратора на сервере агента, что важно при работе в корпоративных изолированных средах. 

Если у вас есть доступ к интернету, то автообновление Google не будет обновлять расширение до версии из Магазина Chrome — будет использоваться всегда та версия, которая находится в папке Студии/Робота, откуда был запущен скрипт установки (файлы `\Extensions\Chrome\chrome.crx` или `\ExtensionsV3\Chrome\chrome.crx`). 

Если какой-либо пользователь желает использовать свою версию расширения из другой папки Студии, то ручная установка из командной строки или установка из интерфейса Студии также будет работать. Чтобы изменить версию на принудительно назначенную, см. п.1 в подразделе **Решение проблем**.


## Установка расширения

1. Скачайте архив [InstallExtensionsGPO.zip](https://disk.primo-rpa.ru/index.php/s/t9BHBjR6PP06Yax?path=%2FRelease%2FExtension) и распакуйте его. Список файлов архива:
   * `_Install_BrowserExtensionsFULL_GPO.bat` — инсталлятор расширения Primo RPA Extension на базе манифеста V2.
   * `_Install_BrowserExtensionsFULL_GPO_v3.bat` — инсталлятор расширения Primo RPA Extension на базе манифеста V3.
   * `Uninstall_BrowserExtensions.bat` — деинсталлятор, который удаляет расширение изо всех браузеров и операционной системы, а также очищает реестр Windows от лишних записей. 
1. В зависимости от выбранного манифеста, скопируйте файл инсталлятора в корневую папку с программой Студии/Робота. Например, в папку `C:\Program Files\Primo\Primo Studio`. Скопированный инсталлятор должен быть расположен рядом с файлом `Primo.Robot.exe`.
1. Запустите файл инсталлятора от имени администратора из папки Студии/Робота и дождитесь, когда скрипт выполнится.

   **Альтернативный способ запуска:**

   Запустите инсталлятор от имени администратора из любой папки, но при этом укажите аргумент пути до установки Студии/Робота, например:
   ```
   C:\Scripts\_Install_BrowserExtensionsFULL_GPO.bat “C:\Program Files\Primo\Primo Robot x64”
   ```

## Удаление расширения 
Чтобы удалить расширение изо всех браузеров, воспользуйтесь скриптом `Uninstall_BrowserExtensions.bat`, который вы извлекли ранее из архива `InstallExtensions.zip`.

Запустите файл `Uninstall_BrowserExtensions.bat` от имени администратора из любой папки.

## Решение проблем
1. Если в каком-либо профиле пользователя принудительно установленное расширение не заработает при запуске браузера (расширение в браузере есть, но файл `LTools.WebBrowser.Native.exe` не стартует) — это может быть связано с ранее произведенной ручной установкой и последующим удалением расширения из браузера. В этом случае запустите в профиле пользователя двойным кликом файл `Uninstall_BrowserExtensions.bat`, **без повышения прав до уровня администратора**, после чего перезапустите браузеры. 
2. Если при запуске `_Install_BrowserExtensionsFULL_GPO.bat` или `_Install_BrowserExtensionsFULL_GPO_v3.bat` появится сообщение `Установите программу 7-Zip для автоматического определения версии расширения` и расширение не установится в браузер — установите 7-Zip и перезапустите инсталлятор.

{% hint style="warning" %}
**Внимание.** Поскольку данные скрипты являются эмуляцией использования групповых политик браузеров Chrome\Edge\Yandex\Firefox, то их запуск должен быть согласован с системным администратором сервера, если в среде были использованы свои корпоративные политики браузеров. Каждый скрипт содержит поясняющие комментарии, чтобы их можно было легко адаптировать под свою схему работы с ранее назначенными расширениями браузеров.
{% endhint %}


