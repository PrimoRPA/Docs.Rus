# Автоматизация установки расширения 

Для взаимодействия с веб-браузерами вам потребуется расширение (плагин) Primo RPA Extension. Он подходит для браузеров Chrome, Firefox, Edge, Yandex.

Раздел содержит инструкцию по автоматизации установки браузерного расширения Primo RPA Extension версии 1.59.

## Общая информация

Дистрибутив расширения расположен в папке `\Extensions` программы Studio или Robot, которые должны быть предварительно установлены на компьютере пользователя. 

Для браузеров Chrome, Edge и Yandex используется дистрибутив `\Extensions\Chrome\chrome.crx`, для браузера Firefox - файл `\Extensions\primo_rpa_extension-1.2-fx.xpi`.

Плагин может быть установлен:
* Вручную после установки Студии/Робота. Установка осуществляется согласно этой [инструкции](https://docs.primo-rpa.ru/primo-rpa/primo-studio/settings/plugin-install).
* Автоматически - с помощью скриптов **_Install_BrowserExtensions_GPO.bat** и **_InstallWebBrowserNative.bat**. О них речь пойдет ниже.

Студия и Робот взаимодействуют с браузером и его расширением через файл **LTools.WebBrowser.Native.exe**. Он находится в папке с программами Primo Studio и Primo Robot. Расширение связывается с этим файлом через:
* реестр Windows, соответствующий браузеру и его плагину;
* и файл json (какой именно? manifest.json? почему их несколько в студии лежит? в хроме и уровнем выше), в котором указан путь к **LTools.WebBrowser.Native.exe**. 

Если связь установлена корректно, то запуск браузера с непустым URL при включенном расширении автоматически запускает **LTools.WebBrowser.Native.exe**. После чего происходит обмен данными между Роботом и браузером: Робот управляет веб-страницей, кликает по ее HTML-элементам, обновляет страницу, переходит на другие URL-адреса, в общем, выполняет все действия в соответствии с запущенным RPA-проектом.

## Автоматическая установка расширения

1. Скачайте архив [InstallExtensions.zip](https://drive.google.com/file/d/1cIXwlojb_9nkF3KSDDsggSldqjjvaScM/view?usp=sharing) и разархивируйте его:

   ![](../../.gitbook/assets/auto-install-ext-files.png)
   
2. Скопируйте файлы **_Install_BrowserExtensions_GPO.bat** и **_InstallWebBrowserNative.bat** в папку с программой Студии/Робота, чтобы они были расположены рядом с файлом Primo.Robot.exe - например, в папку `C:\Program Files\Primo\Primo Studio x64`.
3. Последовательно запустите скрипты. 

:bangbang:**Важно. Скрипт **_Install_BrowserExtensions_GPO.bat** необходимо запускать от имени администратора** с повышенными правами. Для запуска второго файла права администратора не требуются.

Если расширение у текущего пользователя уже было установлено, и в меню расширений браузера оно отображается, включено и имеет последнюю версию, то достаточно использовать только скрипт **_InstallWebBrowserNative.bat**.

### Альтернативный вариант установки

Скопируйте файлы из п.2 в любую папку, но впоследствии запускайте их с аргументом, указывающим на папку Студии/Робота (без слеша на конце). Например:
```
C:\Scripts\_InstallWebBrowserNative.bat “C:\Program Files\Primo\Primo Robot x64”
```

## Описание установки
Процесс автоматической установки можно разделить на два этапа:

* установка расширения браузера, чтобы он был виден и включен в браузере для текущего пользователя;
* связывание расширения с файлом LTools.WebBrowser.Native.exe через реестр Windows и файл json для каждого пользователя.

Файл **_Install_BrowserExtensions_GPO.bat** запускается один раз на сервере. Он автоматически устанавливает групповую политику установки расширения для всех браузеров и для всех пользователей, под которыми будет работать Primo Robot на этом компьютере (терминальном сервере). Запустить его может пользователь, обладающий правами администратора на этом сервере. Повторный запуск этого скрипта требуется только в случае обновления версии плагина в новом дистрибутиве Студии/Робота. Наличие интернета для установки не требуется, что важно для использования в корпоративных средах.

Принудительная установка расширения основана на групповой политике [ExtensionInstallForcelist](https://chromeenterprise.google/policies/#ExtensionInstallForcelist).

Аналогичная политика также применяется для Edge и Yandex. Расширение для этих браузеров устанавливается из локального файла `\Extensions\Chrome\chrome.crx`.

Для Firefox используется другая политика, которая описана [здесь](https://github.com/mozilla/policy-templates#extensions).
Установка Firefox производится из файла `\Extensions\primo_rpa_extension-1.2-fx.xpi`.

Скрипт **_InstallWebBrowserNative.bat** запускается один раз ***для каждого пользователя*** из папки, где расположен соответствующий Primo Robot и его LTools.WebBrowser.Native.exe. Запуск не требует прав администратора и может быть выполнен вручную двойным кликом или скриптом, в том числе из процесса Primo - например, заданием из Оркестратора, если в текущем профиле пользователя он еще не запускался. Повторный запуск потребуется, только если профиль пользователя был обновлен по какой-то причине или папка Студии/Робота вместе с файлом LTools.WebBrowser.Native.exe была перенесена в другое место.

Если расширение у текущего пользователя было установлено ранее, и в меню расширений браузера оно отображается, включено и имеет последнюю версию, то достаточно связать его с LTools.WebBrowser.Native.exe, то есть использовать только скрипт **_InstallWebBrowserNative.bat**.

При использовании скриптов следует учесть, что установится только расширение Primo RPA Extension, зарегистрированное в [магазине приложений Chrome](https://chrome.google.com/webstore/detail/primo-rpa-extension/pbdnfhljkbaiibahdfcmgnfpapchlmmp) под идентификатором id=`pbdnfhljkbaiibahdfcmgnfpapchlmmp`. 

## Удаление расширения

Для удаления расширения изо всех браузеров воспользуйтесь скриптом **Uninstall_BrowserExtensions.bat**, который вы извлекли ранее из архива InstallExtensions.zip. Файл достаточно запустить от имени администратора из любой папки.

Скрипт удаляет плагин изо всех браузеров посредством отката изменений установки: он удаляет групповую политику установки расширения, которая включалась скриптом _Install_BrowserExtensions_GPO.bat.
