# Шаблоны поиска

**Шаблон поиска** - это свойство ряда элементов Студии, которое позволяет идентифицировать компоненты приложений и получить к ним доступ. Такое свойство, например, есть у элемента [Клик мышью](https://docs.primo-rpa.ru/primo-rpa/g_elements/osnovnye-elementy/els_uiinteraction/el_click) - с помощью шаблона можно определить компонент приложения, по которому нужно кликнуть.

Шаблон поиска представляет собой JSON-файл, который можно сформировать вручную или автоматически. Файд содержит набор свойств для идентификации компонента. Для автоматического формирования шаблона используется кнопка **Выбрать компонент** ![](<../../../.gitbook/assets/image (794).png>) - она вызывает захват элемента управления в зависимости от категории приложения. 

На данный момент имеются следующие категории:

* **Браузер**
* **Рабочий стол**
* **SAP** 

Редактировать шаблон можно двумя способами:
* **В формате правки JSON-файла.** Для открытия файла нажмите в свойстве **Шаблон поиска** значок многоточия. Пример: ![](<../../../.gitbook/assets/Шаблон поиска. Многоточие (2).png>). 
* **Через окно редактора шаблона**. Для открытия графического окна нажмите кнопку ![](<../../../.gitbook/assets/image (516) (1) (2) (1) (1) (2) (2).png>). Вид окна зависит от типа элемента.

В ситуации, когда категория приложений неизвестна, редактор шаблона поиска будет выглядеть следующим образом:

![](<../../../.gitbook/assets/image (959).png>)

**Примечание**. В шаблонах поиска можно использовать имена переменных в формате {переменная}.

## Интерфейс редактора шаблона

![](<../../../.gitbook/assets/Шаблон. Интерфейс.png>)

Интерфейс редактора шаблона для категорий **Браузер** и **Рабочий стол** имеет ряд общих опций:

1. **Тип приложения** - иконка для выбора между вариантами среды, для которой создается шаблон.
2. **Подтип приложения** - выбор подтипа приложения либо браузера.
3. **Процесс** - название процесса (?).
4. **Заголовок** - параметр для поиска. Например, 
5. **Выбрать компонент** - позволяет автоматически выбрать элемент управления и добавить его в шаблон.
6. **Отобразить компонент** - выделяет элемент управления, который был задан в шаблоне.
7. **Инспектор UI** - служит для отображения/скрытия модуля исследования интерфейсов. См. рисунок ниже.
8.  ![](<../../../.gitbook/assets/12 (2) (3) (1) (1) (1).png>) - кнопка для ручного добавления элемента управления.
9. ![](<../../../.gitbook/assets/13 (1) (1) (2) (1) (1) (1).png>) - кнопка удаления шаблона. Удалить шаблон можно также клавишей Del.

> *Интерфейс редактора шаблона для категории **SAP** выглядит иначе и представлен ниже, в соответствующем разделе.*

При нажатии кнопки **Инспектор UI** ![](<../../../.gitbook/assets/6 (2).png>) отображается модуль исследования интерфейсов, например:

![](../../../.gitbook/assets/17.png)

В этом модуле можно исследовать структуру приложения. При помощи кнопок ![](<../../../.gitbook/assets/18 (1) (2) (1) (1) (2) (2).png>) и ![](<../../../.gitbook/assets/19 (1) (2) (1) (1) (2).png>) происходит перенос выбранных элементов в шаблон.


## Браузер ![](<../../../.gitbook/assets/Категория. Браузер.png>)

Шаблон поиска для категории приложений **Браузер** выглядит следующим образом:

![](<../../../.gitbook/assets/image (562).png>)

Для добавления элемента управления вручную:
1. Нажмите кнопку ![](<../../../.gitbook/assets/12 (2) (3) (1) (1) (1).png>), после чего выделите новую строку и введите данные в поля **Тэг, Текст, Индекс** (начинается с единицы) и **Искать во фреймах** (поиск внутри элементов iframe). 
2. Для уточнения поиска можно ввести имена и значения атрибутов тэга в таблицу (ключ, значение). Если указать несколько строк, поиск элемента в браузере будет вестись вглубь от самого верхнего шаблона.

Для автоматического добавления элемента нажмите кнопку **Выбрать компонент** ![](<../../../.gitbook/assets/14 (1) (2) (1) (1) (2) (2).png>) и в нужном окне браузера кликните искомый элемент. Также можно использовать кнопку быстрого добавления на самом элементе.

## Рабочий стол ![](<../../../.gitbook/assets/Категория. Десктоп.png>)

Шаблон поиска элементов **Рабочий стол** выглядит следующим образом:

![](<../../../.gitbook/assets/image (942).png>)

Перед добавлением элемента убедитесь, что выбран правильный подтип приложения в данном поле:

![](<../../../.gitbook/assets/Шаблон. Подтип приложения.png>)

Существуют следующие подтипы:

* **UIAUTOMATION** - подходит для приложений Рабочего стола, которые работают по правилам Win32. В данном режиме хорошо работает параметр **Быстрый поиск**.
* **UIAUTOMATION_UIA** - рекомендуется использовать в случае, если в режиме UIAUTOMATION не удается получить доступ к нужному элементу управления. Фактически более старая технология.
* **MSAA** - библиотека Microsoft Active Accessibility. Так же, как и UIAUTOMATION, предоставляет информацию об элементах пользовательского интерфейса в приложениях Windows, но имеет больше ограничений, т.к. это устаревшая технология. Обращение к MSAA будет полезным в ограниченном количество случаев: например, когда при поиске текстовых элементов необходимо использовать свойство идентификации **Role**. 
* **JAVA** и **JAVA_EXT** - режимы предназначены для Java-приложений.
* **RDP** - используется для работы с теми приложениями, где нельзя получить доступ к элементам управления другим способом. В данном режиме логин нужно устанавливать на клиент и на RDP-сервер. После чего они могут взаимодействовать друг с другом по ASP. 

**ВНИМАНИЕ!!! При работе с Java, разрядность Студии и Робота должны совпадать с разрядностью Java.**

Для добавления элемента шаблона вручную:
1. Нажмите кнопку ![](<../../../.gitbook/assets/12 (2) (3) (1) (1) (2) (2).png>), далее выделите новую строку и введите данные в поля **Name, AutomationID, ClassName, ControlType, LocalizedControlType** и **Индекс** (начинается с единицы). 
2. Для уточнения поиска можно ввести имена и значения атрибутов искомого компонента в таблицу (ключ, значение). Если указать несколько строк, поиск элемента в роботизируемом приложении будет вестись вглубь от самого верхнего шаблона. Для укороченного маршрута используется параметр **Быстрый поиск** (включен по умолчанию).

Для автоматического добавления элемента используйте опцию **Выбрать компонент** ![](<../../../.gitbook/assets/14 (1) (2) (1) (1) (2).png>) и кликните искомый элемент в окне нужного приложения.

В случае, если необходим обход всего дерева контроллов, воспользуйтесь кнопкой **Автопоиск** с установленным чекбоксом **Все дерево**:

![](<../../../.gitbook/assets/image (453).png>)

## SAP ![](<../../../.gitbook/assets/Категория. SAP.png>)

При работе с SAP рекомендуется использовать специализированные компоненты.

Шаблон поиска для категории **SAP** выглядит следующим образом:

![](<../../../.gitbook/assets/image (551).png>)

Если происходит работа с WebView SAP, шаблон поиска будет иметь следующий вид:

![](<../../../.gitbook/assets/image (465).png>)

Область Browser представляет собой шаблон поиска для браузера.

В шаблонах поиска SAP допускается использование символа \*.

## Контейнеры

По-прежнему рекомендуется использовать элементы совместно с контейнерами. Для этого в редакторе шаблона поиска нужно выбрать **Контейнер**:

![](<../../../.gitbook/assets/image (509) (1) (2) (1) (1) (2).png>)
