# Шаблоны поиска

**Шаблон поиска** - это свойство ряда элементов Студии, которое используется для взаимодействия с пользовательским интерфейсом программ. Оно позволяет идентифицировать компонент приложения и получить к нему программный доступ. Свойство **Шаблон поиска** есть, например, у элемента [Клик мышью](https://docs.primo-rpa.ru/primo-rpa/g_elements/osnovnye-elementy/els_uiinteraction/el_click) - с его помощью можно определить кнопку приложения, по которой нужно кликнуть. 

Шаблон поиска представляет собой JSON-файл, который содержит заданный набор свойств для идентификации компонента и другие вспомогательные параметры. Его можно сформировать вручную или автоматически. Для автоматического формирования шаблона используется кнопка **Выбрать компонент** ![](<../../../.gitbook/assets/image (794).png>) - она вызывает захват элемента управления в зависимости от категории приложения. 

Primo RPA поддерживает поиск в следующих категориях приложений:

* **Браузер**
* **Рабочий стол**
* **SAP** 

Редактировать шаблон можно двумя способами:
* **В формате правки JSON-файла.** Для открытия файла нажмите в свойстве **Шаблон поиска** значок многоточия. Пример: ![](<../../../.gitbook/assets/Шаблон поиска. Многоточие (2).png>). 
* **Через окно редактора шаблона**. Для открытия графического окна нажмите кнопку ![](<../../../.gitbook/assets/image (516) (1) (2) (1) (1) (2) (2).png>). Вид окна редактора зависит от типа элемента. С примером интерфейса редактора можно ознакомиться на рисунках ниже.

## Процесс поиска

Рассмотрим, как происходит поиск компонента на примере работы с приложением **Калькулятор** (категория **Рабочий стол**).

Как Primo RPA идентифицирует компонент приложения? Для этой цели используются селекторы - свойства компонента приложения. Они идентифицируют компонент (кнопки, текстовые поля, таблицы), предоставляют информацию о его специфике и назначении, а также разбивают все компоненты рабочего стола по тегам и классам.

Откроем приложение **Калькулятор** в Windows. Далее создадим в Студии новый проект и выполним следующие действия:
1. Добавим в проект контейнер **Присоединиться к приложению**. Укажем в свойстве **Заголовок** название приложения - Калькулятор.
2. Поместим в контейнер элемент **Клик мышью**. 
3. На панели элемента **Клик мышью** нажмем кнопку **Выбрать компонент** ![](<../../../.gitbook/assets/image (794).png>) - для его автоматического добавления в шаблон. 

![](<../../../.gitbook/assets/Шаблон поиска. Калькулятор.png>)
 
**Внимание! Окно с приложением **Калькулятор** должно быть развернуто (можно добавить в конейнер дополнительный элемент **Открыть окно** или вроде того).**

После нажатия кнопки ![](<../../../.gitbook/assets/image (794).png>) мы переместимся в окно с **Калькулятором**, где потребуется выбрать нужный компонент. При наведении указателя на тот или иной элемент приложения, он будет подсвечиваться, а в левом верхнем углу появится его увеличенное изображение. 

![](<../../../.gitbook/assets/Шаблон поиска. Выбор кнопки в Калькуляторе.png>)

Выберем **кнопку 5** - появится окно с выбором свойств для идентификации компонента приложения (селекторы).

![](<../../../.gitbook/assets/Селекторы калькулятора.png>)

> AutomationID - одно из важных свойств для приложений рабочего стола. Оно не изменяется при каждом запуске и однозначно идентифицирует компонент вне зависимости от экземпляра процесса, в котором он задействован. Если параметр отсутствует, то можно выбрать свойство Text или Name. Чаще всего их значения в рамках одного компонента совпадают.\
> Есть ряд свойств, за которые зацепиться нельзя. Например, BoundingRectangle - параметр, который содержит координаты объекта. Если его использовать, то можно получить некорректный результат, потому что координаты кнопки могут меняться при перезапуске приложения.

Выбираем параметр **AutomationID** и нажимаем **ОК** - селектор создан. Он сохранится в JSON-файл шаблона поиска. Шаблон просмотреть через встроенный редактор или многоточие. 

Робот берет заданные свойства, например, AutomationID, и пробегает по дереву компонентов, подбирая позицию, которая имеет нужное значение в параметре AutomationID.  

Опция **Полное дерево контроллов** - это многоуровневый селектор, который имеет ряд трудностей при использовании. Он работает намного медленнее, чем точечный выбор параметров. 


## Интерфейс редактора шаблона

![](<../../../.gitbook/assets/Шаблон поиска. Интерфейс.png>)

Интерфейс редактора шаблона для категорий **Браузер** и **Рабочий стол** имеет ряд общих опций:

> *Интерфейс редактора шаблона для категории **SAP** выглядит иначе и представлен ниже, в соответствующем разделе.*

1. **Тип приложения** - иконка выбора между вариантами среды, для которой создается шаблон.
2. **Подтип приложения** - выбор подтипа приложения/браузера.
3. **Заголовок** - параметр для поиска. Например, в него можно ввести название приложения.
4. **Выбрать компонент** - позволяет автоматически выбрать элемент управления и добавить его в шаблон.
5. **Отобразить компонент** - выделяет элемент управления, который был задан в шаблоне.
6. **Инспектор UI** - инструмент для исследования интерфейсов приложений. Показывает детальную информацию о нужном приложении и обо всех его компонентах (см. рисунок ниже). Позволяет перенести выбранный элемент в шаблон.
7.  ![](<../../../.gitbook/assets/12 (2) (3) (1) (1) (1).png>) - кнопка для ручного добавления элемента управления в шаблон.
8. ![](<../../../.gitbook/assets/13 (1) (1) (2) (1) (1) (1).png>) - кнопка удаления шаблона. Удалить его можно также клавишей Del.

В ситуации, когда категория приложений неизвестна, редактор шаблона поиска будет выглядеть следующим образом:

![](<../../../.gitbook/assets/image (959).png>)

## Инспектор UI

Кнопка **Инспектор UI** ![](<../../../.gitbook/assets/6 (2).png>) отображает модуль исследования интерфейса. Пример:

![](../../../.gitbook/assets/17.png)

При помощи кнопок ![](<../../../.gitbook/assets/18 (1) (2) (1) (1) (2) (2).png>) и ![](<../../../.gitbook/assets/19 (1) (2) (1) (1) (2).png>) происходит перенос выбранных элементов в шаблон.

Он поддерживает переключение режимов Win32/Java/MSAA. Работа с Java возможна после установки Java Access Bridge, но даже с ним можно исследовать не все приложения этого типа. В этом модуле можно исследовать структуру приложения.

## Категории приложений

Процесс работы с поддерживаемыми приложениями описан в разделе **Категории приложений** (ДОБАВИТЬ ССЫЛКУ). 
