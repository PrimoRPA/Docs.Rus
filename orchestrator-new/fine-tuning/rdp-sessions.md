## Внешняя поддержка RDP-сессии

В случае когда для работы робота требуется внешняя поддержка RDP-сессии, Оркестратор перед запуском робота запрашивает открытие сессии в сервисе RDP. Процесс открытия RDP-сессии занимает некоторое время. 

Параметры открытия RDP-сессии настраиваются в конфигурационном файле WebApi в секции **RobotStart.AttemptsKeepRDPSessionLevels**:

![](../../../orchestrator-new/resources/fine-tuning/rdp-session.PNG)

В таблице приводится описание параметров открытия RDP-сессии.

| Параметр           | Назначение           | Примечание           | 
| ------------------ | -------------------- | -------------------- |
| AttemptsKeepRDPSessionLevels | Массив пар параметров AttempCount и AttempExpirationInSeconds – уровней стратегии открытия RDP-сессии. Каждый последующий уровень должен иметь большее значение AttempExpirationInSeconds, чем предыдущий | Попытки открыть начинаются с уровня 0 (первый элемент массива). При исчерпании количества попыток происходит переход на следующий уровень, пока уровни не закончатся. Не рекомендуется использовать больше 3-х уровней |
| AttempCount | Количество попыток открытия RDP-сессии в рамках уровня |      |
| AttempExpirationInSeconds | Время задержки (сек) между попытками | Не гарантировано - при наличии многих RDP-пользователей время задержки может отличаться от указанного в настройке |
| WaitUserProfileLoaded | Ожидать загрузки профиля пользователя | Когда RDP-сессия открывается Оркестратором: пока не закончатся попытки AttempCount или пока не загрузится профиль RDP-пользователя. Загрузился ли профиль, проверяется путем опроса машины робота |

:small_orange_diamond: Рекомендуется располагать службу RDP2 на отдельной машине. На машине робота её можно развертывать, если она обслуживает ТОЛЬКО пользовательские сессии на этой машине (автосессии).

### Рекомендации по ресурсному обеспечению службы RDP2

Служба RDP2 потребляет три вида ресурсов:
- RAM - зависит от количества поддерживаемых сеансов и разрешения виртуального экрана
- CPU - зависит от разрешения виртуального экрана, глубины цвета виртуального экрана и графической активности робота
- сетевой трафик - зависит от количества поддерживаемых сеансов, разрешения виртуального экрана, глубины цвета виртуального экрана и графической активности робота.

Потребление ресурсов зависит от того, что делает робот. При возрастании нагрузки на службу (увеличение количества RDP сессий, изменение активности робота) потребление ресурсов службой увеличивается.

> Рекомендуется иметь не более 20 RDP сессий на один экземпляр службы RDP2.

Пример работы службы RDP2 на 10 роботах:
- В простое служба RDP2 потребляет 60 Мб оперативной памяти (поддержание RDP сессий отключено)
- При включении поддержания 10 RDP сессий служба начинает потреблять около 650 Мб 
- При запуске простого тестового проекта (калькулятор) на 10 роботах потребление оперативной памяти службой незначительно увеличивается, в данном примере до 710 Мб.
- Дополнительно при открытии видео в браузере Google Chrome на этих 10 роботах потребление оперативной памяти возрастает до 766 Мб.

> Также потребление ресурсов увеличивается при организации трансляции и управления экраном через нее (добавлено в версии 1.25.1 Оркестратора).

