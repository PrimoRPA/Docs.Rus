# Схема взаимодействия Оркестратора и робота

Свои запросы Оркестратор напрямую отправляет только своим Агентам на машинах робота.

Сетевое взаимодействие Оркестратора с роботами:

![](../../../orchestrator-new/resources/deploy/orch-robot-interaction1.PNG)

От своих Агентов и запущенных роботов Оркестратор получает:
1.	От Агентов – обратную связь и запросы на скачивание проектов/дистрибутивов.
2.	От запущенных роботов:
    * Запросы на получение лицензии.
    * Телеметрию.
    * Логи.
    * Запросы для работы с очередями и ресурсами, мягкий останов.

## Запуск Windows-робота

Работа по запуску и контролю работы Windows-робота выполняется опосредованно: 
1.	Оркестратор получает сигнал «Запустить Робота» (ручной запуск или по заданию).
2.	Оркестратор открывает RDP-сессию под учетной записью робота, дожидается загрузки профиля пользователя.
3.	Оркестратор делегирует запуск робота своему Агенту. Агент отправляет в Оркестратор трекинг своей работы по запуску робота (обратная связь).
4.	Агент скачивает из Оркестратора архив RPA-проекта.
5.	Агент готовит файл Run.bat, через который робот запускается с параметрами.
6.	Агент последним шагом в потоке работы по запуску робота создает/меняет Windows Task с учетной записью робота (только для Windows, для Linux непосредственный запуск).
7.	Windows Task запускается по триггеру средствами ОС.
8.	Windows Task непосредственно запускает робота через Run.bat.
9.	Запущенный робот запрашивает в Оркестраторе лицензию.
10.	Запущенный робот в процессе своей работы отправляет в Оркестратор телеметрию и логи, а также разные запросы по работе с очередями и ресурсами, мягкий останов.

Работа по запуску и контролю работы Windows-робота:

![](../../../orchestrator-new/resources/deploy/orch-robot-interaction2.PNG)

## Запуск Linux-робота

Работа по запуску и контролю работы Linux-робота выполняется немного иначе, чем для Windows-робота (без участия RDP2), но по похожей схеме: 
1.	Оркестратор получает сигнал «Запустить Робота» (ручной запуск или по заданию).
2.	Оркестратор делегирует запуск робота своему Агенту. Агент отправляет в Оркестратор трекинг своей работы по запуску робота (обратная связь).
3.	Агент скачивает из Оркестратора архив RPA-проекта.
4.	Агент готовит файл robotTask.sh, через который робот запускается с параметрами.
5.	Агент открывает виртуальную графическую сессию
6.	Агент непосредственно запускает робота через robotTask.sh.
7.	Запущенный робот запрашивает в Оркестраторе лицензию.
8.	Запущенный робот в процессе своей работы отправляет в Оркестратор телеметрию и логи, а также разные запросы по работе с очередями и ресурсами, мягкий останов.

Работа по запуску и контролю работы Linux-робота:

![](../../../orchestrator-new/resources/deploy/orch-robot-interaction3.PNG)

## Развертывание Windows- и Linux-роботов

Работа развертыванию Робота (одинаково для Windows/Linux) выполняется опосредованно: 
1.	Оркестратор получает сигнал «Развернуть робота».
2.	Оркестратор делегирует развертывание робота своему Агенту. Агент отправляет в Оркестратор трекинг своей работы по развертыванию робота (обратная связь).
3.	Агент скачивает из Оркестратора дистрибутив робота.
4.	Агент распаковывает дистрибутив робота в папку робота.
5.	Агент готовит вносит изменения в конфигурационный файл робота Primo.Robot.exe.config.
6.	Агент осуществляет (через вызовы WinApi + cmd) резервирование Url для робота и привязывает к нему SSL-сертификат (для версий Windows-роботов, которые поднимали свои конечные точки. Не используется в Linux).

Развернутый робот готов к запуску.

![](../../../orchestrator-new/resources/deploy/orch-robot-interaction4.PNG)
